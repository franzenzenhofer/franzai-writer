Debugger listening on ws://127.0.0.1:9230/ed256cc3-787e-487b-85ef-c829a4727521
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   ▲ Next.js 15.3.3 (Turbopack)
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local

 ✓ Starting...
Creating turbopack project { dir: '/Users/franzenzenhofer/dev/franzai-writer', testMode: true }
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": true,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 ✓ Ready in 952ms
 ○ Compiling /w/[shortName]/[documentId] ...
Starting inspector on 127.0.0.1:9230 failed: address already in use
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'true',
  isServer: true,
  timestamp: '2025-06-14T08:20:48.122Z'
}
[FIREBASE INIT] Emulator mode enabled
[FIREBASE INIT] Running on server, skipping emulator connection
 GET / 200 in 1387ms
 GET / 200 in 163ms
 GET /dashboard 200 in 1323ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'true',
  isServer: true,
  timestamp: '2025-06-14T08:36:15.013Z'
}
[FIREBASE INIT] Emulator mode enabled
[FIREBASE INIT] Running on server, skipping emulator connection
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'true',
  isServer: true,
  timestamp: '2025-06-14T08:36:16.161Z'
}
[FIREBASE INIT] Emulator mode enabled
[FIREBASE INIT] Running on server, skipping emulator connection
[NewDocumentPage] STEP 1: Page accessed { shortName: 'poem' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'poem',
  workflowId: 'poem-generator',
  workflowName: 'Poem Generator'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'poem',
  documentId: 'mbvzfhe6wj3xst6',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  stageStatesCount: 0,
  hasUserId: false,
  isNewDocument: true
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: undefined,
  effectiveUserId: 'server_user_1749890176207_13u4rbfm3',
  wasGenerated: true
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [],
  originalCount: 0,
  cleanedKeys: [],
  cleanedCount: 0
}
[DocumentPersistence] STEP 6: Creating NEW document (documentId is null)
[DocumentPersistence] STEP 7: Prepared document data for creation {
  userId: 'server_user_1749890176207_13u4rbfm3',
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  status: 'draft',
  stageStatesCount: 0,
  metadata: { wordCount: 0, stageCount: 0 }
}
[DocumentPersistence] STEP 8: Calling Firestore adapter to create document
[FirestoreAdapter] STEP 1: Starting document creation {
  collection: 'documents',
  dataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata'
  ],
  dataSize: 183
}
[FirestoreAdapter] STEP 2: Generated document reference {
  collection: 'documents',
  id: '7CSEfKoWWiuK7wdOOUkk',
  path: 'documents/7CSEfKoWWiuK7wdOOUkk'
}
[FirestoreAdapter] STEP 3: Prepared document data {
  collection: 'documents',
  id: '7CSEfKoWWiuK7wdOOUkk',
  finalDataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata',
    'id',
    'createdAt',
    'updatedAt'
  ],
  hasStageStates: true,
  stageStatesKeys: []
}
[FirestoreAdapter] STEP 4: Calling setDoc on Firestore
[FirestoreAdapter] STEP 5: Document created successfully in Firestore { collection: 'documents', id: '7CSEfKoWWiuK7wdOOUkk' }
[FirestoreAdapter] Document created { collection: 'documents', id: '7CSEfKoWWiuK7wdOOUkk' }
[DocumentPersistence] STEP 9: Document creation completed successfully {
  createdDocumentId: '7CSEfKoWWiuK7wdOOUkk',
  collectionName: 'documents'
}
[DocumentPersistence] Document created successfully { documentId: '7CSEfKoWWiuK7wdOOUkk' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: '7CSEfKoWWiuK7wdOOUkk',
  error: undefined,
  originalId: 'mbvzfhe6wj3xst6'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbvzfhe6wj3xst6',
  createdId: '7CSEfKoWWiuK7wdOOUkk',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/poem/7CSEfKoWWiuK7wdOOUkk' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/poem/new 200 in 4865ms
