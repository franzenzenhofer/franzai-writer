
> nextn@0.1.0 dev
> lsof -ti:9002 | xargs kill -9 2>/dev/null || true && next dev --turbopack -p 9002 2>&1 | tee -a logs/nextjs-dev.log

Debugger listening on ws://127.0.0.1:9230/0d3ff4a4-1371-4acb-b3bf-9c68ccd53eac
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   ▲ Next.js 15.3.3 (Turbopack)
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.201:9002
   - Environments: .env.local

 ✓ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": true,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 ✓ Ready in 640ms
 ○ Compiling /dashboard ...
Starting inspector on 127.0.0.1:9230 failed: address already in use
 ✓ Compiled /dashboard in 1534ms
 HEAD /dashboard 200 in 1815ms
Debugger listening on ws://127.0.0.1:9230/876c4916-1940-4bc6-a2e8-29fbb911d248
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   ▲ Next.js 15.3.3 (Turbopack)
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.201:9002
   - Environments: .env.local

 ✓ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": true,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 ✓ Ready in 620ms
 ○ Compiling /w/[shortName]/[documentId] ...
Starting inspector on 127.0.0.1:9230 failed: address already in use
 ✓ Compiled /w/[shortName]/[documentId] in 3.9s
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Document not found, creating new: mbrtysrhwa6aapf
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  errorDetails: 'Error: Document not found'
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 6581ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Document not found, creating new: mbrtysrhwa6aapf
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  errorDetails: 'Error: Document not found'
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 171ms
 ✓ Compiled /favicon.ico in 341ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 591ms
 ✓ Compiled in 84ms
 ✓ Compiled /w/[shortName]/[documentId] in 36ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Document not found, creating new: mbrtysrhwa6aapf
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  errorDetails: 'Error: Document not found'
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 505ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 238ms
 ○ Compiling /w/[shortName]/new ...
 ✓ Compiled /w/[shortName]/new in 672ms
 GET /w/poem/new 307 in 1067ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Document not found, creating new: mbrtysrhwa6aapf
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  errorDetails: 'Error: Document not found'
}
 HEAD /w/poem/mbrtysrhwa6aapf 200 in 297ms
 ○ Compiling /api/test-documents ...
 ✓ Compiled /api/test-documents in 584ms
Testing document persistence...
[DocumentPersistence] Listing documents for user { userId: 'server_user_1749639413982_lvi0lhat5' }
[FirestoreAdapter] Querying documents {
  collection: 'documents',
  where: {
    field: 'userId',
    operator: '==',
    value: 'server_user_1749639413982_lvi0lhat5'
  },
  orderBy: { field: 'updatedAt', direction: 'desc' },
  limit: undefined
}
[FirestoreAdapter] Query completed { collection: 'documents', count: 0 }
[DocumentPersistence] Documents listed successfully { userId: 'server_user_1749639413982_lvi0lhat5', count: 0 }
 GET /api/test-documents 200 in 952ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Document not found, creating new: mbrtysrhwa6aapf
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  errorDetails: 'Error: Document not found'
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 162ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 222ms
 ✓ Compiled /w/[shortName]/[documentId] in 15ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  loadResultSuccess: false,
  hasDocument: false,
  hasStageStates: false
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 617ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 224ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  loadResultSuccess: false,
  hasDocument: false,
  hasStageStates: false
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 312ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 225ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  loadResultSuccess: false,
  hasDocument: false,
  hasStageStates: false
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 200ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 218ms
 ○ Compiling /dashboard ...
 ✓ Compiled /dashboard in 722ms
 GET /dashboard 200 in 754ms
 GET /dashboard 200 in 136ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 224ms
 GET /w/poem/new 200 in 45ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbru97iawibuqbw' }
[WizardPage] Attempting to load document: mbru97iawibuqbw
[DocumentPersistence] Loading document { documentId: 'mbru97iawibuqbw' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbru97iawibuqbw' }
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbru97iawibuqbw' }
[WizardPage] Attempting to load document: mbru97iawibuqbw
[DocumentPersistence] Loading document { documentId: 'mbru97iawibuqbw' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbru97iawibuqbw' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbru97iawibuqbw' }
[DocumentPersistence] Document not found { documentId: 'mbru97iawibuqbw' }
[WizardPage] Failed to load document: {
  documentId: 'mbru97iawibuqbw',
  error: 'Document not found',
  loadResultSuccess: false,
  hasDocument: false,
  hasStageStates: false
}
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbru97iawibuqbw' }
[DocumentPersistence] Document not found { documentId: 'mbru97iawibuqbw' }
[WizardPage] Failed to load document: {
  documentId: 'mbru97iawibuqbw',
  error: 'Document not found',
  loadResultSuccess: false,
  hasDocument: false,
  hasStageStates: false
}
 GET /w/poem/mbru97iawibuqbw 200 in 120ms
 GET /w/poem/mbru97iawibuqbw 200 in 69ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 236ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Attempting to load document: mbrtysrhwa6aapf
[DocumentPersistence] Loading document { documentId: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[FirestoreAdapter] Document not found { collection: 'documents', id: 'mbrtysrhwa6aapf' }
[DocumentPersistence] Document not found { documentId: 'mbrtysrhwa6aapf' }
[WizardPage] Failed to load document: {
  documentId: 'mbrtysrhwa6aapf',
  error: 'Document not found',
  loadResultSuccess: false,
  hasDocument: false,
  hasStageStates: false
}
 GET /w/poem/mbrtysrhwa6aapf 200 in 136ms
 GET /dashboard 200 in 99ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 235ms
[WizardPage] Starting page load { shortName: 'poem', documentId: '1lfwGpAxxGhXIGISrcBP' }
[WizardPage] Attempting to load document: 1lfwGpAxxGhXIGISrcBP
[DocumentPersistence] Loading document { documentId: '1lfwGpAxxGhXIGISrcBP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '1lfwGpAxxGhXIGISrcBP' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '1lfwGpAxxGhXIGISrcBP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '1lfwGpAxxGhXIGISrcBP',
  title: 'New Poem Generator',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: {
  documentId: '1lfwGpAxxGhXIGISrcBP',
  title: 'New Poem Generator',
  stageCount: 2
}
 GET /w/poem/1lfwGpAxxGhXIGISrcBP 200 in 233ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'ZGyzUSSVvmtAkIbUO3Bs' }
[WizardPage] Attempting to load document: ZGyzUSSVvmtAkIbUO3Bs
[DocumentPersistence] Loading document { documentId: 'ZGyzUSSVvmtAkIbUO3Bs' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'ZGyzUSSVvmtAkIbUO3Bs' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'ZGyzUSSVvmtAkIbUO3Bs' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'ZGyzUSSVvmtAkIbUO3Bs',
  title: 'New Poem Generator',
  stageStatesCount: 2,
  stageStatesKeys: [ 'generate-poem', 'poem-topic' ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'ZGyzUSSVvmtAkIbUO3Bs',
  title: 'New Poem Generator',
  stageCount: 2
}
 GET /w/poem/ZGyzUSSVvmtAkIbUO3Bs 200 in 134ms
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'googleai/gemini-2.5-flash-preview-05-20',
  temperature: 0.8,
  stageOutputType: 'markdown'
}
[runAiStage] Filled prompt length: 58
Executing AI stage with input: {
  "promptTemplate": "Write a poem about 'toast\n'.\nMake it about 4 stanzas long.",
  "model": "googleai/gemini-2.5-flash-preview-05-20",
  "temperature": 0.8,
  "fileInputs": []
}
[AI Stage Flow] Generating with options: {
  "prompt": "Write a poem about 'toast\n'.\nMake it about 4 stanzas long.",
  "model": "googleai/gemini-2.5-flash-preview-05-20",
  "config": {
    "temperature": 0.8
  }
}
[runAiStage] Success, content type: string
 POST /w/poem/ZGyzUSSVvmtAkIbUO3Bs 200 in 3339ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'ZGyzUSSVvmtAkIbUO3Bs' }
[WizardPage] Attempting to load document: ZGyzUSSVvmtAkIbUO3Bs
[DocumentPersistence] Loading document { documentId: 'ZGyzUSSVvmtAkIbUO3Bs' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'ZGyzUSSVvmtAkIbUO3Bs' }
 ✓ Compiled in 234ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'ZGyzUSSVvmtAkIbUO3Bs' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'ZGyzUSSVvmtAkIbUO3Bs',
  title: 'toast',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: { documentId: 'ZGyzUSSVvmtAkIbUO3Bs', title: 'toast', stageCount: 2 }
 GET /w/poem/ZGyzUSSVvmtAkIbUO3Bs 200 in 157ms
 ✓ Compiled /w/[shortName]/[documentId] in 15ms
[WizardPage] Starting page load { shortName: 'poem', documentId: 'ZGyzUSSVvmtAkIbUO3Bs' }
[WizardPage] Loading existing document: ZGyzUSSVvmtAkIbUO3Bs
[DocumentPersistence] Loading document { documentId: 'ZGyzUSSVvmtAkIbUO3Bs' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'ZGyzUSSVvmtAkIbUO3Bs' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'ZGyzUSSVvmtAkIbUO3Bs' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'ZGyzUSSVvmtAkIbUO3Bs',
  title: 'toast',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: { documentId: 'ZGyzUSSVvmtAkIbUO3Bs', title: 'toast', stageCount: 2 }
 GET /w/poem/ZGyzUSSVvmtAkIbUO3Bs 200 in 585ms
Debugger listening on ws://127.0.0.1:9230/70b017b7-43b7-4c0b-99f7-69e073485c89
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   ▲ Next.js 15.3.3 (Turbopack)
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.201:9002
   - Environments: .env.local

 ✓ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": true,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 ✓ Ready in 625ms
 ○ Compiling /dashboard ...
Starting inspector on 127.0.0.1:9230 failed: address already in use
 ✓ Compiled /dashboard in 1556ms
 GET /dashboard 200 in 1680ms
 ○ Compiling /w/[shortName]/new ...
 ✓ Compiled /w/[shortName]/new in 941ms
[NewDocumentPage] Creating new document {
  shortName: 'poem',
  documentId: 'mbrux2a7wi1y1uc',
  workflowId: 'poem-generator'
}
[DocumentPersistence] Starting document save {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  hasUserId: false
}
[DocumentPersistence] Using user ID { userId: 'server_user_1749640733648_qak8aqm17' }
[DocumentPersistence] Stage states cleaned { originalKeys: [], cleanedKeys: [] }
[FirestoreAdapter] Creating document { collection: 'documents' }
[FirestoreAdapter] Document created { collection: 'documents', id: 'rEGYXQffbtZ2UzUjlnVI' }
[DocumentPersistence] Document created successfully { documentId: 'rEGYXQffbtZ2UzUjlnVI' }
[NewDocumentPage] Document created successfully {
  originalId: 'mbrux2a7wi1y1uc',
  createdId: 'rEGYXQffbtZ2UzUjlnVI',
  workflowId: 'poem-generator'
}
[NewDocumentPage] Exception during document creation {
  error: 'NEXT_REDIRECT',
  documentId: 'mbrux2a7wi1y1uc',
  workflowId: 'poem-generator',
  stack: 'Error: NEXT_REDIRECT\n' +
    '    at getRedirectError (/Users/franzenzenhofer/dev/franzai-writer/.next/server/chunks/ssr/node_modules_next_dist_74f3999f._.js:157:41)\n' +
    '    at redirect (/Users/franzenzenhofer/dev/franzai-writer/.next/server/chunks/ssr/node_modules_next_dist_74f3999f._.js:168:11)\n' +
    '    at NewDocumentPage (/Users/franzenzenhofer/dev/franzai-writer/.next/server/chunks/ssr/[root-of-the-server]__43eaf9b6._.js:990:207)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)'
}
 GET /w/poem/new 200 in 1694ms
 GET /dashboard?error=creation_exception 200 in 37ms
 GET /dashboard?error=creation_exception 200 in 35ms
 ✓ Compiled /favicon.ico in 265ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 510ms
 GET /dashboard?error=creation_exception 200 in 234ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 250ms
 GET /dashboard 200 in 88ms
[NewDocumentPage] Creating new document {
  shortName: 'poem',
  documentId: 'mbruy1mfwalewsc',
  workflowId: 'poem-generator'
}
[DocumentPersistence] Starting document save {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  hasUserId: false
}
[DocumentPersistence] Using user ID { userId: 'server_user_1749640779447_l4c859s0r' }
[DocumentPersistence] Stage states cleaned { originalKeys: [], cleanedKeys: [] }
[FirestoreAdapter] Creating document { collection: 'documents' }
[FirestoreAdapter] Document created { collection: 'documents', id: 'pTyZiYzvjLGDoC3K4YdY' }
[DocumentPersistence] Document created successfully { documentId: 'pTyZiYzvjLGDoC3K4YdY' }
[NewDocumentPage] Document created successfully {
  originalId: 'mbruy1mfwalewsc',
  createdId: 'pTyZiYzvjLGDoC3K4YdY',
  workflowId: 'poem-generator'
}
[NewDocumentPage] Exception during document creation {
  error: 'NEXT_REDIRECT',
  documentId: 'mbruy1mfwalewsc',
  workflowId: 'poem-generator',
  stack: 'Error: NEXT_REDIRECT\n' +
    '    at getRedirectError (/Users/franzenzenhofer/dev/franzai-writer/.next/server/chunks/ssr/node_modules_next_dist_74f3999f._.js:157:41)\n' +
    '    at redirect (/Users/franzenzenhofer/dev/franzai-writer/.next/server/chunks/ssr/node_modules_next_dist_74f3999f._.js:168:11)\n' +
    '    at NewDocumentPage (/Users/franzenzenhofer/dev/franzai-writer/.next/server/chunks/ssr/[root-of-the-server]__43eaf9b6._.js:990:207)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)'
}
 GET /w/poem/new 200 in 149ms
 GET /dashboard?error=creation_exception 200 in 45ms
 GET /dashboard?error=creation_exception 200 in 31ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 226ms
 GET /dashboard?error=creation_exception 200 in 31ms
 ✓ Compiled in 55ms
 ✓ Compiled /w/[shortName]/new in 22ms
[NewDocumentPage] STEP 1: Page accessed { shortName: 'poem' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'poem',
  workflowId: 'poem-generator',
  workflowName: 'Poem Generator'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'poem',
  documentId: 'mbrv0bgvw6y0flk',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] Starting document save {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  hasUserId: false
}
[DocumentPersistence] Using user ID { userId: 'server_user_1749640885519_nszczdr4l' }
[DocumentPersistence] Stage states cleaned { originalKeys: [], cleanedKeys: [] }
[FirestoreAdapter] Creating document { collection: 'documents' }
[FirestoreAdapter] Document created { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document created successfully { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  error: undefined,
  originalId: 'mbrv0bgvw6y0flk'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbrv0bgvw6y0flk',
  createdId: '4Hr4FNInKFTNoKjC1gYP',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/poem/4Hr4FNInKFTNoKjC1gYP' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/poem/new 200 in 542ms
 GET /favicon.ico?favicon.56766c03.ico 200 in 231ms
 ○ Compiling /w/[shortName]/[documentId] ...
 ✓ Compiled /w/[shortName]/[documentId] in 2.6s
[WizardPage] Starting page load { shortName: 'poem', documentId: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Loading existing document: 4Hr4FNInKFTNoKjC1gYP
[DocumentPersistence] Loading document { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Starting page load { shortName: 'poem', documentId: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Loading existing document: 4Hr4FNInKFTNoKjC1gYP
[DocumentPersistence] Loading document { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageCount: 0
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageCount: 0
}
 GET /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 3429ms
 GET /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 159ms
 ✓ Compiled /w/[shortName]/[documentId] in 25ms
[WizardPage] Starting page load { shortName: 'poem', documentId: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Loading existing document: 4Hr4FNInKFTNoKjC1gYP
[DocumentPersistence] Loading document { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Starting page load { shortName: 'poem', documentId: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Loading existing document: 4Hr4FNInKFTNoKjC1gYP
[DocumentPersistence] Loading document { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageCount: 2
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageCount: 2
}
 GET /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 532ms
 GET /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 222ms
 ✓ Compiled /w/[shortName]/[documentId] in 5ms
[WizardPage] Starting page load { shortName: 'poem', documentId: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Loading existing document: 4Hr4FNInKFTNoKjC1gYP
[DocumentPersistence] Loading document { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Starting page load { shortName: 'poem', documentId: '4Hr4FNInKFTNoKjC1gYP' }
[WizardPage] Loading existing document: 4Hr4FNInKFTNoKjC1gYP
[DocumentPersistence] Loading document { documentId: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageCount: 2
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4Hr4FNInKFTNoKjC1gYP' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageStatesCount: 2,
  stageStatesKeys: [ 'poem-topic', 'generate-poem' ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4Hr4FNInKFTNoKjC1gYP',
  title: 'New Poem Generator',
  stageCount: 2
}
 GET /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 1475ms
 GET /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 1203ms
Debugger listening on ws://127.0.0.1:9230/580ad922-d239-49c0-9344-288d6103bc34
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   ▲ Next.js 15.3.3 (Turbopack)
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.201:9002
   - Environments: .env.local

 ✓ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": true,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 ✓ Ready in 895ms
 ○ Compiling /w/[shortName]/[documentId] ...
Starting inspector on 127.0.0.1:9230 failed: address already in use
 ✓ Compiled /w/[shortName]/[documentId] in 3.3s
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'googleai/gemini-2.5-flash-preview-05-20',
  temperature: 0.8,
  stageOutputType: 'markdown'
}
[runAiStage] Filled prompt length: 63
Executing AI stage with input: {
  "promptTemplate": "Write a poem about 'about dogs '.\nMake it about 4 stanzas long.",
  "model": "googleai/gemini-2.5-flash-preview-05-20",
  "temperature": 0.8,
  "fileInputs": []
}
[AI Stage Flow] Generating with options: {
  "prompt": "Write a poem about 'about dogs '.\nMake it about 4 stanzas long.",
  "model": "googleai/gemini-2.5-flash-preview-05-20",
  "config": {
    "temperature": 0.8
  }
}
[runAiStage] Success, content type: string
 POST /w/poem/4Hr4FNInKFTNoKjC1gYP 200 in 11389ms
