
> nextn@0.1.0 dev
> npm run kill && npm run dev:start


> nextn@0.1.0 kill
> pkill -f 'next-server' || true; pkill -f 'genkit' || true; pkill -f 'firebase-tools' || true; pkill -f 'java.*firestore' || true; lsof -ti:9002,4000,9099,8080,5001,5002,4400,4500,9150 | xargs kill -9 2>/dev/null || true; echo 'âœ… All servers and emulators killed'

âœ… All servers and emulators killed

> nextn@0.1.0 dev:start
> NEXT_PUBLIC_DEMO_MODE=true NEXT_PUBLIC_USE_FIREBASE_EMULATOR=false DEBUG=genkit*,ai*,google* GENKIT_LOG_LEVEL=debug next dev -p 9002 2>&1 | tee -a logs/nextjs-dev.log

Debugger listening on ws://127.0.0.1:9230/80638d37-fc8f-4db3-8462-a8cddf229b4b
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1371ms
 â—‹ Compiling / ...
 âœ“ Compiled / in 1629ms (1212 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:28:20.018Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 GET / 200 in 2158ms
 âœ“ Compiled in 622ms (454 modules)
 âœ“ Compiled /w/[shortName]/new in 431ms (1328 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:57:35.403Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:57:35.505Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[NewDocumentPage] STEP 1: Page accessed { shortName: 'poem' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'poem',
  workflowId: 'poem-generator',
  workflowName: 'Poem Generator'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'poem',
  documentId: 'mbxfmr6mw6pep99',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  stageStatesCount: 0,
  hasUserId: false,
  isNewDocument: true
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: undefined,
  effectiveUserId: 'server_user_1749977855518_bl7hbru3v',
  wasGenerated: true
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [],
  originalCount: 0,
  cleanedKeys: [],
  cleanedCount: 0
}
[DocumentPersistence] STEP 6: Creating NEW document (documentId is null)
[DocumentPersistence] STEP 7: Prepared document data for creation {
  userId: 'server_user_1749977855518_bl7hbru3v',
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  status: 'draft',
  stageStatesCount: 0,
  metadata: { wordCount: 0, stageCount: 0 }
}
[DocumentPersistence] STEP 8: Calling Firestore adapter to create document
[FirestoreAdapter] STEP 1: Starting document creation {
  collection: 'documents',
  dataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata'
  ],
  dataSize: 183
}
[FirestoreAdapter] STEP 2: Generated document reference {
  collection: 'documents',
  id: 'uUDTJo5UCxMUEaAIix5e',
  path: 'documents/uUDTJo5UCxMUEaAIix5e'
}
[FirestoreAdapter] STEP 3: Prepared document data {
  collection: 'documents',
  id: 'uUDTJo5UCxMUEaAIix5e',
  finalDataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata',
    'id',
    'createdAt',
    'updatedAt'
  ],
  hasStageStates: true,
  stageStatesKeys: []
}
[FirestoreAdapter] STEP 4: Calling setDoc on Firestore
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:57:35.659Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] STEP 5: Document created successfully in Firestore { collection: 'documents', id: 'uUDTJo5UCxMUEaAIix5e' }
[FirestoreAdapter] Document created { collection: 'documents', id: 'uUDTJo5UCxMUEaAIix5e' }
[DocumentPersistence] STEP 9: Document creation completed successfully {
  createdDocumentId: 'uUDTJo5UCxMUEaAIix5e',
  collectionName: 'documents'
}
[DocumentPersistence] Document created successfully { documentId: 'uUDTJo5UCxMUEaAIix5e' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: 'uUDTJo5UCxMUEaAIix5e',
  error: undefined,
  originalId: 'mbxfmr6mw6pep99'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbxfmr6mw6pep99',
  createdId: 'uUDTJo5UCxMUEaAIix5e',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/poem/uUDTJo5UCxMUEaAIix5e' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/poem/new 307 in 1770ms
 âœ“ Compiled / in 112ms (904 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:57:57.147Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 GET / 200 in 323ms
 â—‹ Compiling /dashboard ...
 âœ“ Compiled /dashboard in 593ms (1395 modules)
 GET /dashboard 200 in 644ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:58:03.205Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[NewDocumentPage] STEP 1: Page accessed { shortName: 'poem' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'poem',
  workflowId: 'poem-generator',
  workflowName: 'Poem Generator'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'poem',
  documentId: 'mbxfncjswubo0d2',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  stageStatesCount: 0,
  hasUserId: false,
  isNewDocument: true
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: undefined,
  effectiveUserId: 'server_user_1749977883209_ljpwh3nay',
  wasGenerated: true
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [],
  originalCount: 0,
  cleanedKeys: [],
  cleanedCount: 0
}
[DocumentPersistence] STEP 6: Creating NEW document (documentId is null)
[DocumentPersistence] STEP 7: Prepared document data for creation {
  userId: 'server_user_1749977883209_ljpwh3nay',
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  status: 'draft',
  stageStatesCount: 0,
  metadata: { wordCount: 0, stageCount: 0 }
}
[DocumentPersistence] STEP 8: Calling Firestore adapter to create document
[FirestoreAdapter] STEP 1: Starting document creation {
  collection: 'documents',
  dataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata'
  ],
  dataSize: 183
}
[FirestoreAdapter] STEP 2: Generated document reference {
  collection: 'documents',
  id: 'RgfMlL9WPQw6GQ9HsZjv',
  path: 'documents/RgfMlL9WPQw6GQ9HsZjv'
}
[FirestoreAdapter] STEP 3: Prepared document data {
  collection: 'documents',
  id: 'RgfMlL9WPQw6GQ9HsZjv',
  finalDataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata',
    'id',
    'createdAt',
    'updatedAt'
  ],
  hasStageStates: true,
  stageStatesKeys: []
}
[FirestoreAdapter] STEP 4: Calling setDoc on Firestore
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:58:03.549Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] STEP 5: Document created successfully in Firestore { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document created { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] STEP 9: Document creation completed successfully {
  createdDocumentId: 'RgfMlL9WPQw6GQ9HsZjv',
  collectionName: 'documents'
}
[DocumentPersistence] Document created successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  error: undefined,
  originalId: 'mbxfncjswubo0d2'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbxfncjswubo0d2',
  createdId: 'RgfMlL9WPQw6GQ9HsZjv',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/poem/RgfMlL9WPQw6GQ9HsZjv' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/poem/new 200 in 746ms
 â—‹ Compiling /w/[shortName]/[documentId] ...
 âœ“ Compiled /w/[shortName]/[documentId] in 734ms (2199 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:58:05.054Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:58:05.096Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'poem', documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[WizardPage] Loading existing document: RgfMlL9WPQw6GQ9HsZjv
[DocumentPersistence] Loading document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[WizardPage] Starting page load { shortName: 'poem', documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[WizardPage] Loading existing document: RgfMlL9WPQw6GQ9HsZjv
[DocumentPersistence] Loading document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'New Poem Generator',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'New Poem Generator',
  stageCount: 0,
  validatedStageIds: []
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'New Poem Generator',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'New Poem Generator',
  stageCount: 0,
  validatedStageIds: []
}
 GET /w/poem/RgfMlL9WPQw6GQ9HsZjv 200 in 1539ms
 GET /w/poem/RgfMlL9WPQw6GQ9HsZjv 200 in 263ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:58:05.579Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 â—‹ Compiling /api/wizard/execute ...
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 âœ“ Compiled /api/wizard/execute in 786ms (2371 modules)
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Structured JSON Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 406,
  temperature: 0.8,
  schema: '{"type":"object","properties":{"title":{"type":"string","description":"Poem Title"},"poem":{"type":"...',
  systemInstruction: 'undefined...'
}
 â—‹ Compiling /api/documents/save ...
ðŸ“¥ [AI RESPONSE] Structured JSON Generation: {
  textLength: 633,
  parsedKeys: [ 'poem', 'title' ],
  preview: '{"poem":"A challenge laid, a path unseen,\\nA trial set, where hopes convene.\\nTo measure strength, to gauge the mind,\\nA proving ground, for all mankind.\\n\\nWith anxious heart and hurried breath,\\nWe ...'
}
 POST /api/wizard/execute 200 in 2895ms
 âœ“ Compiled /api/documents/save in 1184ms (2373 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:58:12.300Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 1833ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 237ms
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 1136,
  temperature: 0.3,
  systemInstruction: 'undefined...'
}
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 272ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1844,
  textPreview: '```html\n' +
    '<!DOCTYPE html>\n' +
    '<html lang="en">\n' +
    '<head>\n' +
    '    <meta charset="UTF-8">\n' +
    '    <meta name="viewport"...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 3011ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 231ms
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 1194,
  temperature: 0.3,
  systemInstruction: 'undefined...'
}
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 213ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 2552,
  textPreview: '```html\n' +
    '<!DOCTYPE html>\n' +
    '<html lang="en">\n' +
    '<head>\n' +
    '    <meta charset="UTF-8">\n' +
    '    <meta name="viewport"...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 3768ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 307ms
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 1228,
  temperature: 0.3,
  systemInstruction: 'undefined...'
}
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 302ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1764,
  textPreview: '```html\n' +
    '<!DOCTYPE html>\n' +
    '<html lang="en">\n' +
    '<head>\n' +
    '    <meta charset="UTF-8">\n' +
    '    <meta name="viewport"...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 3179ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'RgfMlL9WPQw6GQ9HsZjv',
  title: 'The Crucible of Knowing',
  workflowId: 'poem-generator',
  stageStatesKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  stageStatesCount: 4,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  originalCount: 4,
  cleanedKeys: [
    'poem-topic',
    'generate-poem-with-title',
    'html-briefing',
    'generate-html-preview'
  ],
  cleanedCount: 4
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'RgfMlL9WPQw6GQ9HsZjv' }
[DocumentPersistence] Document updated successfully { documentId: 'RgfMlL9WPQw6GQ9HsZjv' }
 POST /api/documents/save 200 in 179ms
 GET /dashboard 200 in 78ms
[NewDocumentPage] STEP 1: Page accessed { shortName: 'gemini-test' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'gemini-test',
  workflowId: 'gemini-tools-test',
  workflowName: 'Gemini AI Tools Test'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'gemini-test',
  documentId: 'mbxfp1rfwnn7cqj',
  workflowId: 'gemini-tools-test'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: null,
  title: 'New Gemini AI Tools Test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [],
  stageStatesCount: 0,
  hasUserId: false,
  isNewDocument: true
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: undefined,
  effectiveUserId: 'server_user_1749977962540_0b6t1d7r1',
  wasGenerated: true
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [],
  originalCount: 0,
  cleanedKeys: [],
  cleanedCount: 0
}
[DocumentPersistence] STEP 6: Creating NEW document (documentId is null)
[DocumentPersistence] STEP 7: Prepared document data for creation {
  userId: 'server_user_1749977962540_0b6t1d7r1',
  title: 'New Gemini AI Tools Test',
  workflowId: 'gemini-tools-test',
  status: 'draft',
  stageStatesCount: 0,
  metadata: { wordCount: 0, stageCount: 0 }
}
[DocumentPersistence] STEP 8: Calling Firestore adapter to create document
[FirestoreAdapter] STEP 1: Starting document creation {
  collection: 'documents',
  dataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata'
  ],
  dataSize: 192
}
[FirestoreAdapter] STEP 2: Generated document reference {
  collection: 'documents',
  id: '4uhVu0tEOLwcmnAA2wdv',
  path: 'documents/4uhVu0tEOLwcmnAA2wdv'
}
[FirestoreAdapter] STEP 3: Prepared document data {
  collection: 'documents',
  id: '4uhVu0tEOLwcmnAA2wdv',
  finalDataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata',
    'id',
    'createdAt',
    'updatedAt'
  ],
  hasStageStates: true,
  stageStatesKeys: []
}
[FirestoreAdapter] STEP 4: Calling setDoc on Firestore
[FirestoreAdapter] STEP 5: Document created successfully in Firestore { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document created { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] STEP 9: Document creation completed successfully {
  createdDocumentId: '4uhVu0tEOLwcmnAA2wdv',
  collectionName: 'documents'
}
[DocumentPersistence] Document created successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  error: undefined,
  originalId: 'mbxfp1rfwnn7cqj'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbxfp1rfwnn7cqj',
  createdId: '4uhVu0tEOLwcmnAA2wdv',
  workflowId: 'gemini-tools-test'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/gemini-test/4uhVu0tEOLwcmnAA2wdv' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/gemini-test/new 200 in 183ms
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'New Gemini AI Tools Test',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'New Gemini AI Tools Test',
  stageCount: 0,
  validatedStageIds: []
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'New Gemini AI Tools Test',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'New Gemini AI Tools Test',
  stageCount: 0,
  validatedStageIds: []
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 116ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 91ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:59:23.029Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T08:59:23.203Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 208ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 190ms
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 275,
  temperature: 0.7,
  systemInstruction: 'You have Google Search grounding enabled. Use it to find current, up-to-date information. Do NOT gen...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 450,
  textPreview: 'Okay, I will use Google Search to find out what happened in Austria Vienna yesterday (October 12, 20...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1159ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 189ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput.url}}' not found in context. Replacing with empty string.
Prompt variable '{{userInput.question}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 38,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 747,
  textPreview: 'Please provide the content you would like me to analyze. I need the text or document you are referri...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1493ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 217ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-thinking-exp',
  promptLength: 33,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 136,
  textPreview: 'Please provide the problem you would like me to solve.\n' +
    '\n' +
    'Once you provide the problem, I will be happ...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 2086ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 226ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 257ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 70,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 317,
  textPreview: "Okay, I'm ready. Just tell me what you want me to calculate. Please provide the mathematical operati...",
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1256ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 218ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 78,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 234,
  textPreview: "Okay, I'm ready. Please tell me the locations you'd like me to get weather information for. I'll use...",
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1006ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 277ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 100,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 620,
  textPreview: "Okay, let's break down the task and provide Python code with explanations.  Please specify the task ...",
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1490ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 310ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 45,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 217ms
[runAiStage] Starting with new SDK
Prompt variable '{{userInput}}' not found in context. Replacing with empty string.
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 13,
  temperature: 0.7,
  systemInstruction: 'You are a helpful AI assistant in a test environment. Be conversational and remember context from pr...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 345,
  textPreview: 'Please provide me with the user input! I need the text from `{{userInput}}` to be able to respond to...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1008ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 15180,
  textPreview: "Okay, I understand. You're asking me to provide a **detailed and comprehensive response** to...well,...",
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 16574ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 261ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 235ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Structured JSON Generation: {
  model: 'gemini-2.0-flash-exp',
  promptLength: 241,
  temperature: 0.7,
  schema: '{"type":"object","properties":{"content":{"type":"string"}}}...',
  systemInstruction: 'undefined...'
}
[2025-06-15T09:02:22.785Z]  @firebase/firestore: Firestore (11.9.0): GrpcConnection RPC 'Write' stream 0x4ba45f92 error. Code: 3 Message: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.
[FirestoreAdapter] FAILED: updateDocument 4uhVu0tEOLwcmnAA2wdv in documents [Error [FirebaseError]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.] {
  code: 'invalid-argument',
  customData: undefined,
  toString: [Function (anonymous)]
}
[DocumentPersistence] STEP ERROR: Save operation failed {
  error: 'FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.',
  errorType: 'Error',
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stack: 'Error: FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.\n' +
    '    at FirestoreAdapter.updateDocument (webpack-internal:///(rsc)/./src/lib/firestore-adapter.ts:105:19)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async DocumentPersistenceManager.saveDocument (webpack-internal:///(rsc)/./src/lib/document-persistence.ts:217:17)\n' +
    '    at async POST (webpack-internal:///(rsc)/./src/app/api/documents/save/route.ts:39:24)\n' +
    '    at async AppRouteRouteModule.do (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1518:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1920:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:2408:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:2445:32)\n' +
    '    at async DevServer.pipeImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1008:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:900:17)\n' +
    '    at async /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/start-server.js:158:13)'
}
[DocumentPersistence] FAILED: saveDocument Error: FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.
    at FirestoreAdapter.updateDocument (src/lib/firestore-adapter.ts:127:12)
    at async DocumentPersistenceManager.saveDocument (src/lib/document-persistence.ts:256:8)
    at async POST (src/app/api/documents/save/route.ts:33:19)
  125 |     } catch (error) {
  126 |       this.logError(`updateDocument ${documentId} in ${collectionName}`, error);
> 127 |       throw new Error(`FATAL: Failed to update document ${documentId} in ${collectionName}: ${error}`);
      |            ^
  128 |     }
  129 |   }
  130 |
 POST /api/documents/save 200 in 1881ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
ðŸ“¥ [AI RESPONSE] Structured JSON Generation: {
  textLength: 835,
  parsedKeys: [ 'content' ],
  preview: '{"content":"{\\"description\\": \\"A close-up shot of a plate of colorful sushi. The sushi includes a variety of rolls with different fillings and toppings, such as salmon, tuna, avocado, and sesame seed...'
}
 POST /api/wizard/execute 200 in 2650ms
[2025-06-15T09:02:25.492Z]  @firebase/firestore: Firestore (11.9.0): GrpcConnection RPC 'Write' stream 0x4ba45f93 error. Code: 3 Message: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.
[FirestoreAdapter] FAILED: updateDocument 4uhVu0tEOLwcmnAA2wdv in documents [Error [FirebaseError]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.] {
  code: 'invalid-argument',
  customData: undefined,
  toString: [Function (anonymous)]
}
[DocumentPersistence] STEP ERROR: Save operation failed {
  error: 'FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.',
  errorType: 'Error',
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stack: 'Error: FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.\n' +
    '    at FirestoreAdapter.updateDocument (webpack-internal:///(rsc)/./src/lib/firestore-adapter.ts:105:19)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async DocumentPersistenceManager.saveDocument (webpack-internal:///(rsc)/./src/lib/document-persistence.ts:217:17)\n' +
    '    at async POST (webpack-internal:///(rsc)/./src/app/api/documents/save/route.ts:39:24)\n' +
    '    at async AppRouteRouteModule.do (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1518:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1920:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:2408:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:2445:32)\n' +
    '    at async DevServer.pipeImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1008:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:900:17)\n' +
    '    at async /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/start-server.js:158:13)'
}
[DocumentPersistence] FAILED: saveDocument Error: FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.
    at FirestoreAdapter.updateDocument (src/lib/firestore-adapter.ts:127:12)
    at async DocumentPersistenceManager.saveDocument (src/lib/document-persistence.ts:256:8)
    at async POST (src/app/api/documents/save/route.ts:33:19)
  125 |     } catch (error) {
  126 |       this.logError(`updateDocument ${documentId} in ${collectionName}`, error);
> 127 |       throw new Error(`FATAL: Failed to update document ${documentId} in ${collectionName}: ${error}`);
      |            ^
  128 |     }
  129 |   }
  130 |
 POST /api/documents/save 200 in 1820ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[2025-06-15T09:02:28.177Z]  @firebase/firestore: Firestore (11.9.0): GrpcConnection RPC 'Write' stream 0x4ba45f94 error. Code: 3 Message: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.
[FirestoreAdapter] FAILED: updateDocument 4uhVu0tEOLwcmnAA2wdv in documents [Error [FirebaseError]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.] {
  code: 'invalid-argument',
  customData: undefined,
  toString: [Function (anonymous)]
}
[DocumentPersistence] STEP ERROR: Save operation failed {
  error: 'FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.',
  errorType: 'Error',
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stack: 'Error: FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.\n' +
    '    at FirestoreAdapter.updateDocument (webpack-internal:///(rsc)/./src/lib/firestore-adapter.ts:105:19)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
    '    at async DocumentPersistenceManager.saveDocument (webpack-internal:///(rsc)/./src/lib/document-persistence.ts:217:17)\n' +
    '    at async POST (webpack-internal:///(rsc)/./src/app/api/documents/save/route.ts:39:24)\n' +
    '    at async AppRouteRouteModule.do (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:34112)\n' +
    '    at async AppRouteRouteModule.handle (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/next-server/app-route.runtime.dev.js:26:41338)\n' +
    '    at async doRender (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1518:42)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1920:28)\n' +
    '    at async DevServer.renderPageComponent (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:2408:24)\n' +
    '    at async DevServer.renderToResponseImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:2445:32)\n' +
    '    at async DevServer.pipeImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:1008:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/next-server.js:305:17)\n' +
    '    at async DevServer.handleRequestImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/base-server.js:900:17)\n' +
    '    at async /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/next-dev-server.js:371:20\n' +
    '    at async Span.traceAsyncFn (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/next-dev-server.js:368:24)\n' +
    '    at async invokeRender (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:237:21)\n' +
    '    at async handleRequest (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:428:24)\n' +
    '    at async requestHandlerImpl (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/router-server.js:452:13)\n' +
    '    at async Server.requestListener (/Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/start-server.js:158:13)'
}
[DocumentPersistence] FAILED: saveDocument Error: FATAL: Failed to update document 4uhVu0tEOLwcmnAA2wdv in documents: FirebaseError: [code=invalid-argument]: 3 INVALID_ARGUMENT: Property stageStates contains an invalid nested entity.
    at FirestoreAdapter.updateDocument (src/lib/firestore-adapter.ts:127:12)
    at async DocumentPersistenceManager.saveDocument (src/lib/document-persistence.ts:256:8)
    at async POST (src/app/api/documents/save/route.ts:33:19)
  125 |     } catch (error) {
  126 |       this.logError(`updateDocument ${documentId} in ${collectionName}`, error);
> 127 |       throw new Error(`FATAL: Failed to update document ${documentId} in ${collectionName}: ${error}`);
      |            ^
  128 |     }
  129 |   }
  130 |
 POST /api/documents/save 200 in 1808ms
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:12:49.116Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'document-understanding-test',
    'thinking-mode-test',
    'final-summary',
    'function-calling-unit-converter',
    'image-understanding-test',
    'function-calling-calculator',
    'test-title',
    'grounding-url-context',
    'streaming-test',
    'code-execution-python',
    'combined-features-test',
    'chat-mode-test',
    'function-calling-weather',
    'grounding-google-search'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'document-understanding-test',
    'thinking-mode-test',
    'final-summary',
    'function-calling-unit-converter',
    'image-understanding-test',
    'function-calling-calculator',
    'test-title',
    'grounding-url-context',
    'streaming-test',
    'code-execution-python',
    'combined-features-test',
    'chat-mode-test',
    'function-calling-weather',
    'grounding-google-search'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 496ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:12:49.707Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled /favicon.ico in 259ms (1338 modules)
 GET /favicon.ico 200 in 342ms
 âœ“ Compiled /api/documents/save in 142ms (1340 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:12:52.572Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 1061ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 364ms
sh: line 1: 60305 Terminated: 15          npm run dev:start
Debugger listening on ws://127.0.0.1:9229/2cee875f-0500-44d8-899e-8871af8d447d
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 2716246,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/fabfa947-cadc-45e0-94e3-c3f8bc517895
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1572ms
 â—‹ Compiling /api/wizard/execute ...
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 âœ“ Compiled /api/wizard/execute in 934ms (586 modules)
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 329,
  temperature: 0.7,
  systemInstruction: 'You have Google Search grounding enabled. Use it to find current, up-to-date information. Do NOT gen...'
}
 â—‹ Compiling /api/documents/save ...
 âœ“ Compiled /api/documents/save in 873ms (720 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:16:18.384Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 954,
  textPreview: 'Okay, I will use Google Search to find out what happened in Austria Vienna yesterday and provide you...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 3193ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 1607ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 303ms
 âœ“ Compiled in 33ms
 â—‹ Compiling /w/[shortName]/new ...
 âœ“ Compiled /w/[shortName]/new in 1428ms (1341 modules)
 âœ“ Compiled in 244ms (454 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:23:06.198Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:23:06.297Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[NewDocumentPage] STEP 1: Page accessed { shortName: 'poem' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'poem',
  workflowId: 'poem-generator',
  workflowName: 'Poem Generator'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'poem',
  documentId: 'mbxgjkcnw979wpn',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: null,
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  stageStatesKeys: [],
  stageStatesCount: 0,
  hasUserId: false,
  isNewDocument: true
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: undefined,
  effectiveUserId: 'server_user_1749979386312_t3ikxi3kz',
  wasGenerated: true
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [],
  originalCount: 0,
  cleanedKeys: [],
  cleanedCount: 0
}
[DocumentPersistence] STEP 6: Creating NEW document (documentId is null)
[DocumentPersistence] STEP 7: Prepared document data for creation {
  userId: 'server_user_1749979386312_t3ikxi3kz',
  title: 'New Poem Generator',
  workflowId: 'poem-generator',
  status: 'draft',
  stageStatesCount: 0,
  metadata: { wordCount: 0, stageCount: 0 }
}
[DocumentPersistence] STEP 8: Calling Firestore adapter to create document
[FirestoreAdapter] STEP 1: Starting document creation {
  collection: 'documents',
  dataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata'
  ],
  dataSize: 183
}
[FirestoreAdapter] STEP 2: Generated document reference {
  collection: 'documents',
  id: 'OqhhKBowk4Poo2yZT9aa',
  path: 'documents/OqhhKBowk4Poo2yZT9aa'
}
[FirestoreAdapter] STEP 3: Prepared document data {
  collection: 'documents',
  id: 'OqhhKBowk4Poo2yZT9aa',
  finalDataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata',
    'id',
    'createdAt',
    'updatedAt'
  ],
  hasStageStates: true,
  stageStatesKeys: []
}
[FirestoreAdapter] STEP 4: Calling setDoc on Firestore
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:23:06.462Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] STEP 5: Document created successfully in Firestore { collection: 'documents', id: 'OqhhKBowk4Poo2yZT9aa' }
[FirestoreAdapter] Document created { collection: 'documents', id: 'OqhhKBowk4Poo2yZT9aa' }
[DocumentPersistence] STEP 9: Document creation completed successfully {
  createdDocumentId: 'OqhhKBowk4Poo2yZT9aa',
  collectionName: 'documents'
}
[DocumentPersistence] Document created successfully { documentId: 'OqhhKBowk4Poo2yZT9aa' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: 'OqhhKBowk4Poo2yZT9aa',
  error: undefined,
  originalId: 'mbxgjkcnw979wpn'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbxgjkcnw979wpn',
  createdId: 'OqhhKBowk4Poo2yZT9aa',
  workflowId: 'poem-generator'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/poem/OqhhKBowk4Poo2yZT9aa' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/poem/new 307 in 2787ms
 âœ“ Compiled /api/wizard/execute in 155ms (1062 modules)
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 0,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 542,
  textPreview: "Please provide me with more context! I need to know what you'd like me to do. For example, are you a...",
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 1813ms
 â—‹ Compiling /w/[shortName]/[documentId] ...
 âœ“ Compiled /w/[shortName]/[documentId] in 1263ms (2311 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:28.757Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:28.864Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:29.012Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'final-summary',
    'code-execution-python',
    'document-understanding-test',
    'image-understanding-test',
    'grounding-google-search',
    'test-title',
    'function-calling-calculator',
    'streaming-test',
    'thinking-mode-test',
    'function-calling-weather',
    'combined-features-test',
    'function-calling-unit-converter',
    'chat-mode-test',
    'grounding-url-context'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'final-summary',
    'code-execution-python',
    'document-understanding-test',
    'image-understanding-test',
    'grounding-google-search',
    'test-title',
    'function-calling-calculator',
    'streaming-test',
    'thinking-mode-test',
    'function-calling-weather',
    'combined-features-test',
    'function-calling-unit-converter',
    'chat-mode-test',
    'grounding-url-context'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 2559ms
 âœ“ Compiled /favicon.ico in 185ms (1311 modules)
 GET /favicon.ico 200 in 243ms
 âœ“ Compiled /api/documents/save in 182ms (1315 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:32.804Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 856ms
Debugger listening on ws://127.0.0.1:9230/e2443d0f-0eb6-48f1-b5a4-632e72e947f4
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1609ms
 â—‹ Compiling /w/[shortName]/[documentId] ...
 âœ“ Compiled /w/[shortName]/[documentId] in 2.6s (2149 modules)
 âœ“ Compiled in 308ms (854 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:43.110Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:43.212Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:43.383Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'combined-features-test',
    'final-summary',
    'chat-mode-test',
    'streaming-test',
    'function-calling-weather',
    'image-understanding-test',
    'code-execution-python',
    'grounding-url-context',
    'test-title',
    'document-understanding-test',
    'grounding-google-search',
    'function-calling-unit-converter',
    'function-calling-calculator',
    'thinking-mode-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'combined-features-test',
    'final-summary',
    'chat-mode-test',
    'streaming-test',
    'function-calling-weather',
    'image-understanding-test',
    'code-execution-python',
    'grounding-url-context',
    'test-title',
    'document-understanding-test',
    'grounding-google-search',
    'function-calling-unit-converter',
    'function-calling-calculator',
    'thinking-mode-test'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 4113ms
 âœ“ Compiled /favicon.ico in 305ms (1311 modules)
 GET /favicon.ico 200 in 370ms
 âœ“ Compiled /api/documents/save in 325ms (2156 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:47.408Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 1036ms
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 âœ“ Compiled /api/wizard/execute in 413ms (2315 modules)
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 275,
  temperature: 0.7,
  systemInstruction: 'You have Google Search grounding enabled. Use it to find current, up-to-date information. Do NOT gen...'
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:24:50.446Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 596ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1222,
  textPreview: 'Okay, I will use Google Search to find out what happened in Austria Vienna yesterday (October 16, 20...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 2944ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 260ms
 âœ“ Compiled /api/test-ai in 468ms (2311 modules)
 POST /api/test-ai 405 in 516ms
 POST /api/test-ai 405 in 3ms
 POST /api/test-ai 405 in 2ms
[TEST-AI] Starting test...
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 15,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 14,
  textPreview: 'Hello, world!\n...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: 'Hello, world!\n',
  usage: undefined,
  groundingMetadata: undefined
}
 HEAD /api/test-ai 200 in 556ms
 POST /api/test-ai 405 in 4ms
 POST /api/test-ai 405 in 3ms
 POST /api/test-ai 405 in 3ms
 âœ“ Compiled in 429ms (2325 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:33:40.040Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:33:40.446Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'image-understanding-test',
    'grounding-google-search',
    'grounding-url-context',
    'function-calling-unit-converter',
    'code-execution-python',
    'thinking-mode-test',
    'test-title',
    'streaming-test',
    'final-summary',
    'document-understanding-test',
    'combined-features-test',
    'function-calling-weather',
    'chat-mode-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'image-understanding-test',
    'grounding-google-search',
    'grounding-url-context',
    'function-calling-unit-converter',
    'code-execution-python',
    'thinking-mode-test',
    'test-title',
    'streaming-test',
    'final-summary',
    'document-understanding-test',
    'combined-features-test',
    'function-calling-weather',
    'chat-mode-test',
    'function-calling-calculator'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 1092ms
 âœ“ Compiled /favicon.ico in 104ms (1472 modules)
 GET /favicon.ico 200 in 123ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 3964,
  textPreview: 'Okay, here are three recent AI developments from this week (late October 2024), with sources:\n' +
    '\n' +
    '**1. ...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: 'Okay, here are three recent AI developments from this week (late October 2024), with sources:\n' +
    '\n' +
    '**1.  Google DeepMind Unveils "Gemini 1.5 Pro" with Enhanced Reasoning and Context Window:**\n' +
    '\n' +
    '*   **Development:** Google DeepMind has announced a significant upgrade to its Gemini 1.5 Pro model.  The key improvement is a dramatically expanded context window, reportedly capable of processing up to 2 million tokens. This allows the model to analyze and understand much larger documents, codebases, and even entire books at once.  They also claim improvements in reasoning, coding, and multi-modal understanding.\n' +
    "*   **Significance:**  A larger context window is a major step forward for AI's ability to handle complex tasks.  It allows for more nuanced understanding and reduces the need to break down large problems into smaller, less connected pieces. This could have a huge impact on areas like legal document analysis, software development, and scientific research.\n" +
    '*   **Source:**  Google DeepMind Blog Post: "[Gemini 1.5 Pro: Unlocking New Possibilities with a 2 Million Token Context Window](https://deepmind.google/discover/blog/gemini-1_5-pro-unlocking-new-possibilities-with-a-2-million-token-context-window/)" (Note: This is a hypothetical link, as I am an AI and cannot access the internet to provide a real link from late October 2024.  A real link would be found on the Google DeepMind blog.)\n' +
    '\n' +
    '**2.  Researchers Develop AI System for Automated Scientific Hypothesis Generation:**\n' +
    '\n' +
    '*   **Development:** A team at MIT and Harvard has published a paper detailing an AI system designed to automatically generate scientific hypotheses based on existing research data. The system, called "HypoGen," uses a combination of natural language processing and knowledge graph analysis to identify potential relationships and formulate testable hypotheses.  It then ranks these hypotheses based on their novelty and potential impact.\n' +
    '*   **Significance:**  This could accelerate the pace of scientific discovery by helping researchers identify promising avenues of investigation that they might otherwise miss.  It could also help to overcome biases in research by suggesting hypotheses that challenge existing assumptions.\n' +
    '*   **Source:**  MIT News: "[AI System Automates Scientific Hypothesis Generation](https://news.mit.edu/2024/ai-system-automates-scientific-hypothesis-generation-1027)" (Note: This is a hypothetical link. A real link would be found on the MIT News website.)\n' +
    '\n' +
    '**3.  OpenAI Releases "CodePilot X" - An AI-Powered Coding Assistant with Real-Time Collaboration Features:**\n' +
    '\n' +
    '*   **Development:** OpenAI has launched CodePilot X, the next generation of its AI-powered coding assistant.  This version includes enhanced code completion, debugging tools, and, most notably, real-time collaborative coding features.  Multiple developers can now work on the same codebase simultaneously, with CodePilot X providing suggestions and identifying potential conflicts in real-time.\n' +
    '*   **Significance:**  This could revolutionize software development by making it faster, more efficient, and more collaborative.  The real-time collaboration features could be particularly valuable for remote teams and open-source projects.\n' +
    '*   **Source:**  OpenAI Blog: "[Introducing CodePilot X: The Future of Collaborative Coding](https://openai.com/blog/codepilot-x)" (Note: This is a hypothetical link. A real link would be found on the OpenAI blog.)\n' +
    '\n' +
    '**Important Considerations:**\n' +
    '\n' +
    "*   **Hypothetical Links:**  As an AI, I cannot access the internet to provide real links from the future.  These links are placeholders.  You would need to search for these developments on the respective organizations' websites or in reputable tech news outlets.\n" +
    '*   **Rapid Pace of Change:** The field of AI is evolving extremely quickly.  These developments are based on my current knowledge and understanding of the trends, but the actual advancements in late October 2024 may differ.\n',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 5889ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday? Give me a brief summary.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.4
    }
  },
  "streamingSettings": {
    "enabled": true
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 63,
  temperature: 0.1,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1071,
  textPreview: "Okay, here's a quick rundown of some of the major world news stories from yesterday, October 26, 202...",
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Okay, here's a quick rundown of some of the major world news stories from yesterday, October 26, 2023:\n" +
    '\n' +
    '*   **Israel-Hamas Conflict:** The conflict continued with ongoing airstrikes and ground operations in Gaza. International concern is mounting over the humanitarian situation, with limited access to food, water, and medical supplies. Discussions continue regarding potential ceasefires or humanitarian pauses to allow aid to reach civilians.\n' +
    '*   **UN Security Council:** The UN Security Council discussed the Israel-Hamas conflict but failed to reach a consensus on a resolution.\n' +
    '*   **Economic News:** Economic data releases and central bank meetings continued to influence global markets.\n' +
    '*   **Ukraine War:** Fighting persisted in eastern Ukraine, with both sides claiming gains. Concerns remain about the upcoming winter and its impact on energy supplies and humanitarian needs.\n' +
    '\n' +
    '**Please note:** News is constantly evolving, and different sources may prioritize different stories. For the most up-to-date information, I recommend checking reputable news outlets.',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 2002ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "Tell me about recent developments in quantum computing.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "forceGoogleSearchGrounding": true,
  "systemInstructions": "Provide accurate, up-to-date information with proper citations."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 55,
  temperature: 0.1,
  systemInstruction: 'Provide accurate, up-to-date information with proper citations....'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 7378,
  textPreview: 'Quantum computing is a rapidly evolving field, and there have been many exciting developments recent...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Quantum computing is a rapidly evolving field, and there have been many exciting developments recently. Here's a breakdown of some key areas and specific examples:\n" +
    '\n' +
    '**1. Hardware Advancements:**\n' +
    '\n' +
    '*   **Increased Qubit Count and Quality:**\n' +
    '    *   **IBM:** Continues to release increasingly powerful quantum processors. They recently unveiled the **Eagle** processor with 127 qubits and are working towards even larger systems like the **Condor** (433 qubits) and beyond.  They are also focusing on improving qubit coherence times and reducing error rates.\n' +
    '    *   **Google:**  While details are often kept under wraps, Google continues to develop its superconducting qubit technology.  Their **Sycamore** processor was a landmark achievement, and they are working on scaling and improving its performance.\n' +
    '    *   **IonQ:**  Uses trapped ion technology, which offers high fidelity and long coherence times. They have been increasing the number of qubits in their systems and improving connectivity.  They are known for their all-to-all connectivity, meaning any qubit can interact with any other.\n' +
    '    *   **Rigetti:**  Focuses on superconducting qubits and has been working on multi-chip processors to scale up qubit counts.\n' +
    '    *   **Other Players:**  Companies like Xanadu (photonic qubits), PsiQuantum (photonic qubits), and ColdQuanta (neutral atom qubits) are also making significant progress with alternative qubit technologies.\n' +
    '\n' +
    '*   **Error Correction:**  A major hurdle in quantum computing is dealing with errors.  Recent research has focused on developing more robust error correction codes and implementing them in hardware.  While full-scale fault-tolerant quantum computers are still some way off, progress is being made in demonstrating error correction principles.\n' +
    '\n' +
    '*   **Cryogenics and Control Systems:**  Developing the infrastructure to support quantum computers is crucial.  This includes advanced cryogenic systems to cool qubits to near absolute zero and sophisticated control systems to manipulate and measure them.  Companies are working on improving the efficiency and scalability of these systems.\n' +
    '\n' +
    '**2. Software and Algorithms:**\n' +
    '\n' +
    '*   **Quantum Algorithm Development:**  Researchers are constantly developing new quantum algorithms that can outperform classical algorithms for specific tasks.  Areas of focus include:\n' +
    '    *   **Quantum Machine Learning:**  Developing quantum algorithms for machine learning tasks like classification, regression, and clustering.\n' +
    '    *   **Quantum Optimization:**  Using quantum algorithms to solve optimization problems in areas like finance, logistics, and materials science.\n' +
    '    *   **Quantum Simulation:**  Simulating the behavior of molecules and materials using quantum computers, which can lead to breakthroughs in drug discovery and materials design.\n' +
    "    *   **Shor's Algorithm:** While not new, continued research focuses on implementing Shor's algorithm (for factoring large numbers) on increasingly larger quantum computers.  This has implications for cryptography.\n" +
    "    *   **Grover's Algorithm:**  A quantum search algorithm that can provide a quadratic speedup over classical search algorithms.\n" +
    '\n' +
    '*   **Quantum Software Development Kits (SDKs):**  Companies like IBM (Qiskit), Google (Cirq), Microsoft (Q#), and Amazon (Braket) provide SDKs that allow developers to write and run quantum programs.  These SDKs are becoming more user-friendly and feature-rich.\n' +
    '\n' +
    '*   **Quantum Compilers:**  Quantum compilers translate high-level quantum programs into low-level instructions that can be executed on quantum hardware.  Researchers are working on improving the efficiency and performance of quantum compilers.\n' +
    '\n' +
    '**3. Applications and Use Cases:**\n' +
    '\n' +
    '*   **Drug Discovery:**  Quantum computers can be used to simulate the behavior of molecules and materials, which can accelerate the drug discovery process.\n' +
    '*   **Materials Science:**  Designing new materials with specific properties using quantum simulations.\n' +
    '*   **Finance:**  Developing quantum algorithms for financial modeling, risk management, and fraud detection.\n' +
    '*   **Logistics:**  Optimizing supply chains and transportation networks using quantum optimization algorithms.\n' +
    '*   **Cryptography:**  Developing quantum-resistant cryptographic algorithms to protect against attacks from future quantum computers.\n' +
    '\n' +
    '**4. Cloud-Based Quantum Computing:**\n' +
    '\n' +
    '*   **Accessibility:**  Cloud platforms like IBM Quantum Experience, Amazon Braket, and Azure Quantum provide access to quantum computers for researchers and developers.  This makes quantum computing more accessible to a wider audience.\n' +
    '*   **Hybrid Quantum-Classical Computing:**  Cloud platforms also enable hybrid quantum-classical computing, where quantum computers are used to accelerate specific parts of a classical computation.\n' +
    '\n' +
    '**5. Key Trends and Challenges:**\n' +
    '\n' +
    '*   **Scaling:**  Building quantum computers with a large number of qubits remains a major challenge.\n' +
    '*   **Error Correction:**  Developing robust error correction techniques is essential for building fault-tolerant quantum computers.\n' +
    '*   **Coherence:**  Maintaining the coherence of qubits (the ability to maintain quantum information) is crucial for performing complex computations.\n' +
    '*   **Quantum Supremacy/Advantage:**  Demonstrating that quantum computers can solve problems that are intractable for classical computers.  While Google claimed quantum supremacy in 2019, the debate continues about the practical significance of these demonstrations.\n' +
    '*   **Talent Gap:**  There is a shortage of skilled quantum computing researchers and developers.\n' +
    '*   **Standardization:**  Efforts are underway to standardize quantum programming languages and hardware interfaces.\n' +
    '\n' +
    '**Recent Specific Examples (Late 2023 - Early 2024):**\n' +
    '\n' +
    "*   **IBM's Roadmap:** IBM continues to execute its roadmap, releasing new processors and software updates.  They are heavily invested in building a full quantum computing stack.\n" +
    '*   **Increased Focus on Quantum Networking:**  Research into quantum communication and networking is gaining momentum, with the goal of connecting quantum computers over long distances.\n' +
    "*   **Advancements in Analog Quantum Computing:**  There's renewed interest in analog quantum computing approaches, which use continuous variables instead of discrete qubits.\n" +
    '*   **Quantum Sensing:**  Quantum sensors are being developed for a variety of applications, including medical imaging, environmental monitoring, and navigation.\n' +
    '\n' +
    '**In summary, quantum computing is making significant strides in hardware, software, and algorithms. While still in its early stages, the field has the potential to revolutionize many industries. The focus is now on scaling up qubit counts, improving qubit quality, developing practical quantum algorithms, and building a robust quantum computing ecosystem.**\n' +
    '\n' +
    'To stay up-to-date, I recommend following reputable sources like:\n' +
    '\n' +
    '*   **Quantum Computing Report:**  A leading news and analysis website.\n' +
    '*   **ArXiv:**  A repository for pre-prints of scientific papers.\n' +
    '*   **IEEE Quantum:**  A professional organization for quantum computing researchers.\n' +
    '*   **Nature and Science Journals:**  Publish cutting-edge research in quantum computing.\n' +
    '*   **Company Blogs:**  IBM Quantum, Google AI Blog, Microsoft Quantum Blog, etc.\n' +
    '\n' +
    'Keep in mind that the field is constantly evolving, so staying informed is key!\n',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 8903ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 3662,
  textPreview: 'Okay, here are three recent AI developments from this week (late October 2024), with sources:\n' +
    '\n' +
    '**1. ...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: 'Okay, here are three recent AI developments from this week (late October 2024), with sources:\n' +
    '\n' +
    '**1.  Meta AI Introduces V-JEPA: A New Self-Supervised Learning Approach for Computer Vision**\n' +
    '\n' +
    '*   **Development:** Meta AI has unveiled V-JEPA (Vision Joint Embedding Predictive Architecture), a novel self-supervised learning method for computer vision. Unlike traditional approaches that rely on pixel-level reconstruction, V-JEPA learns by predicting missing parts of an image from other parts, forcing the model to capture semantic understanding and contextual relationships. This approach is claimed to be more efficient and robust to adversarial attacks.\n' +
    '*   **Significance:** V-JEPA represents a shift towards more abstract and semantic-based learning in computer vision, potentially leading to more robust and generalizable AI models. It could improve performance in tasks like object recognition, image segmentation, and video understanding, especially in scenarios with limited labeled data.\n' +
    "*   **Source:** Meta AI Blog Post: [Hypothetical Link to Meta AI Blog Post about V-JEPA] (Note: Since this is a hypothetical week, I'm creating a placeholder link. A real link would point to the official Meta AI blog.)\n" +
    '\n' +
    '**2.  Google DeepMind Achieves Breakthrough in Protein Structure Prediction with AlphaFold 4**\n' +
    '\n' +
    '*   **Development:** Google DeepMind has announced AlphaFold 4, the latest iteration of its protein structure prediction AI. AlphaFold 4 demonstrates significantly improved accuracy and speed compared to previous versions, particularly for complex protein structures and protein-ligand interactions. It also incorporates the ability to predict protein dynamics and flexibility with greater precision.\n' +
    '*   **Significance:** This advancement has the potential to revolutionize drug discovery, materials science, and our understanding of fundamental biological processes. More accurate protein structure prediction can accelerate the development of new drugs, design novel materials with specific properties, and provide insights into the mechanisms of disease.\n' +
    '*   **Source:** Nature Journal Article: [Hypothetical Link to Nature Article on AlphaFold 4] (Again, this is a placeholder. A real link would point to the published article in Nature.)\n' +
    '\n' +
    '**3.  OpenAI Releases GPT-5 with Enhanced Reasoning and Multimodal Capabilities**\n' +
    '\n' +
    '*   **Development:** OpenAI has launched GPT-5, the successor to GPT-4. Key improvements include enhanced reasoning abilities, allowing the model to solve more complex problems and generate more coherent and logical responses. GPT-5 also boasts expanded multimodal capabilities, enabling it to seamlessly process and generate text, images, audio, and video.\n' +
    "*   **Significance:** GPT-5's enhanced reasoning and multimodal capabilities could unlock new applications in areas such as automated content creation, personalized education, scientific research, and human-computer interaction. The ability to handle multiple modalities opens up possibilities for more intuitive and engaging AI experiences.\n" +
    '*   **Source:** OpenAI Official Announcement: [Hypothetical Link to OpenAI Announcement about GPT-5] (Placeholder link. A real link would point to the official OpenAI announcement.)\n' +
    '\n' +
    '**Important Considerations:**\n' +
    '\n' +
    '*   **Hypothetical Scenario:**  Remember that these are hypothetical developments for late October 2024.  The actual advancements may differ.\n' +
    '*   **Source Verification:**  In a real-world scenario, always verify the information from multiple reputable sources before drawing conclusions.\n' +
    '*   **Rapid Pace of AI:**  The field of AI is evolving extremely rapidly. New breakthroughs are announced frequently.\n',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 4952ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday? Give me a brief summary.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.4
    }
  },
  "streamingSettings": {
    "enabled": true
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 63,
  temperature: 0.1,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1044,
  textPreview: "Okay, here's a quick rundown of some of the major world news stories from yesterday, October 26, 202...",
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Okay, here's a quick rundown of some of the major world news stories from yesterday, October 26, 2023:\n" +
    '\n' +
    '*   **Israel-Hamas Conflict:** The conflict continued with ongoing airstrikes and ground operations in Gaza. International concern is growing over the humanitarian situation, with limited access to food, water, and medical supplies. Discussions continue regarding potential ceasefires or humanitarian pauses to allow aid to reach civilians.\n' +
    '*   **UN Security Council:** The UN Security Council discussed the Israel-Hamas conflict but failed to reach a consensus on a resolution.\n' +
    '*   **Economic News:** Economic data releases and central bank meetings continued to influence global markets.\n' +
    '*   **Ukraine War:** Fighting persisted in eastern Ukraine, with both sides claiming gains. Concerns remain about the upcoming winter and its impact on energy supplies and humanitarian needs.\n' +
    '\n' +
    '**Please note:** News is constantly evolving, and this is just a brief snapshot. For the most up-to-date information, please refer to reputable news sources.',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 1507ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "Tell me about recent developments in quantum computing.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "forceGoogleSearchGrounding": true,
  "systemInstructions": "Provide accurate, up-to-date information with proper citations."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 55,
  temperature: 0.1,
  systemInstruction: 'Provide accurate, up-to-date information with proper citations....'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 8131,
  textPreview: 'Quantum computing is a rapidly evolving field, and there have been many exciting developments recent...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Quantum computing is a rapidly evolving field, and there have been many exciting developments recently. Here's a breakdown of some key areas and specific advancements:\n" +
    '\n' +
    '**1. Hardware Advancements (Qubit Development):**\n' +
    '\n' +
    "*   **Increased Qubit Count:**  Companies like IBM, Google, and IonQ are consistently pushing the boundaries of qubit count.  While the exact numbers fluctuate and are often accompanied by caveats about coherence and connectivity, the trend is undeniably upward.  IBM's Osprey processor (433 qubits) and Condor (1121 qubits) are notable examples.  However, simply having more qubits isn't enough; quality and connectivity are crucial.\n" +
    '*   **Improved Qubit Coherence and Fidelity:**  Maintaining qubit coherence (the ability to maintain quantum states) for longer periods and improving gate fidelity (the accuracy of quantum operations) are critical for complex computations.  Significant progress is being made in these areas through improved materials, control techniques, and error mitigation strategies.  For example, researchers are exploring new materials and fabrication techniques to reduce noise and improve qubit stability.\n' +
    '*   **Diverse Qubit Technologies:**  The field is exploring various qubit technologies, each with its own strengths and weaknesses:\n' +
    '    *   **Superconducting Qubits:**  Dominated by IBM, Google, and others.  They are relatively easy to fabricate and control but can be sensitive to noise.\n' +
    '    *   **Trapped Ions:**  Pioneered by IonQ and others.  They offer high fidelity and long coherence times but can be more complex to scale.\n' +
    '    *   **Neutral Atoms:**  Becoming increasingly promising, with companies like ColdQuanta and Atom Computing making strides.  They offer good scalability and coherence.\n' +
    '    *   **Photonic Qubits:**  Using photons as qubits.  They offer potential for room-temperature operation and long-distance communication but can be challenging to control.\n' +
    '    *   **Silicon Qubits:**  Leveraging existing semiconductor manufacturing infrastructure.  They offer potential for scalability and integration with classical electronics.\n' +
    '*   **Error Correction:**  Quantum error correction is essential for building fault-tolerant quantum computers.  Researchers are developing and testing various error correction codes and techniques.  While a fully fault-tolerant quantum computer is still some way off, progress is being made in demonstrating the feasibility of error correction.\n' +
    '\n' +
    '**2. Software and Algorithm Development:**\n' +
    '\n' +
    '*   **Quantum Algorithm Development:**  Researchers are constantly developing new quantum algorithms and improving existing ones.  Areas of focus include:\n' +
    '    *   **Quantum Simulation:**  Simulating molecules, materials, and other quantum systems.  This has potential applications in drug discovery, materials science, and fundamental physics.\n' +
    '    *   **Quantum Optimization:**  Solving optimization problems, such as those found in logistics, finance, and machine learning.\n' +
    '    *   **Quantum Machine Learning:**  Developing quantum algorithms for machine learning tasks, such as classification, regression, and clustering.\n' +
    '    *   **Quantum Cryptography:**  Developing secure communication protocols based on quantum mechanics.\n' +
    '*   **Quantum Software Development Kits (SDKs):**  Companies like IBM (Qiskit), Google (Cirq/TensorFlow Quantum), and Microsoft (Q#) provide SDKs that allow developers to write and run quantum programs.  These SDKs are becoming more user-friendly and feature-rich.\n' +
    '*   **Quantum Compilers:**  Quantum compilers translate high-level quantum programs into low-level instructions that can be executed on quantum hardware.  Researchers are working on improving the efficiency and performance of quantum compilers.\n' +
    '*   **Quantum Cloud Platforms:**  Companies like IBM, Amazon (Braket), Google, and Microsoft offer cloud-based access to quantum computers.  This allows researchers and developers to experiment with quantum computing without having to invest in their own hardware.\n' +
    '\n' +
    '**3. Applications and Use Cases:**\n' +
    '\n' +
    '*   **Drug Discovery and Materials Science:**  Quantum computers are being used to simulate molecules and materials, which can accelerate the discovery of new drugs and materials.\n' +
    '*   **Financial Modeling:**  Quantum computers are being explored for applications in financial modeling, such as portfolio optimization and risk management.\n' +
    '*   **Logistics and Supply Chain Optimization:**  Quantum computers can be used to optimize logistics and supply chains, such as routing vehicles and managing inventory.\n' +
    '*   **Cryptography:**  Quantum computers pose a threat to current encryption methods, but they can also be used to develop new, quantum-resistant encryption methods.\n' +
    '*   **Fundamental Science:**  Quantum computers are being used to study fundamental questions in physics, such as the nature of dark matter and the origin of the universe.\n' +
    '\n' +
    '**4. Key Recent Specific Developments (Examples):**\n' +
    '\n' +
    "*   **IBM's Roadmap:** IBM continues to release increasingly powerful quantum processors and has a roadmap for achieving fault-tolerant quantum computing.  Their focus is on building a full-stack quantum computing ecosystem.\n" +
    "*   **IonQ's Trapped Ion Advances:** IonQ has demonstrated high-fidelity quantum gates and is working on scaling up its trapped ion quantum computers.\n" +
    `*   **Google's Quantum Supremacy Claims (and Subsequent Refinements):** While the initial "quantum supremacy" claim was debated, Google continues to push the boundaries of what quantum computers can do.  The focus is now on demonstrating practical quantum advantage.\n` +
    '*   **Amazon Braket and Azure Quantum:**  These cloud platforms are expanding their offerings, providing access to a wider range of quantum hardware and software tools.\n' +
    '*   **Increased Government and Private Investment:**  Governments and private companies are investing heavily in quantum computing research and development.  This is driving innovation and accelerating the pace of progress.\n' +
    '*   **Standardization Efforts:**  Organizations like IEEE and ISO are working on developing standards for quantum computing, which will help to ensure interoperability and accelerate the adoption of the technology.\n' +
    '\n' +
    '**Challenges and Future Directions:**\n' +
    '\n' +
    'Despite the significant progress, quantum computing still faces many challenges:\n' +
    '\n' +
    '*   **Scalability:**  Building quantum computers with a large number of qubits remains a major challenge.\n' +
    '*   **Coherence:**  Maintaining qubit coherence for long enough to perform complex computations is difficult.\n' +
    '*   **Fidelity:**  Improving the accuracy of quantum operations is essential for building fault-tolerant quantum computers.\n' +
    '*   **Error Correction:**  Developing and implementing effective quantum error correction codes is crucial.\n' +
    '*   **Algorithm Development:**  More quantum algorithms are needed to solve real-world problems.\n' +
    '*   **Software Development Tools:**  Quantum software development tools need to be more user-friendly and feature-rich.\n' +
    '*   **Talent Gap:**  There is a shortage of skilled quantum computing researchers and developers.\n' +
    '\n' +
    'The future of quantum computing is bright, but it will require continued innovation and collaboration to overcome these challenges.  The field is moving towards:\n' +
    '\n' +
    '*   **Hybrid Quantum-Classical Computing:**  Combining quantum computers with classical computers to solve problems that are beyond the capabilities of either alone.\n' +
    '*   **Fault-Tolerant Quantum Computing:**  Building quantum computers that can correct errors and perform complex computations reliably.\n' +
    '*   **Quantum Networks:**  Connecting quantum computers together to form quantum networks, which will enable new applications such as secure communication and distributed quantum computing.\n' +
    '*   **Quantum Sensing:**  Using quantum phenomena to develop new sensors with unprecedented sensitivity and accuracy.\n' +
    '\n' +
    "Keep an eye on publications from leading research institutions, companies like IBM, Google, IonQ, Rigetti, and D-Wave (though D-Wave's approach is different, focusing on quantum annealing), and government initiatives for the latest breakthroughs.  The field is constantly evolving!\n",
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 9204ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday?",
  "forceGoogleSearchGrounding": true
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 38,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1079,
  textPreview: "Here's a quick rundown of some of the major world news stories from yesterday, October 26, 2023:\n" +
    '\n' +
    '* ...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Here's a quick rundown of some of the major world news stories from yesterday, October 26, 2023:\n" +
    '\n' +
    '*   **Israel-Hamas Conflict:** The conflict continued to dominate headlines. There were reports of ongoing airstrikes and ground operations by Israel in Gaza. Humanitarian concerns remained high, with limited access to aid and essential supplies for civilians. Discussions continued regarding potential ceasefires or humanitarian pauses, but no major breakthroughs were announced.\n' +
    '*   **Ukraine War:** Fighting continued in eastern Ukraine. Reports focused on intense battles around Avdiivka. Concerns remained about the upcoming winter and the potential impact on energy infrastructure.\n' +
    "*   **China Leadership Changes:** China's Communist Party continued its meetings, with speculation about potential shifts in leadership and policy direction.\n" +
    '*   **Economic News:** Economic data releases and central bank decisions were closely watched for signs of inflation and potential recession risks.\n' +
    '*   **Pakistan Elections:** Pakistan announced it would hold elections in January 2024.',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 1998ms
 âœ“ Compiled in 402ms (2150 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:39:18.982Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'document-understanding-test',
    'function-calling-calculator',
    'streaming-test',
    'image-understanding-test',
    'grounding-google-search',
    'test-title',
    'thinking-mode-test',
    'grounding-url-context',
    'combined-features-test',
    'function-calling-weather',
    'final-summary',
    'chat-mode-test',
    'function-calling-unit-converter',
    'code-execution-python'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'document-understanding-test',
    'function-calling-calculator',
    'streaming-test',
    'image-understanding-test',
    'grounding-google-search',
    'test-title',
    'thinking-mode-test',
    'grounding-url-context',
    'combined-features-test',
    'function-calling-weather',
    'final-summary',
    'chat-mode-test',
    'function-calling-unit-converter',
    'code-execution-python'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 463ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:39:19.324Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled /favicon.ico in 103ms (1311 modules)
 GET /favicon.ico 200 in 158ms
 âœ“ Compiled /api/test-ai in 395ms (1470 modules)
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:44.870Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-unit-converter',
    'function-calling-calculator',
    'document-understanding-test',
    'test-title',
    'grounding-url-context',
    'final-summary',
    'chat-mode-test',
    'thinking-mode-test',
    'combined-features-test',
    'function-calling-weather',
    'image-understanding-test',
    'code-execution-python',
    'grounding-google-search',
    'streaming-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-unit-converter',
    'function-calling-calculator',
    'document-understanding-test',
    'test-title',
    'grounding-url-context',
    'final-summary',
    'chat-mode-test',
    'thinking-mode-test',
    'combined-features-test',
    'function-calling-weather',
    'image-understanding-test',
    'code-execution-python',
    'grounding-google-search',
    'streaming-test'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 534ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:45.232Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1920,
  textPreview: 'Okay, I will provide you with 3 specific examples of the latest AI developments this week.\n' +
    '\n' +
    'Here are...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: 'Okay, I will provide you with 3 specific examples of the latest AI developments this week.\n' +
    '\n' +
    'Here are three specific examples of recent AI developments:\n' +
    '\n' +
    "1.  **Meta's V-JEPA 2: Improving AI Physical Reasoning:** Meta has introduced V-JEPA 2, a new world model that enhances visual understanding and prediction in the physical world, thereby improving the physical reasoning of AI agents. This model, trained on video, enables robots and AI agents to understand the physical world and predict how it will respond to their actions. V-JEPA 2 helps AI agents mimic human intelligence, making them smarter about the physical world. In addition to releasing V-JEPA 2, Meta is sharing three new benchmarks to help the research community evaluate how well their existing models learn and reason about the world using video. (Source: [https://about.fb.com/wp-content/uploads/2025/06/01\\_VJEPA2.mp4](https://about.fb.com/wp-content/uploads/2025/06/01_VJEPA2.mp4), [10])\n" +
    '2.  **AI-Powered Agents with Greater Autonomy:** AI-powered agents are evolving to handle more complex tasks with greater autonomy, simplifying tasks at home and work. These agents can interpret customer requests, retrieve information, and provide personalized responses without human intervention. Gartner forecasts that agentic AI will be integrated into 33% of enterprise software applications in 2028, compared to less than 1% in 2024. (Source: [2])\n' +
    '3.  **Advancements in Large Language Models (LLMs):** The emergence of advanced Large Language Models (LLMs 3.0) marks a pivotal moment in AI evolution. These systems are revolutionizing how machines understand and interact with the world, integrating various forms of communication such as processing and generating images, videos, and audio. LLMs 3.0 demonstrate complex logical reasoning, sophisticated pattern recognition, and advanced mathematical and scientific problem-solving skills. (Source: [3])\n' +
    '\n',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 6387ms
 â—‹ Compiling / ...
 âœ“ Compiled / in 834ms (2346 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday? Give me a brief summary.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.4
    }
  },
  "streamingSettings": {
    "enabled": true
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 63,
  temperature: 0.1,
  systemInstruction: 'undefined...'
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:51.313Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:51.452Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
 GET / 200 in 1302ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'chat-mode-test',
    'thinking-mode-test',
    'function-calling-unit-converter',
    'function-calling-weather',
    'function-calling-calculator',
    'code-execution-python',
    'test-title',
    'final-summary',
    'grounding-url-context',
    'image-understanding-test',
    'combined-features-test',
    'document-understanding-test',
    'grounding-google-search',
    'streaming-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'chat-mode-test',
    'thinking-mode-test',
    'function-calling-unit-converter',
    'function-calling-weather',
    'function-calling-calculator',
    'code-execution-python',
    'test-title',
    'final-summary',
    'grounding-url-context',
    'image-understanding-test',
    'combined-features-test',
    'document-understanding-test',
    'grounding-google-search',
    'streaming-test'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 688ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:52.003Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 â—‹ Compiling /dashboard ...
 âœ“ Compiled /dashboard in 520ms (2370 modules)
 GET /dashboard 200 in 568ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 891,
  textPreview: "Here's a brief summary of world news from yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Conflict:** T...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Here's a brief summary of world news from yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Conflict:** Tensions remain high as both countries continue to exchange attacks. Iran launched a fresh missile barrage on Israel, while Israel struck back with airstrikes on Tehran.\n' +
    "*   **Nigeria:** Gunmen killed at least 100 people in Nigeria's Benue state, according to Amnesty International.\n" +
    '*   **G7 Summit:** The G7 leaders are gathering in Canada for a summit amid the Mideast crisis and trade tensions.\n' +
    '*   **US Military Parade:** A massive military parade took place in Washington D.C., with President Trump paying tribute to the U.S. military.\n' +
    "*   **Club World Cup:** Al Ahly held Messi's Inter Miami to a 0-0 draw in the opening match of the FIFA Club World Cup.\n" +
    '*   **Minnesota Shooting:** A shooting targeting Minnesota lawmakers is being investigated as a possible act of political violence.',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 2795ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "Tell me about recent developments in quantum computing.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "forceGoogleSearchGrounding": true,
  "systemInstructions": "Provide accurate, up-to-date information with proper citations."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 55,
  temperature: 0.1,
  systemInstruction: 'Provide accurate, up-to-date information with proper citations....'
}
 âœ“ Compiled /w/[shortName]/new in 303ms (2372 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:56.699Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:56.752Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[NewDocumentPage] STEP 1: Page accessed { shortName: 'gemini-test' }
[NewDocumentPage] STEP 2: Workflow found {
  shortName: 'gemini-test',
  workflowId: 'gemini-tools-test',
  workflowName: 'Gemini AI Tools Test'
}
[NewDocumentPage] STEP 3: Generated document ID {
  shortName: 'gemini-test',
  documentId: 'mbxh6ibcwbxko51',
  workflowId: 'gemini-tools-test'
}
[NewDocumentPage] STEP 4: Starting document creation in Firestore
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: null,
  title: 'New Gemini AI Tools Test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [],
  stageStatesCount: 0,
  hasUserId: false,
  isNewDocument: true
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: undefined,
  effectiveUserId: 'server_user_1749980456760_u4bqhx7yi',
  wasGenerated: true
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [],
  originalCount: 0,
  cleanedKeys: [],
  cleanedCount: 0
}
[DocumentPersistence] STEP 6: Creating NEW document (documentId is null)
[DocumentPersistence] STEP 7: Prepared document data for creation {
  userId: 'server_user_1749980456760_u4bqhx7yi',
  title: 'New Gemini AI Tools Test',
  workflowId: 'gemini-tools-test',
  status: 'draft',
  stageStatesCount: 0,
  metadata: { wordCount: 0, stageCount: 0 }
}
[DocumentPersistence] STEP 8: Calling Firestore adapter to create document
[FirestoreAdapter] STEP 1: Starting document creation {
  collection: 'documents',
  dataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata'
  ],
  dataSize: 192
}
[FirestoreAdapter] STEP 2: Generated document reference {
  collection: 'documents',
  id: 'BHAtTG1NpuXc1Q6PDDep',
  path: 'documents/BHAtTG1NpuXc1Q6PDDep'
}
[FirestoreAdapter] STEP 3: Prepared document data {
  collection: 'documents',
  id: 'BHAtTG1NpuXc1Q6PDDep',
  finalDataKeys: [
    'userId',
    'title',
    'workflowId',
    'status',
    'stageStates',
    'metadata',
    'id',
    'createdAt',
    'updatedAt'
  ],
  hasStageStates: true,
  stageStatesKeys: []
}
[FirestoreAdapter] STEP 4: Calling setDoc on Firestore
[FirestoreAdapter] STEP 5: Document created successfully in Firestore { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document created { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] STEP 9: Document creation completed successfully {
  createdDocumentId: 'BHAtTG1NpuXc1Q6PDDep',
  collectionName: 'documents'
}
[DocumentPersistence] Document created successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[NewDocumentPage] STEP 5: Document creation result {
  success: true,
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  error: undefined,
  originalId: 'mbxh6ibcwbxko51'
}
[NewDocumentPage] STEP 6: Document created successfully in Firestore {
  originalId: 'mbxh6ibcwbxko51',
  createdId: 'BHAtTG1NpuXc1Q6PDDep',
  workflowId: 'gemini-tools-test'
}
[NewDocumentPage] STEP 7: Initiating redirect to wizard page { targetUrl: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep' }
[NewDocumentPage] STEP 8: Caught exception {
  errorName: 'Error',
  errorMessage: 'NEXT_REDIRECT',
  isNextRedirect: true
}
[NewDocumentPage] STEP 9: This is a Next.js redirect - letting it through
 GET /w/gemini-test/new 200 in 1174ms
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'New Gemini AI Tools Test',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'New Gemini AI Tools Test',
  stageCount: 0,
  validatedStageIds: []
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'New Gemini AI Tools Test',
  stageStatesCount: 0,
  stageStatesKeys: []
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'New Gemini AI Tools Test',
  stageCount: 0,
  validatedStageIds: []
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 163ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 141ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:57.633Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled /api/documents/save in 260ms (1516 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:40:59.926Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'New Gemini AI Tools Test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 803ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 5919,
  textPreview: 'Quantum computing is rapidly evolving, with breakthroughs emerging from academic labs, tech giants, ...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Quantum computing is rapidly evolving, with breakthroughs emerging from academic labs, tech giants, and startups. Here's a summary of recent developments:\n" +
    '\n' +
    '**Hardware Advancements:**\n' +
    '\n' +
    '*   **Qubit Development:** Companies like IBM, Google, Intel, Rigetti, and IonQ are increasing the number of qubits in their processors, enhancing qubit coherence time, and improving error rates and quantum volume. Some processors have reached over 1000 qubits.\n' +
    "*   **IBM's Processors:** IBM has been actively developing quantum processors. The Flamingo quantum processor was released in 2024. IBM is also working towards the Kookaburra, expected in 2025, which will be a 4,158-qubit system formed by linking three chips together.\n" +
    "*   **Google's Willow Processor:** Google launched its Willow quantum chip in December 2024. It's a 105-qubit superconducting processor with strong error correction improvements.\n" +
    "*   **Microsoft's Topological Qubits:** Microsoft unveiled a quantum processor powered by topological qubits.\n" +
    '*   **Quantum Foundries:** There is progress in building quantum foundries, which are facilities designed for the scalable production of qubits.\n' +
    '\n' +
    '**Quantum Supremacy and Error Correction:**\n' +
    '\n' +
    "*   **Google's Sycamore Processor:** Google's Sycamore processor achieved quantum supremacy in 2019 with a 54-qubit system, solving tasks exponentially faster than classical computers.\n" +
    "*   **Willow Processor's Error Correction:** Google's Willow processor achieved exponential error correction, reducing errors as qubits scale.\n" +
    '\n' +
    '**Quantum Software and Cloud Services:**\n' +
    '\n' +
    '*   **Quantum Cloud Platforms:** Platforms like IBM Quantum, Amazon Braket, Microsoft Azure Quantum, and Google Cirq are making quantum computing resources more accessible.\n' +
    '*   **Quantum Operating Systems:** IonQ announced its IonQ Quantum OS and new tools for its IonQ Hybrid Suite.\n' +
    "*   **CUDA-Q Platform:** Nvidia's open-source quantum development environment, CUDA-Q Platform, will be added to Amazon Braket to combine with classical cloud compute resources.\n" +
    '\n' +
    '**Quantum Communication and Networking:**\n' +
    '\n' +
    '*   **Quantum Network Engineering:** Researchers have made breakthroughs in quantum network engineering by "stretching" thin films of diamond to create quantum bits that can operate with significantly reduced equipment and expense.\n' +
    '*   **Quantum Bits Transfer:** Researchers from the University of Sussex and Universal Quantum have made strides in transferring quantum bits (qubits) between quantum computer microchips.\n' +
    '*   **Quantum Communication Over Subsea Cable:** Quantum communication has been demonstrated over a subsea optical fiber cable.\n' +
    '*   **Quantum Teleportation:** Researchers at Oxford University have successfully linked two independent quantum processors using a photonic network interface via quantum teleportation.\n' +
    '\n' +
    '**Quantum Algorithms and Machine Learning:**\n' +
    '\n' +
    '*   **Quantum Machine Learning:** Quantum-as-a-service (QaaS) has expanded access to quantum computing, enabling breakthroughs in quantum machine learning. Researchers are developing quantum neural networks, quantum support vector machines, and quantum algorithms for complex tasks like image and natural language processing\n' +
    "*   **Shor's Algorithm:** Shor's algorithm, a quantum algorithm capable of factoring large numbers exponentially faster than classical algorithms, has continued to garner attention.\n" +
    '\n' +
    '**Quantum Security and Cryptography:**\n' +
    '\n' +
    '*   **Post-Quantum Cryptography:** With the ability to break current encryption methods, quantum computing is pressuring governments and industries to adopt quantum-safe encryption. NIST is finalizing its recommended post-quantum cryptographic algorithms.\n' +
    "*   **Quantum-Safe Technology:** TelefÃ³nica Tech and IBM have partnered to integrate IBM's quantum-safe technology into TelefÃ³nica's cybersecurity services. Vodafone and IBM are collaborating to enhance smartphone security using quantum-safe cryptography.\n" +
    '\n' +
    '**Real-World Applications:**\n' +
    '\n' +
    '*   **Drug Discovery:** Pharmaceutical companies are advancing disease research and quantum-enabled drug discovery.\n' +
    '*   **Automotive and Aerospace:** Quantum computing is being used to improve the performance of hydrogen fuel cell catalysts and electric batteries mobility.\n' +
    '*   **Financial Services:** Quantum computing is being applied to financial modeling and risk analysis.\n' +
    "*   **Optimization Problems:** D-Wave's annealing quantum computers are delivering results for customers in solving optimization problems.\n" +
    '*    **Materials Development:** Quantum computing is being used to accelerate insights in new material development.\n' +
    '\n' +
    '**Investments and Collaborations:**\n' +
    '\n' +
    '*   **Government Funding:** Governments worldwide are investing in quantum technology. China, Germany, the United Kingdom, the United States, and South Korea lead in public investments.\n' +
    '*   **Strategic Partnerships:** The University of Chicago has formalized agreements with IBM, the University of Tokyo, and Google to develop quantum technology. IBM and Pasqal are collaborating to create a unified software architecture that integrates classical and quantum computing. Nvidia is partnering with Google to design quantum computing processors.\n' +
    '\n' +
    '**Overall Trends:**\n' +
    '\n' +
    '*   **Transition to Practical Application:** Quantum computing is transitioning from theory to practical application.\n' +
    '*   **Quantum AI Synergy:** The intersection of quantum computing and artificial intelligence is positioned to grow, with AI helping quantum computing and quantum computing powering AI models.\n' +
    '*   **Quantum Technology Beyond Computing:** Quantum sensing and quantum communication are delivering immediate value in areas like navigation, medical imaging, and secure data transfer.\n' +
    '\n' +
    'While some experts believe that quantum computing is still a decade away from broad-scale applications, others argue that the quantum era has already begun, with real-world, commercially viable applications emerging in various industries.\n',
  usage: undefined,
  groundingMetadata: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 7594ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 213ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 188ms
 âœ“ Compiled /api/wizard/execute in 211ms (1518 modules)
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 267,
  temperature: 0.7,
  systemInstruction: 'You have Google Search grounding enabled. Use it to find current, up-to-date information. Do NOT gen...'
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:16.360Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-calculator',
    'document-understanding-test',
    'function-calling-unit-converter',
    'test-title',
    'grounding-url-context',
    'thinking-mode-test',
    'code-execution-python',
    'function-calling-weather',
    'streaming-test',
    'final-summary',
    'combined-features-test',
    'grounding-google-search',
    'chat-mode-test',
    'image-understanding-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-calculator',
    'document-understanding-test',
    'function-calling-unit-converter',
    'test-title',
    'grounding-url-context',
    'thinking-mode-test',
    'code-execution-python',
    'function-calling-weather',
    'streaming-test',
    'final-summary',
    'combined-features-test',
    'grounding-google-search',
    'chat-mode-test',
    'image-understanding-test'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'document-understanding-test',
    'test-title',
    'image-understanding-test',
    'function-calling-unit-converter',
    'combined-features-test',
    'streaming-test',
    'grounding-url-context',
    'grounding-google-search',
    'thinking-mode-test',
    'final-summary',
    'function-calling-weather',
    'code-execution-python',
    'chat-mode-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'document-understanding-test',
    'test-title',
    'image-understanding-test',
    'function-calling-unit-converter',
    'combined-features-test',
    'streaming-test',
    'grounding-url-context',
    'grounding-google-search',
    'thinking-mode-test',
    'final-summary',
    'function-calling-weather',
    'code-execution-python',
    'chat-mode-test',
    'function-calling-calculator'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 336ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 338ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:16.790Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 306ms
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1185,
  textPreview: 'Yesterday, June 11, 2025, Austria was in a period of national mourning following a school shooting i...',
  usageMetadata: undefined,
  finishReason: undefined
}
 POST /api/wizard/execute 200 in 3413ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 194ms
 âœ“ Compiled in 607ms (1518 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:28.443Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'grounding-url-context',
    'chat-mode-test',
    'document-understanding-test',
    'thinking-mode-test',
    'final-summary',
    'combined-features-test',
    'function-calling-weather',
    'function-calling-calculator',
    'grounding-google-search',
    'test-title',
    'code-execution-python',
    'image-understanding-test',
    'function-calling-unit-converter',
    'streaming-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'grounding-url-context',
    'chat-mode-test',
    'document-understanding-test',
    'thinking-mode-test',
    'final-summary',
    'combined-features-test',
    'function-calling-weather',
    'function-calling-calculator',
    'grounding-google-search',
    'test-title',
    'code-execution-python',
    'image-understanding-test',
    'function-calling-unit-converter',
    'streaming-test'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-unit-converter',
    'grounding-google-search',
    'final-summary',
    'thinking-mode-test',
    'code-execution-python',
    'combined-features-test',
    'grounding-url-context',
    'image-understanding-test',
    'function-calling-weather',
    'chat-mode-test',
    'test-title',
    'streaming-test',
    'document-understanding-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-unit-converter',
    'grounding-google-search',
    'final-summary',
    'thinking-mode-test',
    'code-execution-python',
    'combined-features-test',
    'grounding-url-context',
    'image-understanding-test',
    'function-calling-weather',
    'chat-mode-test',
    'test-title',
    'streaming-test',
    'document-understanding-test',
    'function-calling-calculator'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 392ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 394ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:28.965Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled in 252ms (1518 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:36.280Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'thinking-mode-test',
    'final-summary',
    'code-execution-python',
    'grounding-google-search',
    'document-understanding-test',
    'chat-mode-test',
    'grounding-url-context',
    'function-calling-weather',
    'image-understanding-test',
    'function-calling-unit-converter',
    'combined-features-test',
    'test-title',
    'streaming-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'thinking-mode-test',
    'final-summary',
    'code-execution-python',
    'grounding-google-search',
    'document-understanding-test',
    'chat-mode-test',
    'grounding-url-context',
    'function-calling-weather',
    'image-understanding-test',
    'function-calling-unit-converter',
    'combined-features-test',
    'test-title',
    'streaming-test',
    'function-calling-calculator'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'combined-features-test',
    'code-execution-python',
    'final-summary',
    'function-calling-weather',
    'document-understanding-test',
    'grounding-url-context',
    'function-calling-calculator',
    'test-title',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'thinking-mode-test',
    'function-calling-unit-converter',
    'grounding-google-search'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'combined-features-test',
    'code-execution-python',
    'final-summary',
    'function-calling-weather',
    'document-understanding-test',
    'grounding-url-context',
    'function-calling-calculator',
    'test-title',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'thinking-mode-test',
    'function-calling-unit-converter',
    'grounding-google-search'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 359ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 358ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:36.744Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled in 340ms (2390 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:42.820Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'chat-mode-test',
    'code-execution-python',
    'combined-features-test',
    'test-title',
    'final-summary',
    'image-understanding-test',
    'document-understanding-test',
    'function-calling-calculator',
    'streaming-test',
    'function-calling-weather',
    'grounding-google-search',
    'grounding-url-context',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'chat-mode-test',
    'code-execution-python',
    'combined-features-test',
    'test-title',
    'final-summary',
    'image-understanding-test',
    'document-understanding-test',
    'function-calling-calculator',
    'streaming-test',
    'function-calling-weather',
    'grounding-google-search',
    'grounding-url-context',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'image-understanding-test',
    'chat-mode-test',
    'function-calling-weather',
    'streaming-test',
    'test-title',
    'thinking-mode-test',
    'final-summary',
    'function-calling-unit-converter',
    'function-calling-calculator',
    'grounding-url-context',
    'combined-features-test',
    'code-execution-python',
    'document-understanding-test',
    'grounding-google-search'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'image-understanding-test',
    'chat-mode-test',
    'function-calling-weather',
    'streaming-test',
    'test-title',
    'thinking-mode-test',
    'final-summary',
    'function-calling-unit-converter',
    'function-calling-calculator',
    'grounding-url-context',
    'combined-features-test',
    'code-execution-python',
    'document-understanding-test',
    'grounding-google-search'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 348ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 348ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:41:43.288Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday?",
  "forceGoogleSearchGrounding": true
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 38,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1254,
  textPreview: "Here's a summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Tension...',
  usageMetadata: undefined,
  finishReason: undefined
}
[TEST-AI] Result: {
  content: "Here's a summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Tensions:** Tensions between Israel and Iran escalated with missile exchanges. Israel conducted strikes on Iran, including targeting gas fields, while Iran retaliated with missile strikes near Tel Aviv and other cities in Israel. Casualties were reported on both sides.\n' +
    '*   **Nigeria Attack:** At least 100 people were killed by gunmen in a village attack in north-central Nigeria, according to Amnesty International.\n' +
    '*   **US-Iran Relations:** Amid the escalating tensions between Israel and Iran, former US President Trump issued a warning to Iran, stating the "full strength of US Forces will come down on you".\n' +
    "*   **Air India Plane Crash:** King Charles is set to honor the victims of the Air India plane crash at the Trooping the Colour parade. In addition, the son of one of the plane crash victims said he'll relive his mother's last moments 'to the day I die'.\n" +
    '*   **Minnesota Shooting:** A manhunt is underway in Minnesota for a suspect in the deadly shooting of Democratic lawmakers.\n' +
    '*   **Typhoon Wutip:** Typhoon Wutip caused five deaths and left two missing in central Vietnam, with farmlands flooded. The typhoon has also reached southern China.\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 3104ms
 âœ“ Compiled in 182ms (1474 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:42:07.459Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'final-summary',
    'streaming-test',
    'test-title',
    'function-calling-weather',
    'chat-mode-test',
    'function-calling-unit-converter',
    'function-calling-calculator',
    'grounding-google-search',
    'image-understanding-test',
    'document-understanding-test',
    'thinking-mode-test',
    'grounding-url-context',
    'combined-features-test',
    'code-execution-python'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'final-summary',
    'streaming-test',
    'test-title',
    'function-calling-weather',
    'chat-mode-test',
    'function-calling-unit-converter',
    'function-calling-calculator',
    'grounding-google-search',
    'image-understanding-test',
    'document-understanding-test',
    'thinking-mode-test',
    'grounding-url-context',
    'combined-features-test',
    'code-execution-python'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'code-execution-python',
    'thinking-mode-test',
    'grounding-url-context',
    'test-title',
    'document-understanding-test',
    'function-calling-calculator',
    'image-understanding-test',
    'final-summary',
    'chat-mode-test',
    'function-calling-unit-converter',
    'combined-features-test',
    'function-calling-weather',
    'grounding-google-search',
    'streaming-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'code-execution-python',
    'thinking-mode-test',
    'grounding-url-context',
    'test-title',
    'document-understanding-test',
    'function-calling-calculator',
    'image-understanding-test',
    'final-summary',
    'chat-mode-test',
    'function-calling-unit-converter',
    'combined-features-test',
    'function-calling-weather',
    'grounding-google-search',
    'streaming-test'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 398ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 398ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:42:08.027Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday?",
  "forceGoogleSearchGrounding": true
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 38,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1122,
  textPreview: "Here's a summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Conflic...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 4
}
[TEST-AI] Result: {
  content: "Here's a summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Conflict:** Tensions escalated with continued attacks between Israel and Iran. Israel claimed to have conducted "extensive strikes" on the Iranian Defence Ministry headquarters and a nuclear project. There are reports of missile strikes and damage to a nuclear site in Iran.\n' +
    '*   **Air India Tragedy:** Investigations are underway following the Air India plane crash. The King of England, Charles III, is set to honor the victims at the Trooping the Colour parade.\n' +
    '*   **Nigeria Attack:** Amnesty International reported that at least 100 people were killed by gunmen in north-central Nigeria.\n' +
    '*   **US-Iran Relations:** Amidst the escalating tensions between Israel and Iran, Donald Trump issued a warning to Iran, stating the "full strength of US Forces will come down on you" if attacked.\n' +
    '*   **Minnesota Shooting:** A manhunt is underway in Minnesota for a suspect in the deadly shooting of Democratic lawmakers.\n' +
    '*   **Typhoon Wutip:** Typhoon Wutip caused fatalities and flooding in central Vietnam and reached southern China.',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 3256ms
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 395,
  temperature: 0.7,
  systemInstruction: 'You have Google Search grounding enabled. Use it to find current, up-to-date information. Do NOT gen...'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 889,
  textPreview: "Okay, here's a summary of what happened yesterday in Austria based on Google Search results, followe...",
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 0
}
 POST /api/wizard/execute 200 in 1681ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 306ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1410,
  textPreview: 'Okay, I can provide you with some of the latest AI developments from this week. Since today is June ...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 8
}
[TEST-AI] Result: {
  content: 'Okay, I can provide you with some of the latest AI developments from this week. Since today is June 15, 2025, I will search for AI news and developments specifically from around that time.\n' +
    '\n' +
    'Okay, here are three recent AI developments from this week (around June 15, 2025), based on my search results:\n' +
    '\n' +
    "1.  **Meta's V-JEPA 2 for Physical Reasoning:** Meta has introduced V-JEPA 2, a new world model trained on video, designed to improve AI agents' understanding of the physical world and their ability to predict outcomes of actions. This model helps robots interact with unfamiliar objects and environments, enabling them to perform tasks like reaching, picking up, and placing objects. Meta also released three new benchmarks to evaluate physical reasoning in AI models. (Source: [8, 10])\n" +
    '2.  **AI-Powered Shortcuts App by Apple:** Apple is expected to unveil an upgraded, AI-powered Shortcuts app at its WWDC 2025 conference. This app will allow users to automate everyday tasks more intuitively and efficiently, marking a significant step for Apple into personalized AI assistance. (Source: [1])\n' +
    '3.  **OpenAI and Google Cloud Partnership:** OpenAI has partnered with Google Cloud, moving beyond its previous exclusive reliance on Microsoft. This collaboration highlights the significant resource demands for AI training and deployment and alters the competitive dynamics within the AI sector. (Source: [2])\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 3856ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday? Give me a brief summary.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.4
    }
  },
  "streamingSettings": {
    "enabled": true
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 63,
  temperature: 0.1,
  systemInstruction: 'undefined...'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 754,
  textPreview: "Here's a brief summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran C...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 4
}
[TEST-AI] Result: {
  content: "Here's a brief summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Conflict:** Tensions remain high, with reports of continued strikes and retaliatory actions between Israel and Iran. There were missile strikes and attacks on military and nuclear sites.\n' +
    "*   **Nigeria:** Gunmen killed at least 100 people in Nigeria's Benue state.\n" +
    '*   **Air India Crash:** A London-bound Air India Boeing 787 Dreamliner crashed shortly after takeoff.\n' +
    '*   **US Politics:** A military parade took place in Washington D.C. alongside "No Kings" protests.\n' +
    '*   **Minnesota:** Two Minnesota state lawmakers were shot, resulting in one death.\n' +
    '*   **US-China Trade:** A U.S.-China trade truce leaves the issue of military-use rare earth unresolved.',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 2211ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "Tell me about recent developments in quantum computing.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "forceGoogleSearchGrounding": true,
  "systemInstructions": "Provide accurate, up-to-date information with proper citations."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 55,
  temperature: 0.1,
  systemInstruction: 'Provide accurate, up-to-date information with proper citations....'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 3862,
  textPreview: 'Quantum computing is rapidly evolving from a theoretical concept to a practical technology with the ...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 5
}
[TEST-AI] Result: {
  content: "Quantum computing is rapidly evolving from a theoretical concept to a practical technology with the potential to revolutionize various industries. Here's a summary of recent developments:\n" +
    '\n' +
    '**Hardware Advancements:**\n' +
    '\n' +
    '*   **Increased Qubit Counts and Enhanced Stability:** Companies like IBM, Google, Intel, Rigetti, and IonQ are making strides in developing more stable and scalable quantum processors. Some processors now have over 1000 qubits.\n' +
    '*   **Improved Qubit Coherence:** Enhancements in qubit coherence time, which refers to how long qubits can maintain information, are also being made.\n' +
    '*   **Error Rate Reduction:** Error rates and quantum volume are being improved.\n' +
    '*   **Modular Quantum Systems:** IBM has roadmap targets for modular quantum systems, aiming for a 100,000-qubit system in the coming years.\n' +
    '*   **Hypercube Network Technologies:** Development of hypercube network technologies enhances the scalability and performance of quantum systems by improving communication between qubits.\n' +
    '*   **Integrated Photonics:** Integrated photonics is emerging as a promising avenue for scalable quantum computing with trapped ions, potentially leading to more compact and efficient quantum devices.\n' +
    '*   **Topological Qubits:** Microsoft unveiled a quantum processor powered by topological qubits.\n' +
    '*   **New Materials:** Innovative materials like germanium and GeSn-based quantum well lasers are being developed to improve the efficiency and performance of nanoscale quantum devices.\n' +
    '\n' +
    '**Quantum Cloud Services:**\n' +
    '\n' +
    '*   **Mainstream Accessibility:** Platforms like IBM Quantum, Amazon Braket, Microsoft Azure Quantum, and Google Cirq are making quantum computing accessible to researchers and developers through the cloud.\n' +
    '\n' +
    '**Post-Quantum Cryptography:**\n' +
    '\n' +
    '*   **Priority:** With the potential of quantum computers to break current encryption methods, governments and industries are prioritizing the adoption of quantum-safe encryption.\n' +
    '*   **NIST Standards:** The National Institute of Standards and Technology (NIST) is finalizing its recommended post-quantum cryptographic algorithms.\n' +
    '*   **Security Infrastructure Updates:** Enterprises are assessing and updating their security infrastructure.\n' +
    '\n' +
    '**Quantum Software and Machine Learning:**\n' +
    '\n' +
    '*   **Quantum Software Ecosystem:** The quantum software ecosystem is growing.\n' +
    '*   **Quantum Machine Learning Integration:** Machine learning is being integrated with quantum systems to enhance computational power. Frameworks like TorchQC enable the application of deep learning techniques in quantum dynamics and control.\n' +
    '\n' +
    '**Investment and Commercialization:**\n' +
    '\n' +
    "*   **Increased Investment:** Quantum technology investment in the first five months of 2025 has reached nearly three-quarters of 2024's total.\n" +
    '*   **Growing Sales:** Commercial orders for quantum computers totaled $854 million in 2024, a 70% increase from 2023.\n' +
    '*   **Expanding Customer Base:** The customer base for quantum systems is expanding across geographies and sectors.\n' +
    '*   **Strategic Capital Allocation:** Investment is becoming more focused on commercialization potential.\n' +
    '*   **Government Support:** Governments are continuing to fund quantum initiatives.\n' +
    '\n' +
    '**Quantum Computing Integration**\n' +
    '\n' +
    '*   **Quantum computers are being combined with classical super computers** Quantum-backed artificial intelligence methods also have the potential to stake claims in the most lucrative markets available today.\n' +
    '\n' +
    '**Other Trends:**\n' +
    '\n' +
    '*   **Specialized Hardware/Software:** Development of more specialized hardware and software, as opposed to universal quantum computing.\n' +
    '*   **Networking NISQ Devices:** More networking of noisy intermediate-scale quantum (NISQ) devices together.\n' +
    '*   **Software Abstraction:** More layers of software abstraction are being developed.\n' +
    '*   **Workforce Development:** Increased focus on workforce development tools.\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 5461ms
 âœ“ Compiled in 211ms (1295 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:46:15.663Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
 â¨¯ TypeError: Cannot read properties of undefined (reading 'call')
    at Object.t [as require] (.next/server/webpack-runtime.js:1:128)
    at JSON.parse (<anonymous>) {
  digest: '2385656776'
}
TypeError: Cannot read properties of undefined (reading 'call')
    at Object.t [as require] (.next/server/webpack-runtime.js:1:128)
    at JSON.parse (<anonymous>)
 â¨¯ TypeError: Cannot read properties of undefined (reading 'call')
    at Object.t [as require] (.next/server/webpack-runtime.js:1:128)
    at JSON.parse (<anonymous>) {
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:46:15.915Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'test-title',
    'grounding-url-context',
    'document-understanding-test',
    'combined-features-test',
    'final-summary',
    'code-execution-python',
    'function-calling-calculator',
    'thinking-mode-test',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'function-calling-weather',
    'grounding-google-search',
    'function-calling-unit-converter'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'test-title',
    'grounding-url-context',
    'document-understanding-test',
    'combined-features-test',
    'final-summary',
    'code-execution-python',
    'function-calling-calculator',
    'thinking-mode-test',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'function-calling-weather',
    'grounding-google-search',
    'function-calling-unit-converter'
  ]
}
 â—‹ Compiling /_error ...
 âœ“ Compiled /_error in 1019ms (2485 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:46:17.260Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
 â¨¯ Failed to generate static paths for /w/[shortName]/[documentId]:
[Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array]
}
 â¨¯ Failed to generate static paths for /w/[shortName]/[documentId]:
[Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array]
}
 â¨¯ Failed to generate static paths for /w/[shortName]/[documentId]:
[Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array]
}
 â¨¯ Failed to generate static paths for /w/[shortName]/[documentId]:
[Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 1981ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 834ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 191ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'function-calling-calculator',
    'grounding-url-context',
    'thinking-mode-test',
    'final-summary',
    'test-title',
    'document-understanding-test',
    'image-understanding-test',
    'code-execution-python',
    'streaming-test',
    'function-calling-weather',
    'combined-features-test',
    'grounding-google-search'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'function-calling-calculator',
    'grounding-url-context',
    'thinking-mode-test',
    'final-summary',
    'test-title',
    'document-understanding-test',
    'image-understanding-test',
    'code-execution-python',
    'streaming-test',
    'function-calling-weather',
    'combined-features-test',
    'grounding-google-search'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'function-calling-calculator',
    'grounding-url-context',
    'thinking-mode-test',
    'final-summary',
    'test-title',
    'document-understanding-test',
    'image-understanding-test',
    'code-execution-python',
    'streaming-test',
    'function-calling-weather',
    'combined-features-test',
    'grounding-google-search'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'function-calling-calculator',
    'grounding-url-context',
    'thinking-mode-test',
    'final-summary',
    'test-title',
    'document-understanding-test',
    'image-understanding-test',
    'code-execution-python',
    'streaming-test',
    'function-calling-weather',
    'combined-features-test',
    'grounding-google-search'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'test-title',
    'chat-mode-test',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator',
    'combined-features-test',
    'function-calling-weather',
    'code-execution-python',
    'function-calling-unit-converter',
    'thinking-mode-test',
    'grounding-google-search',
    'document-understanding-test',
    'streaming-test',
    'grounding-url-context'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'test-title',
    'chat-mode-test',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator',
    'combined-features-test',
    'function-calling-weather',
    'code-execution-python',
    'function-calling-unit-converter',
    'thinking-mode-test',
    'grounding-google-search',
    'document-understanding-test',
    'streaming-test',
    'grounding-url-context'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'test-title',
    'chat-mode-test',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator',
    'combined-features-test',
    'function-calling-weather',
    'code-execution-python',
    'function-calling-unit-converter',
    'thinking-mode-test',
    'grounding-google-search',
    'document-understanding-test',
    'streaming-test',
    'grounding-url-context'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'test-title',
    'chat-mode-test',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator',
    'combined-features-test',
    'function-calling-weather',
    'code-execution-python',
    'function-calling-unit-converter',
    'thinking-mode-test',
    'grounding-google-search',
    'document-understanding-test',
    'streaming-test',
    'grounding-url-context'
  ]
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 388ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 1032ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 669ms (2489 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:46:18.184Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 GET /_next/static/css/app/layout.css?v=1749980777321 404 in 706ms
 âœ“ Compiled /favicon.ico in 453ms (1400 modules)
 GET /favicon.ico 200 in 506ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 450ms
 GET /favicon.ico 200 in 12ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 428ms
 GET /favicon.ico 200 in 9ms
 âœ“ Compiled in 449ms (1119 modules)
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 500 in 492ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 452ms
 GET /favicon.ico 200 in 13ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/4uhVu0tEOLwcmnAA2wdv'
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 500 in 449ms
 âœ“ Compiled in 163ms (1116 modules)
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 14ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 477ms
 GET /favicon.ico 200 in 14ms
 âœ“ Compiled in 223ms (1116 modules)
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 32ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 436ms
 GET /favicon.ico 200 in 18ms
 âœ“ Compiled in 163ms (1116 modules)
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 18ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 17ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/4uhVu0tEOLwcmnAA2wdv'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/4uhVu0tEOLwcmnAA2wdv'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/4uhVu0tEOLwcmnAA2wdv'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/4uhVu0tEOLwcmnAA2wdv'
}
 âš  Fast Refresh had to perform a full reload when ./node_modules/next/dist/shared/lib/router/router.js changed. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 500 in 291ms
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 302ms
 âœ“ Compiled in 663ms (2501 modules)
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 345ms
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/@radix-ui.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 500 in 782ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 391ms
 GET /favicon.ico 200 in 11ms
 GET /favicon.ico 200 in 4ms
 â—‹ Compiling /api/test-ai ...
 âœ“ Compiled /api/test-ai in 550ms (1558 modules)
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/build-manifest.json'] {
  type: 'Error',
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/build-manifest.json',
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 1450ms
 âœ“ Compiled /favicon.ico in 163ms (1560 modules)
 GET /favicon.ico 200 in 185ms
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1118,
  textPreview: 'Here are three of the latest AI developments:\n' +
    '\n' +
    '1.  **OpenAI Releases Improved Reasoning Models:** Op...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 9
}
[TEST-AI] Result: {
  content: 'Here are three of the latest AI developments:\n' +
    '\n' +
    '1.  **OpenAI Releases Improved Reasoning Models:** OpenAI has launched o3 and o4-mini, new models in their "o-series" designed to think longer before responding. These models showcase advancements in coding, math, science, and visual perception. o3-pro is now available to Pro users in ChatGPT and the API. These models can use and combine every tool within ChatGPT, including web search, analyzing uploaded files, and generating images. ([12], [13])\n' +
    "2.  **Google's AI Advancements:** Google has unveiled Gemini 2.5, its most intelligent model series, which is coming to search. AI overviews in Google Search have reached over 1.5 billion users monthly. Google is also introducing multitasking capabilities to Project Mariner, an agent that interacts with the web to perform tasks. ([10])\n" +
    '3.  **AI in Healthcare Governance:** The World Health Organization (WHO) has announced a new AI for Health Governance center to oversee ethical AI development in healthcare, focusing on transparency, fairness, and accountability in AI applications for global health services. ([7])\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 5446ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday? Give me a brief summary.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.4
    }
  },
  "streamingSettings": {
    "enabled": true
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 63,
  temperature: 0.1,
  systemInstruction: 'undefined...'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 736,
  textPreview: "Here's a brief summary of what happened in world news yesterday, June 14, 2025, based on the search ...",
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 2
}
[TEST-AI] Result: {
  content: "Here's a brief summary of what happened in world news yesterday, June 14, 2025, based on the search results:\n" +
    '\n' +
    '*   **Israel-Iran Conflict:** Tensions remain high, with continued reports of strikes and counter-strikes. There are reports of missiles raining down, and both sides have targeted sensitive areas.\n' +
    "*   **Nigeria:** Gunmen killed at least 100 people in Nigeria's Benue state.\n" +
    '*   **Air India Crash:** A plane crash occurred, with reports of fatalities, including some British citizens.\n' +
    '*   **US-China Trade:** A trade truce exists between the U.S. and China, but issues regarding military-use rare earth elements remain unresolved.\n' +
    '*   **Other Events:** A military parade took place in Washington D.C., coinciding with protests.',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 2542ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "Tell me about recent developments in quantum computing.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "forceGoogleSearchGrounding": true,
  "systemInstructions": "Provide accurate, up-to-date information with proper citations."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 55,
  temperature: 0.1,
  systemInstruction: 'Provide accurate, up-to-date information with proper citations....'
}
ðŸ” [TextGeneration] Full result keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
ðŸ” [TextGeneration] Result.candidates: EXISTS
ðŸ” [TextGeneration] Grounding metadata: FOUND
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 3682,
  textPreview: 'Quantum computing is experiencing rapid advancements, transitioning from theoretical exploration to ...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 10
}
[TEST-AI] Result: {
  content: "Quantum computing is experiencing rapid advancements, transitioning from theoretical exploration to practical applications. Here's a summary of recent developments:\n" +
    '\n' +
    '**Hardware Advancements:**\n' +
    '\n' +
    '*   **Qubit Development:** Companies like IBM, Google, Intel, Rigetti, and IonQ are increasing the number of qubits, enhancing qubit coherence time, and improving error rates.\n' +
    '*   **IBM:** Aims to build a 1,000-qubit quantum computer by 2025.\n' +
    '*   **Google:** Launched the Willow quantum processor with improved error correction.\n' +
    "*   **Microsoft:** Unveiled the world's first quantum processor powered by topological qubits.\n" +
    '*   **Quantum Foundries:** Facilities designed for scalable production of qubits are expected to reduce costs and standardize components.\n' +
    '\n' +
    '**Error Correction:**\n' +
    '\n' +
    '*   **Breakthroughs:** Significant progress has been made in quantum error correction, crucial for developing more stable quantum computers.\n' +
    "*   **Google's Willow Chip:** Demonstrates below-threshold error correction, lowering error rates as more physical qubits encode logical qubits.\n" +
    '*   **Microsoft and Quantinuum:** Entangled 12 logical qubits, reducing the physical error rate to achieve a low logical error rate, enabling chemistry simulation.\n' +
    '\n' +
    '**Quantum Software and Algorithms:**\n' +
    '\n' +
    '*   **Quantum Machine Learning:** Researchers are developing quantum neural networks, quantum support vector machines, and quantum algorithms for complex tasks like image and natural language processing.\n' +
    "*   **Quantum Algorithm:** A new quantum algorithm by Oded Regev of New York University potentially surpasses Shor's method in efficiency for number factoring.\n" +
    '\n' +
    '**Quantum Communication and Networking:**\n' +
    '\n' +
    '*   **Quantum Networks:** Development of secure communication through metropolitan-scale entangled quantum networks.\n' +
    '*   **Distributed Entanglement:** Demonstration of distributed entanglement, linking qubits within separate quantum computers.\n' +
    '*   **Quantum Communication:** Enhanced techniques for secure data transmission using quantum principles, including demonstration over a subsea optical fiber cable.\n' +
    '\n' +
    '**Quantum Cloud Services:**\n' +
    '\n' +
    '*   **Accessibility:** More companies like Amazon (Amazon Braket) are offering quantum cloud platforms, making quantum computing resources accessible without expensive hardware.\n' +
    '\n' +
    '**Hybrid Quantum-Classical Systems:**\n' +
    '\n' +
    '*   **Integration:** Hybrid systems, combining classical and quantum computing elements, are gaining traction to leverage the strengths of both technologies.\n' +
    '\n' +
    '**Applications:**\n' +
    '\n' +
    "*   **Drug Discovery:** Quantum computing is being used to simulate drug candidates' interactions with biological molecules, potentially leading to more effective treatments.\n" +
    '*   **AI and Machine Learning:** Quantum computing could dramatically enhance machine learning algorithms by speeding up data analysis and improving pattern recognition.\n' +
    "*   **Optimization Problems:** D-Wave's annealing quantum computers are delivering measurable results for customers in solving complex optimization problems like workforce scheduling and cargo handling.\n" +
    '*   **Quantum Security:** Post-quantum cryptography is evolving from theoretical constructs to practical applications, with governments and corporations accelerating the deployment of quantum-resistant algorithms.\n' +
    '\n' +
    '**Overall Trends:**\n' +
    '\n' +
    '*   **Quantum Computing Beyond Computing:** Expanding into quantum sensing and quantum communication for navigation, medical imaging, and secure data transfer.\n' +
    '*   **Specialized Hardware/Software:** Shift towards more specialized hardware and software solutions.\n' +
    '*   **Workforce Development:** Increased focus on workforce development tools to train professionals in quantum computing.\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 5512ms
 âœ“ Compiled in 253ms (1560 modules)
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/build-manifest.json'] {
  type: 'Error',
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/build-manifest.json',
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 404ms
 GET /favicon.ico 200 in 33ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday?",
  "forceGoogleSearchGrounding": true
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 38,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1306,
  textPreview: "Here's a summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran Conflic...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 5
}
[TEST-AI] Result: {
  content: "Here's a summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    `*   **Israel-Iran Conflict:** Tensions remained high with continued strikes and retaliatory actions. Donald Trump denied US involvement in Israel's "Operation Rising Lion," while Iran claimed to have proof of American support. Reports indicated Israel struck Iran's largest gas field and possibly targeted Iran's Defense Ministry headquarters.\n` +
    '*   **Nigeria:** Gunmen killed at least 100 people in a village attack in north-central Nigeria.\n' +
    '*   **Air India Plane Crash:** An Air India plane crashed, and the captain sent a mayday call less than a minute before the crash. Families were waiting for the remains of relatives. King Charles is set to honor the victims at the Trooping the Colour parade.\n' +
    '*   **Minnesota Shooting:** A manhunt was underway for a suspect in the deadly shooting of Democratic lawmakers in Minnesota.\n' +
    '*   **Typhoon Wutip:** Typhoon Wutip caused five deaths and left two missing in central Vietnam, with farmlands flooded. The typhoon also reached southern China.\n' +
    '*   **Other News:**\n' +
    '    *   Former Nicaraguan President Violeta Chamorro died at 95.\n' +
    '    *   Trump held a military parade amid protests across America.\n' +
    '    *   Putin and Trump discussed Middle East tensions and the Ukraine war in a phone call.',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 3131ms
 â—‹ Compiling /_not-found ...
 âœ“ Compiled /_not-found in 758ms (2666 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:13.772Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET /_next/static/webpack/f6d597cd3b8505aa.webpack.hot-update.json 404 in 782ms
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 5ms
 â¨¯ [Error: Cannot find module './vendor-chunks/next.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: Cannot find module './vendor-chunks/next.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/w/[shortName]/[documentId]/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/dev/static-paths-worker.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/compiled/jest-worker/processChild.js] {
  type: 'Error',
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/w/gemini-test/BHAtTG1NpuXc1Q6PDDep'
}
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'
}
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/server/pages/_document.js'
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 500 in 228ms
 GET /_next/static/chunks/fallback/webpack.js 404 in 162ms
 GET /_next/static/chunks/fallback/react-refresh.js 404 in 117ms
 GET /_next/static/chunks/fallback/main.js 404 in 118ms
 GET /_next/static/chunks/fallback/pages/_app.js 404 in 114ms
 GET /_next/static/chunks/fallback/pages/_error.js 404 in 114ms
 â¨¯ [Error: ENOENT: no such file or directory, open '/Users/franzenzenhofer/dev/franzai-writer/.next/server/app/favicon.ico/route.js'] {
  errno: -2,
  code: 'ENOENT',
  syscall: 'open',
  path: '/Users/franzenzenhofer/dev/franzai-writer/.next/server/app/favicon.ico/route.js',
  page: '/favicon.ico'
}
 GET /favicon.ico 500 in 24ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:30.044Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:30.113Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'grounding-url-context',
    'test-title',
    'final-summary',
    'document-understanding-test',
    'combined-features-test',
    'chat-mode-test',
    'function-calling-unit-converter',
    'streaming-test',
    'function-calling-weather',
    'code-execution-python',
    'grounding-google-search',
    'image-understanding-test',
    'thinking-mode-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'grounding-url-context',
    'test-title',
    'final-summary',
    'document-understanding-test',
    'combined-features-test',
    'chat-mode-test',
    'function-calling-unit-converter',
    'streaming-test',
    'function-calling-weather',
    'code-execution-python',
    'grounding-google-search',
    'image-understanding-test',
    'thinking-mode-test',
    'function-calling-calculator'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 1569ms
 GET /_next/static/css/app/layout.css?v=1749981150047 404 in 31ms
 GET /_next/static/chunks/app/error.js 404 in 108ms
 GET /_next/static/chunks/main-app.js?v=1749981150047 404 in 109ms
 GET /_next/static/chunks/app/page.js 404 in 108ms
 GET /_next/static/chunks/app-pages-internals.js 404 in 109ms
 GET /_next/static/chunks/app/w/%5BshortName%5D/%5BdocumentId%5D/error.js 404 in 108ms
 GET /_next/static/chunks/_app-pages-browser_src_app_w_shortName_documentId_wizard-page-content_tsx.js 404 in 59ms
 GET /_next/static/chunks/app/w/%5BshortName%5D/%5BdocumentId%5D/page.js 404 in 59ms
 GET /_next/static/chunks/app/global-error.js 404 in 60ms
 â¨¯ Error: Cannot find module './447.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/_not-found/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/swc/options.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/swc/index.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/next-config-ts/transpile-config.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/config.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/next.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/start-server.js
    at __webpack_require__.f.require (.next/server/webpack-runtime.js:208:28)
    at <unknown> (.next/server/webpack-runtime.js:116:40)
    at Array.reduce (<anonymous>)
    at __webpack_require__.e (.next/server/webpack-runtime.js:115:67)
    at Array.map (<anonymous>)
    at __webpack_require__.X (.next/server/webpack-runtime.js:167:22)
    at <unknown> (.next/server/app/favicon.ico/route.js:1:21661)
    at Object.<anonymous> (.next/server/app/favicon.ico/route.js:1:21707) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/favicon.ico'
}
 GET /favicon.ico 500 in 20ms
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'grounding-url-context',
    'test-title',
    'final-summary',
    'document-understanding-test',
    'combined-features-test',
    'chat-mode-test',
    'function-calling-unit-converter',
    'streaming-test',
    'function-calling-weather',
    'code-execution-python',
    'grounding-google-search',
    'image-understanding-test',
    'thinking-mode-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'grounding-url-context',
    'test-title',
    'final-summary',
    'document-understanding-test',
    'combined-features-test',
    'chat-mode-test',
    'function-calling-unit-converter',
    'streaming-test',
    'function-calling-weather',
    'code-execution-python',
    'grounding-google-search',
    'image-understanding-test',
    'thinking-mode-test',
    'function-calling-calculator'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 172ms
 GET /_next/static/css/app/layout.css?v=1749981153481 404 in 31ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:33.737Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 GET /_next/static/chunks/main-app.js?v=1749981153481 404 in 99ms
 GET /_next/static/chunks/app/error.js 404 in 99ms
 GET /_next/static/chunks/app/page.js 404 in 99ms
 GET /_next/static/chunks/app-pages-internals.js 404 in 100ms
 GET /_next/static/chunks/app/w/%5BshortName%5D/%5BdocumentId%5D/error.js 404 in 99ms
 GET /_next/static/chunks/app/global-error.js 404 in 56ms
 GET /_next/static/chunks/app/w/%5BshortName%5D/%5BdocumentId%5D/page.js 404 in 56ms
 GET /_next/static/chunks/_app-pages-browser_src_app_w_shortName_documentId_wizard-page-content_tsx.js 404 in 56ms
 â¨¯ Error: Cannot find module './447.js'
Require stack:
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/webpack-runtime.js
- /Users/franzenzenhofer/dev/franzai-writer/.next/server/app/_not-found/page.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/require.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/load-components.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/utils.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/swc/options.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/swc/index.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/build/next-config-ts/transpile-config.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/config.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/next.js
- /Users/franzenzenhofer/dev/franzai-writer/node_modules/next/dist/server/lib/start-server.js
    at __webpack_require__.f.require (.next/server/webpack-runtime.js:208:28)
    at <unknown> (.next/server/webpack-runtime.js:116:40)
    at Array.reduce (<anonymous>)
    at __webpack_require__.e (.next/server/webpack-runtime.js:115:67)
    at Array.map (<anonymous>)
    at __webpack_require__.X (.next/server/webpack-runtime.js:167:22)
    at <unknown> (.next/server/app/favicon.ico/route.js:1:21661)
    at Object.<anonymous> (.next/server/app/favicon.ico/route.js:1:21707) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [Array],
  page: '/favicon.ico'
}
 GET /favicon.ico 500 in 19ms
Debugger listening on ws://127.0.0.1:9229/202c4611-4c9b-45d1-b7be-f1de345e2014
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 1680166,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/a864516f-3cba-4bff-83da-a27ff137b9ad
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 2.1s
 â—‹ Compiling /_not-found ...
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 âœ“ Compiled /api/test-ai in 5.5s (2329 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:45.616Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âš  Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday?",
  "forceGoogleSearchGrounding": true
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 38,
  temperature: 0.7,
  systemInstruction: 'undefined...'
}
 GET /_next/static/webpack/3386742c52ab30c1.webpack.hot-update.json 404 in 5999ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:46.184Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:46.292Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'code-execution-python',
    'image-understanding-test',
    'function-calling-weather',
    'streaming-test',
    'chat-mode-test',
    'function-calling-unit-converter',
    'grounding-google-search',
    'grounding-url-context',
    'final-summary',
    'document-understanding-test',
    'function-calling-calculator',
    'thinking-mode-test',
    'combined-features-test',
    'test-title'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'code-execution-python',
    'image-understanding-test',
    'function-calling-weather',
    'streaming-test',
    'chat-mode-test',
    'function-calling-unit-converter',
    'grounding-google-search',
    'grounding-url-context',
    'final-summary',
    'document-understanding-test',
    'function-calling-calculator',
    'thinking-mode-test',
    'combined-features-test',
    'test-title'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'code-execution-python',
    'function-calling-calculator',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'thinking-mode-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'streaming-test',
    'function-calling-unit-converter',
    'grounding-google-search',
    'test-title',
    'final-summary'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'code-execution-python',
    'function-calling-calculator',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'thinking-mode-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'streaming-test',
    'function-calling-unit-converter',
    'grounding-google-search',
    'test-title',
    'final-summary'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 6930ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 1308ms
 â—‹ Compiling /favicon.ico ...
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1124,
  textPreview: "Here's a summary of what happened in world news yesterday, June 14, 2025, based on the search result...",
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 3
}
[TEST-AI] Result: {
  content: "Here's a summary of what happened in world news yesterday, June 14, 2025, based on the search results:\n" +
    '\n' +
    `*   **Israel-Iran Conflict:** Tensions remained high, with continued strikes and retaliatory actions. Donald Trump denied US involvement in Israel's "Operation Rising Lion," while Iran claimed to have proof of American support. There were reports of missiles striking Israel's port city of Haifa and a massive fire at an Iranian oil depot after an Israeli attack.\n` +
    '*   **Nigeria:** Gunmen killed at least 100 people in north-central Nigeria, according to Amnesty International.\n' +
    '*   **Air India Plane Crash:** An investigation was underway into the Air India plane crash, with focus on the final moments before the crash. King Charles was set to honor the victims at the Trooping the Colour parade.\n' +
    '*   **US Politics:** Trump held a military parade amid protests across America. In Minnesota, a manhunt was underway for a suspect in the deadly shooting of Democratic lawmakers.\n' +
    '*   **Typhoon Wutip:** Typhoon Wutip caused five deaths and two missing in central Vietnam, with farmlands flooded as it reached southern China.',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 5203ms
 âœ“ Compiled /favicon.ico in 1264ms (1473 modules)
 GET /favicon.ico 200 in 1300ms
 GET /favicon.ico 200 in 5ms
 âœ“ Compiled /api/documents/save in 200ms (2319 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:52:50.482Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test\n',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 824ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Updating document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document updated { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document updated successfully { documentId: '4uhVu0tEOLwcmnAA2wdv' }
 POST /api/documents/save 200 in 241ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 831,
  textPreview: 'Here are three recent AI developments:\n' +
    '\n' +
    '1.  **OpenAI Releases GPT-4.5 with Enhanced Emotional Intell...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 9
}
[TEST-AI] Result: {
  content: 'Here are three recent AI developments:\n' +
    '\n' +
    '1.  **OpenAI Releases GPT-4.5 with Enhanced Emotional Intelligence:** OpenAI has launched GPT-4.5, focusing on improved emotional intelligence (EQ). This upgrade enhances empathy and human-like conversational capabilities, enabling more intuitive interactions.\n' +
    '    ([2])\n' +
    '2.  **Google Launches Gemma 3:** Google has released Gemma 3, its latest family of open AI models. These models are optimized for developer flexibility and performance across tasks and support applications like chatbots, search, and code generation.\n' +
    '    ([2])\n' +
    '3.  **Meta Unveils LLaMA 4 with Voice-Powered AI:** Meta has introduced LLaMA 4, a new voice-powered AI model designed for natural language interactions. The model aims to improve AI assistants, automated customer service, and real-time translation.\n' +
    '    ([2])\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 2605ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What happened in world news yesterday? Give me a brief summary.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.4
    }
  },
  "streamingSettings": {
    "enabled": true
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 63,
  temperature: 0.1,
  systemInstruction: 'undefined...'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1014,
  textPreview: "Here's a brief summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    '*   **Israel-Iran C...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 4
}
[TEST-AI] Result: {
  content: "Here's a brief summary of what happened in world news yesterday, June 14, 2025:\n" +
    '\n' +
    "*   **Israel-Iran Conflict:** Tensions remain high as Israel and Iran continue to exchange attacks. Israel has reportedly targeted Iran's Defense Ministry headquarters and struck nuclear facilities. Iran has launched missile barrages on Israel, with some missiles reaching Tel Aviv.\n" +
    '*   **Air India Plane Crash:** A London-bound Air India flight crashed in Ahmedabad, India, shortly after takeoff, killing over 240 people.\n' +
    "*   **Nigeria Attack:** Gunmen killed at least 100 people in Nigeria's Benue state.\n" +
    '*   **US-China Trade:** A U.S.-China trade truce leaves the issue of military-use rare earth unresolved.\n' +
    '*   **Minnesota Shooting:** Two Minnesota state lawmakers were shot, one fatally.\n' +
    '*   **US Military Parade:** A massive military parade took place in Washington D.C., coinciding with protests.\n' +
    '*   **Other Events:** There was a hot air balloon crash in Turkey. Former President of Nicaragua, Violeta Chamorro, died at 95.\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 2367ms
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "Tell me about recent developments in quantum computing.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "forceGoogleSearchGrounding": true,
  "systemInstructions": "Provide accurate, up-to-date information with proper citations."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 55,
  temperature: 0.1,
  systemInstruction: 'Provide accurate, up-to-date information with proper citations....'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 3556,
  textPreview: "Here's a summary of recent developments in quantum computing:\n" +
    '\n' +
    '**General Trends:**\n' +
    '\n' +
    '*   **Increased ...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 5
}
[TEST-AI] Result: {
  content: "Here's a summary of recent developments in quantum computing:\n" +
    '\n' +
    '**General Trends:**\n' +
    '\n' +
    "*   **Increased Investment:** Quantum technology investment in the first five months of 2025 reached nearly three-quarters of 2024's total, with fewer but larger and more strategic funding rounds.\n" +
    '*   **Commercialization:** The industry is transitioning from experimental deployments to commercial-scale commitments, with growing sales and climbing stock prices.\n' +
    '*   **Diversifying Demand:** Governments, corporations, and research institutions are deploying quantum solutions, not just exploring them.\n' +
    '*   **Government Support:** Continued government funding is encouraging private-sector involvement.\n' +
    '*   **Integration with AI:** Quantum companies are combining quantum computers with classical supercomputers and AI methods.\n' +
    '\n' +
    '**Hardware Advancements:**\n' +
    '\n' +
    '*   **Logical Qubits:** Microsoft and Quantinuum entangled 12 logical qubits, reducing the physical error rate significantly.\n' +
    '*   **Quantum Memory:** Google demonstrated a quantum memory with below-threshold error rates and doubled coherence lifetimes compared to physical qubits.\n' +
    '*   **Networking:** Companies are connecting multiple processors to create larger systems. Photonic demonstrated distributed entanglement, and QuTech connected two small quantum computers in different cities. IBM is building L-couplers to scale its systems.\n' +
    '*   **Hypercube Network Technologies:** These enhance the scalability and performance of quantum systems by improving communication between qubits.\n' +
    '*   **Integrated Photonics:** This is emerging as a promising avenue for scalable quantum computing with trapped ions, potentially leading to more compact and efficient devices.\n' +
    '*   **New Materials:** Development of innovative materials like germanium and GeSn-based quantum well lasers to improve quantum hardware efficiency and performance.\n' +
    '*   **Topological Qubits:** Research teams are making progress toward topological qubits, which could lead to fault-tolerant quantum computing.\n' +
    '*   **Quantum Computing Chip:** Microsoft launched Majorana 1, a quantum computing chip with a Topological Core architecture.\n' +
    '\n' +
    '**Quantum Software and Machine Learning:**\n' +
    '\n' +
    '*   **Quantum Machine Learning Integration:** Machine learning is being integrated with quantum systems to enhance computational power. Frameworks like TorchQC enable the application of deep learning techniques in quantum dynamics and control.\n' +
    '*   **Generative Quantum AI:** Quantinuum launched a Generative Quantum AI framework that combines AI, quantum computing, and supercomputers.\n' +
    '*   **Software Stack Development:** Companies like Classiq are focused on building the software stack for quantum computing.\n' +
    '\n' +
    '**Commercial Applications:**\n' +
    '\n' +
    '*   **Real-world Use Cases:** Quantum use cases are being developed in aerospace, energy, financial services, and national security.\n' +
    '*   **Materials Discovery:** Quantum computing is being applied to specific problems in logistics, simulation, and materials discovery.\n' +
    '*   **Encryption:** Quantum hardware is being used to generate truly random encryption keys.\n' +
    '*    **Automotive and Aerospace:** Quantum computing is being used to improve the performance of hydrogen fuel cell catalysts and electric batteries mobility.\n' +
    '\n' +
    '**Other Key Points:**\n' +
    '\n' +
    '*   **Quantum Readiness:** CxOs need to prepare for quantum computing, as boardrooms are increasingly interested in quantum plans.\n' +
    '*   **National Capability:** Quantum computing is considered a national capability, with countries investing heavily to attract talent and secure data.\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 5014ms
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:55:37.762Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ]
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:55:38.027Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 495ms
 GET /favicon.ico 200 in 10ms
 âœ“ Compiled /api/wizard/execute in 398ms (2313 modules)
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 267,
  temperature: 0.7,
  systemInstruction: 'You have Google Search grounding enabled. Use it to find current, up-to-date information. Do NOT gen...'
}
 âœ“ Compiled /api/documents/save in 138ms (1474 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:55:43.022Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 613,
  textPreview: 'Yesterday, June 14, 2025, based on the search results, the main news event in Austria was the afterm...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 1
}
 POST /api/wizard/execute 200 in 2762ms
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 745ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 187ms
 âœ“ Compiled in 138ms (855 modules)
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'document-understanding-test',
    'code-execution-python',
    'test-title',
    'grounding-google-search',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'final-summary',
    'function-calling-calculator',
    'chat-mode-test',
    'streaming-test',
    'image-understanding-test',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'document-understanding-test',
    'code-execution-python',
    'test-title',
    'grounding-google-search',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'final-summary',
    'function-calling-calculator',
    'chat-mode-test',
    'streaming-test',
    'image-understanding-test',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 207ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 213ms
 GET /favicon.ico 200 in 16ms
 GET /favicon.ico 200 in 13ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:56:28.716Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled in 137ms (855 modules)
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'combined-features-test',
    'grounding-url-context',
    'streaming-test',
    'function-calling-weather',
    'thinking-mode-test',
    'document-understanding-test',
    'grounding-google-search',
    'test-title',
    'code-execution-python',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'combined-features-test',
    'grounding-url-context',
    'streaming-test',
    'function-calling-weather',
    'thinking-mode-test',
    'document-understanding-test',
    'grounding-google-search',
    'test-title',
    'code-execution-python',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'document-understanding-test',
    'code-execution-python',
    'test-title',
    'grounding-google-search',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'final-summary',
    'function-calling-calculator',
    'chat-mode-test',
    'streaming-test',
    'image-understanding-test',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'document-understanding-test',
    'code-execution-python',
    'test-title',
    'grounding-google-search',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'final-summary',
    'function-calling-calculator',
    'chat-mode-test',
    'streaming-test',
    'image-understanding-test',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 125ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 126ms
 GET /favicon.ico 200 in 19ms
 GET /favicon.ico 200 in 4ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:56:40.302Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
 âœ“ Compiled in 130ms (855 modules)
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Loading existing document: BHAtTG1NpuXc1Q6PDDep
[DocumentPersistence] Loading document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[WizardPage] Starting page load { shortName: 'gemini-test', documentId: '4uhVu0tEOLwcmnAA2wdv' }
[WizardPage] Loading existing document: 4uhVu0tEOLwcmnAA2wdv
[DocumentPersistence] Loading document { documentId: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Getting document { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document loaded successfully {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'combined-features-test',
    'grounding-url-context',
    'streaming-test',
    'function-calling-weather',
    'thinking-mode-test',
    'document-understanding-test',
    'grounding-google-search',
    'test-title',
    'code-execution-python',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'function-calling-unit-converter',
    'chat-mode-test',
    'combined-features-test',
    'grounding-url-context',
    'streaming-test',
    'function-calling-weather',
    'thinking-mode-test',
    'document-understanding-test',
    'grounding-google-search',
    'test-title',
    'code-execution-python',
    'final-summary',
    'image-understanding-test',
    'function-calling-calculator'
  ]
}
[FirestoreAdapter] Document retrieved { collection: 'documents', id: '4uhVu0tEOLwcmnAA2wdv' }
[DocumentPersistence] Document loaded successfully {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageStatesCount: 14,
  stageStatesKeys: [
    'document-understanding-test',
    'code-execution-python',
    'test-title',
    'grounding-google-search',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'final-summary',
    'function-calling-calculator',
    'chat-mode-test',
    'streaming-test',
    'image-understanding-test',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
[WizardPage] Document loaded successfully: {
  documentId: '4uhVu0tEOLwcmnAA2wdv',
  title: 'test',
  stageCount: 14,
  validatedStageIds: [
    'document-understanding-test',
    'code-execution-python',
    'test-title',
    'grounding-google-search',
    'function-calling-weather',
    'grounding-url-context',
    'combined-features-test',
    'final-summary',
    'function-calling-calculator',
    'chat-mode-test',
    'streaming-test',
    'image-understanding-test',
    'function-calling-unit-converter',
    'thinking-mode-test'
  ]
}
 GET /w/gemini-test/BHAtTG1NpuXc1Q6PDDep 200 in 124ms
 GET /w/gemini-test/4uhVu0tEOLwcmnAA2wdv 200 in 125ms
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T09:56:52.620Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
Debugger listening on ws://127.0.0.1:9229/a46c174f-4203-4c8f-9c02-cd499460ec1d
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 280500,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/6663fb57-83e5-4851-bb1b-8c0060069ef3
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1792ms
 â—‹ Compiling /api/test-ai ...
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 âœ“ Compiled /api/test-ai in 885ms (587 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest AI developments this week? Provide 3 specific examples with sources.",
  "model": "gemini-2.0-flash",
  "temperature": 0.2,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.",
  "streamingSettings": {
    "enabled": false
  }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 2211,
  textPreview: 'Okay, I will provide you with 3 examples of the latest AI developments from this week (June 9th - Ju...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 3
}
[TEST-AI] Result: {
  content: 'Okay, I will provide you with 3 examples of the latest AI developments from this week (June 9th - June 15th, 2025), using Google Search to gather the most up-to-date information.\n' +
    '\n' +
    'Here are three recent AI developments from this week:\n' +
    '\n' +
    '1.  **Apple Intelligence Enhancements:** Apple unveiled new Apple Intelligence features across its devices (iPhone, iPad, Mac, Apple Watch, and Apple Vision Pro). These include improved Live Translation, visual intelligence updates, enhancements to Image Playground and Genmoji, and direct access for Shortcuts to Apple Intelligence. Developers can now access the on-device large language model at the core of Apple Intelligence. These features will be available for testing starting today and to users this fall. (Source: [https://www.apple.com/newsroom/2025/06/apple-intelligence-gets-even-more-powerful-with-new-capabilities-across-apple-devices/](https://www.apple.com/newsroom/2025/06/apple-intelligence-gets-even-more-powerful-with-new-capabilities-across-apple-devices/))\n' +
    "2.  **Meta's V-JEPA 2 World Model:** Meta introduced V-JEPA 2, a video-trained world model that enhances robots' and AI agents' understanding of the physical world and their ability to predict how it will respond to actions. This model enables robots to interact with unfamiliar objects and environments, performing tasks like reaching, picking up, and placing objects. Meta also released three new benchmarks to evaluate physical reasoning in AI models. (Source: [https://about.fb.com/news/2025/06/our-new-model-helps-ai-think-before-it-acts/](https://about.fb.com/news/2025/06/our-new-model-helps-ai-think-before-it-acts/))\n" +
    "3.  **Mistral AI's Reasoning Model - Magistral:** Mistral AI launched Magistral, its first reasoning model, designed for domain-specific, transparent, and multilingual reasoning. It comes in two versions: Magistral Small (a 24B parameter open-source version) and Magistral Medium (an enterprise version). Magistral is versatile and suitable for applications requiring longer thought processing and better accuracy, such as legal research, financial forecasting, and software development. (Source: [https://mistral.ai/news/magistral/](https://mistral.ai/news/magistral/))\n",
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: false
  - Has grounding sources: false
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 6395ms
Debugger listening on ws://127.0.0.1:9229/4c8b5df9-3b7f-46e5-8863-2f7396327ed4
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 78628,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/80ca5327-0dab-45fd-a96e-cd56f4f863d1
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1313ms
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 â—‹ Compiling /api/test-ai ...
 âœ“ Compiled /api/test-ai in 545ms (587 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  "promptTemplate": "What are the latest developments in quantum computing this week? Provide 3 specific examples.",
  "model": "gemini-2.0-flash",
  "temperature": 0.1,
  "groundingSettings": {
    "googleSearch": {
      "enabled": true,
      "dynamicThreshold": 0.3
    }
  },
  "systemInstructions": "You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources with URLs."
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 93,
  temperature: 0.1,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 1044,
  textPreview: 'Here are three of the latest developments in quantum computing this week:\n' +
    '\n' +
    '1.  **Quantum Internet Ad...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 4
}
[TEST-AI] Result: {
  content: 'Here are three of the latest developments in quantum computing this week:\n' +
    '\n' +
    '1.  **Quantum Internet Advancement:** A team of Danish and German scientists has started a major project focused on creating new technology that could be the foundation for a future quantum internet. They are utilizing a rare element called erbium along with silicon chips. ([1])\n' +
    "2.  **IBM's Quantum Computing Plans:** IBM is working on building the world's first large-scale quantum computer that can operate without errors. This announcement has boosted IBM's stock and is seen as a positive sign for the quantum computing industry. ([2])\n" +
    `3.  **Quantum Error Correction Breakthrough:** Google has achieved a milestone with its new Willow quantum processor, a ~100-qubit superconducting chip, by demonstrating "below-threshold" error correction. By scaling Willow's qubit grid from 9 to 49 encoded qubits, they were able to cut the error rate in half with each step, marking the first time that adding more qubits has made the overall computation more reliable. ([3])\n`,
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: false
  - Has grounding sources: false
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 3553ms
 âœ“ Compiled in 15ms
Debugger listening on ws://127.0.0.1:9229/73b23729-200d-4efb-9303-e051afae68ca
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 259395,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/24ee6e45-cb42-47e1-958d-b34e1142ebcc
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1306ms
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 â—‹ Compiling /api/test-ai ...
 âœ“ Compiled /api/test-ai in 576ms (587 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  promptTemplate: 'What are the latest AI developments this week? Provide 3 specific examples with sources.',
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  systemInstructions: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.',
  streamingSettings: { enabled: false }
}
[runAiStage] Starting with new SDK
ðŸ“¤ [AI REQUEST] Text Generation: {
  model: 'gemini-2.0-flash',
  promptLength: 88,
  temperature: 0.2,
  systemInstruction: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your s...'
}
âœ… [TextGeneration] Grounding metadata found
ðŸ“¥ [AI RESPONSE] Text Generation: {
  textLength: 2864,
  textPreview: 'Okay, I will provide you with 3 examples of the latest AI developments this week.\n' +
    '\n' +
    'Here are three re...',
  usageMetadata: undefined,
  finishReason: undefined,
  hasGroundingMetadata: true,
  groundingSourcesCount: 10
}
[TEST-AI] Result: {
  content: 'Okay, I will provide you with 3 examples of the latest AI developments this week.\n' +
    '\n' +
    'Here are three recent AI developments:\n' +
    '\n' +
    '1.  **AI Agents with Autonomous Capabilities:** AI agents are evolving to perform tasks autonomously, interpreting requests, retrieving information, and providing personalized responses without human intervention. Gartner forecasts that agentic AI will be integrated into 33% of enterprise software applications in 2028, compared to less than 1% in 2024.\n' +
    '    *   Source: [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHuBJdRIl1C2PNceK-vWXRwSEj54hDw-rAkp6T4uCSyatRuHtDuN1eOJNymO304zOPl0TdV1ilsN3OrZaWMx-HTl\\_rAe0oBNYnFVYzbOK6S6\\_HSYOpstTnB6qlhwMSLX5AnuOFnqrbLiV6ERRm80oP\\_fepjBeFFEHfJr6Ki0sT4aXrUvplAQJ4phORUzsPiLnPp9DN47KUkZdd5vFtO\\_EpbkDDl55wzaIVztMR3r3Q=](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHuBJdRIl1C2PNceK-vWXRwSEj54hDw-rAkp6T4uCSyatRuHtDuN1eOJNymO304zOPl0TdV1ilsN3OrZaWMx-HTl_rAe0oBNYnFVYzbOK6S6_HSYOpstTnB6qlhwMSLX5AnuOFnqrbLiV6ERRm80oP_fepjBeFFEHfJr6Ki0sT4aXrUvplAQJ4phORUzsPiLnPp9DN47KUkZdd5vFtO_EpbkDDl55wzaIVztMR3r3Q=)\n' +
    '2.  **Advanced Natural Language Processing (NLP):** NLP technologies have reached new heights, enabling AI systems to comprehend and generate human language with unprecedented accuracy and nuance. Conversational AI agents can engage in complex dialogues, understand context, and exhibit emotional intelligence, revolutionizing customer service, education, and entertainment.\n' +
    '    *   Source: [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFWVTNqC1\\_bXRsUKnbRlFrq6hYTSgcP3ILvDR4vhed7sHfD\\_NeW8YNmfJXhJjQfBsaoiHOmgn7Db4np1ammeOCZa3TpXPPVSMgW3vb-D9uusQ5bTWvuaRRrDMOAlF5oRGDSsLIYVve\\_NdMre-VSbY6\\_dG5ZbzNoMVjvGQ==](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFWVTNqC1_bXRsUKnbRlFrq6hYTSgcP3ILvDR4vhed7sHfD_NeW8YNmfJXhJjQfBsaoiHOmgn7Db4np1ammeOCZa3TpXPPVSMgW3vb-D9uusQ5bTWvuaRRrDMOAlF5oRGDSsLIYVve_NdMre-VSbY6_dG5ZbzNoMVjvGQ==)\n' +
    '3.  **AI in Healthcare for Personalized Medicine and Predictive Analytics:** The healthcare sector has witnessed significant AI-driven transformations, particularly in personalized medicine and predictive analytics. AI algorithms analyze extensive datasets, including genetic information and patient histories, to tailor treatment plans and assist in early disease detection and prognosis.\n' +
    '    *   Source: [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFWVTNqC1\\_bXRsUKnbRlFrq6hYTSgcP3ILvDR4vhed7sHfD\\_NeW8YNmfJXhJjQfBsaoiHOmgn7Db4np1ammeOCZa3TpXPPVSMgW3vb-D9uusQ5bTWvuaRRrDMOAlF5oRGDSsLIYVve\\_NdMre-VSbY6\\_dG5ZbzNoMVjvGQ==](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFWVTNqC1_bXRsUKnbRlFrq6hYTSgcP3ILvDR4vhed7sHfD_NeW8YNmfJXhJjQfBsaoiHOmgn7Db4np1ammeOCZa3TpXPPVSMgW3vb-D9uusQ5bTWvuaRRrDMOAlF5oRGDSsLIYVve_NdMre-VSbY6_dG5ZbzNoMVjvGQ==)\n',
  usage: undefined,
  groundingMetadata: undefined,
  groundingSources: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: false
  - Has grounding sources: false
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 7819ms
 âœ“ Compiled in 20ms
Debugger listening on ws://127.0.0.1:9229/0f859290-3f55-4075-832c-127d1529df3f
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 413483,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/76633e91-3ac8-4126-88b6-bada23c01239
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1350ms
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 â—‹ Compiling /api/test-ai ...
 âœ“ Compiled /api/test-ai in 645ms (590 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  promptTemplate: 'What are the latest AI developments this week? Provide 3 specific examples with sources.',
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  systemInstructions: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources.',
  streamingSettings: { enabled: false }
}
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 88
[runAiStage] First 200 chars of filled prompt: What are the latest AI developments this week? Provide 3 specific examples with sources.
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 88,
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'What are the latest AI developments this week? Provide 3 specific examples with sources....',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 88
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.2
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 10,
  supportsCount: 8,
  searchQueries: 3,
  sourcesExtracted: 10
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 1216,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 10,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
[TEST-AI] Result: {
  content: 'Here are three of the latest AI developments from this week:\n' +
    '\n' +
    '1.  **OpenAI Releases o3 and o4-mini Reasoning Models:** On June 10, 2025, OpenAI announced the release of o3 and o4-mini, new models in their o-series designed to think for longer before responding. These models are the smartest released to date, with o3 being the most powerful reasoning model excelling in coding, math, science, and visual perception. The o4-mini is optimized for fast, cost-efficient reasoning and performs well in math, coding, and visual tasks. OpenAI o3-pro is now available to Pro users in ChatGPT, as well as in their API. ([9])\n' +
    '2.  **Google Enhances Gemini App with Veo 3:** Google has added new capabilities to the Gemini app, including the state-of-the-art video generation model, Veo 3. Veo 3 is the first video generation model with native support for sound effects, background noises, and dialogue between characters, making it easier to create videos within the app. ([12])\n' +
    "3.  **NVIDIA Helps Germany Lead Europe's AI Manufacturing Race:** NVIDIA is contributing to Germany's efforts to lead AI manufacturing in Europe. This collaboration aims to boost AI development and production capabilities within the region. ([8])\n",
  groundingMetadata: {
    searchEntryPoint: {
      renderedContent: '<style>\n' +
        '.container {\n' +
        '  align-items: center;\n' +
        '  border-radius: 8px;\n' +
        '  display: flex;\n' +
        '  font-family: Google Sans, Roboto, sans-serif;\n' +
        '  font-size: 14px;\n' +
        '  line-height: 20px;\n' +
        '  padding: 8px 12px;\n' +
        '}\n' +
        '.chip {\n' +
        '  display: inline-block;\n' +
        '  border: solid 1px;\n' +
        '  border-radius: 16px;\n' +
        '  min-width: 14px;\n' +
        '  padding: 5px 16px;\n' +
        '  text-align: center;\n' +
        '  user-select: none;\n' +
        '  margin: 0 8px;\n' +
        '  -webkit-tap-highlight-color: transparent;\n' +
        '}\n' +
        '.carousel {\n' +
        '  overflow: auto;\n' +
        '  scrollbar-width: none;\n' +
        '  white-space: nowrap;\n' +
        '  margin-right: -12px;\n' +
        '}\n' +
        '.headline {\n' +
        '  display: flex;\n' +
        '  margin-right: 4px;\n' +
        '}\n' +
        '.gradient-container {\n' +
        '  position: relative;\n' +
        '}\n' +
        '.gradient {\n' +
        '  position: absolute;\n' +
        '  transform: translate(3px, -9px);\n' +
        '  height: 36px;\n' +
        '  width: 9px;\n' +
        '}\n' +
        '@media (prefers-color-scheme: light) {\n' +
        '  .container {\n' +
        '    background-color: #fafafa;\n' +
        '    box-shadow: 0 0 0 1px #0000000f;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #1f1f1f;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #ffffff;\n' +
        '    border-color: #d2d2d2;\n' +
        '    color: #5e5e5e;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #d8d8d8;\n' +
        '    border-color: #b6b6b6;\n' +
        '  }\n' +
        '  .logo-dark {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #fafafa 15%, #fafafa00 100%);\n' +
        '  }\n' +
        '}\n' +
        '@media (prefers-color-scheme: dark) {\n' +
        '  .container {\n' +
        '    background-color: #1f1f1f;\n' +
        '    box-shadow: 0 0 0 1px #ffffff26;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #fff;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #2c2c2c;\n' +
        '    border-color: #3c4043;\n' +
        '    color: #fff;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #464849;\n' +
        '    border-color: #53575b;\n' +
        '  }\n' +
        '  .logo-light {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #1f1f1f 15%, #1f1f1f00 100%);\n' +
        '  }\n' +
        '}\n' +
        '</style>\n' +
        '<div class="container">\n' +
        '  <div class="headline">\n' +
        '    <svg class="logo-light" width="18" height="18" viewBox="9 9 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M42.8622 27.0064C42.8622 25.7839 42.7525 24.6084 42.5487 23.4799H26.3109V30.1568H35.5897C35.1821 32.3041 33.9596 34.1222 32.1258 35.3448V39.6864H37.7213C40.9814 36.677 42.8622 32.2571 42.8622 27.0064V27.0064Z" fill="#4285F4"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 43.8555C30.9659 43.8555 34.8687 42.3195 37.7213 39.6863L32.1258 35.3447C30.5898 36.3792 28.6306 37.0061 26.3109 37.0061C21.8282 37.0061 18.0195 33.9811 16.6559 29.906H10.9194V34.3573C13.7563 39.9841 19.5712 43.8555 26.3109 43.8555V43.8555Z" fill="#34A853"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M16.6559 29.8904C16.3111 28.8559 16.1074 27.7588 16.1074 26.6146C16.1074 25.4704 16.3111 24.3733 16.6559 23.3388V18.8875H10.9194C9.74388 21.2072 9.06992 23.8247 9.06992 26.6146C9.06992 29.4045 9.74388 32.022 10.9194 34.3417L15.3864 30.8621L16.6559 29.8904V29.8904Z" fill="#FBBC05"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 16.2386C28.85 16.2386 31.107 17.1164 32.9095 18.8091L37.8466 13.8719C34.853 11.082 30.9659 9.3736 26.3109 9.3736C19.5712 9.3736 13.7563 13.245 10.9194 18.8875L16.6559 23.3388C18.0195 19.2636 21.8282 16.2386 26.3109 16.2386V16.2386Z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <svg class="logo-dark" width="18" height="18" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <circle cx="24" cy="23" fill="#FFF" r="22"/>\n' +
        '      <path d="M33.76 34.26c2.75-2.56 4.49-6.37 4.49-11.26 0-.89-.08-1.84-.29-3H24.01v5.99h8.03c-.4 2.02-1.5 3.56-3.07 4.56v.75l3.91 2.97h.88z" fill="#4285F4"/>\n' +
        '      <path d="M15.58 25.77A8.845 8.845 0 0 0 24 31.86c1.92 0 3.62-.46 4.97-1.31l4.79 3.71C31.14 36.7 27.65 38 24 38c-5.93 0-11.01-3.4-13.45-8.36l.17-1.01 4.06-2.85h.8z" fill="#34A853"/>\n' +
        '      <path d="M15.59 20.21a8.864 8.864 0 0 0 0 5.58l-5.03 3.86c-.98-2-1.53-4.25-1.53-6.64 0-2.39.55-4.64 1.53-6.64l1-.22 3.81 2.98.22 1.08z" fill="#FBBC05"/>\n' +
        '      <path d="M24 14.14c2.11 0 4.02.75 5.52 1.98l4.36-4.36C31.22 9.43 27.81 8 24 8c-5.93 0-11.01 3.4-13.45 8.36l5.03 3.85A8.86 8.86 0 0 1 24 14.14z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <div class="gradient-container"><div class="gradient"></div></div>\n' +
        '  </div>\n' +
        '  <div class="carousel">\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEv98yhkVvqHOL0_lonB1v1UqHBEiwA4a6uNKxvoBZ5RgGg0W8nEyaW87IvKdpcdA9fRIsdaUa_VigVbt1h_o62Z0CQtP-5-7T2Ic5vWhCHcrFSp58qaCTATRqxVCR_7XRrzUapHsMVhRJ61eWVQVmBD7AiGs4KwY9mFqegCAFIh5tS41b6NHnZJGVFGJwV8rLUUdTy-_-lRA7acSUwpPjfb77mREEzWoHY2tn6CiymMrw=">recent breakthroughs in artificial intelligence</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQG8W27S_FhyoFHOMJyGxqsOansXARkR6sWViv68AztUtu5gRE-tEyPaFzDGl-ay4xtHVcWFER7RLNsNb8xz8WTg6gxFe5VD1M-4TXx6V9z3c1AA-LlU7YPyDwo-jYcExdZ4pH2bJoqdL6AkfuafhSeMfrtLlvizAHHMfIcOo-s0YQtHZf_3tdIUX7jFDhMfowjyoMfq3ZcAWUB9t_o3XGLFOf4=">latest AI developments this week</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFMwtoz3DLfde0tQyjNqkHP9wY3_ww8-Ai-G6rpu1HVAjHrxGIC02k_bwqH-8Bsj19VS94Y-g6ZNBnjz85QnVaCLoAKQ_KLCoBDycKvK-WN8RKFKww_FjZ_vLXKNk2hpV_Yco8yhnMGLiJJTt043_YkfsONtZFrzmtKw1MltoioO64ECmCd48nR9dXgU06Kde42oMADkMSL0tBta9EHDhNwoXo=">new AI models released this week</a>\n' +
        '  </div>\n' +
        '</div>\n'
    },
    groundingChunks: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object]
    ],
    groundingSupports: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object]
    ],
    retrievalMetadata: {},
    webSearchQueries: [
      'latest AI developments this week',
      'recent breakthroughs in artificial intelligence',
      'new AI models released this week'
    ]
  },
  groundingSources: [
    {
      type: 'search',
      title: 'openai.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGRMmGvSxrtfgCCheLr2qJljQscJ9B1Pu4n25vRnCVZnJCVpD8aLN0nVsGDqbE6Gdo_jb--6_goCFmdDNOAay7olG1dFxNfmILGa222XMtgee8RbGay0JQFo0Q_-d-vlStp0PLTxAJawYfe11FD9g==',
      snippet: ''
    },
    {
      type: 'search',
      title: 'openai.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQG4z17akc6VA6YHaUoNivYhqWbAwVXN75xD1LUsXbGiE4JPVOulsVL_wFRPFHNjEhlz5xZs7tT6-s2FIoIVbtatXqVzdHl8hYOAh_YR-PUPitOEk3ctpypGLrGA7tdL91YckUTURWg3eRqQXf8iRT4123whcFcI9JU5',
      snippet: ''
    },
    {
      type: 'search',
      title: 'blog.google',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEF4ZoUezLw9HYAj-iinM4bM89-tyycmWWrWfG7HGxcMNTFpHbr1Xidt2zodN46l_38lZEdB765E2pWgez567GhDL_cGqDbgeRHbFVzeq4bCg9GPmuoYUeRolUfohR9O5o80S9BQCw6aViDjav79McVryuxcv5R3w==',
      snippet: ''
    },
    {
      type: 'search',
      title: 'keele.ac.uk',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFqdtSeFLORBbzwSeTbmywsGQeM3Bfz2_n-7s2hk0tPuj10tYD0UJtHNgy3QijGTb-WVuwhcKu7XfOdi6lprAaQBYtA03re5ngDeeiuAgkYHZ4ARL82Ael2ZO8PmZFKuMq0KyPieUDc1gBWoa1AJePFIMA-aO5LdqSFo2ORsJQ4mKVr4yWn5xIV',
      snippet: ''
    },
    {
      type: 'search',
      title: 'economictimes.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGYwx3eZSY8ceBqXhkgyumKDb78F8JxYWC_3G9gXnkq87VZwGQ2W41iIsyyJ7LGtP0wzZ_Cjv8-lSqK4yZnNuKe8wqCDcdmZcW5QuOjxvh0tYNtzJnsmbjmVuSfe3IaRBwHhbWlBpocrbA7l8wHrSDbcGM=',
      snippet: ''
    },
    {
      type: 'search',
      title: 'blog.google',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGuvu7vm8OZTdD96hQsbiaqkkg0KabDlkc3dcn1xGeEnVy0kV9XKKG5zPiHGzbuaxWhTaKXbKeddC9QzcH3GuE_NzCx_o34GANMjN6cjltZRpbhWPo7BvvFx82iQ7IJizF0RG4u_--vf_RfbUSJ_rHeb9K5fTcffCP5',
      snippet: ''
    },
    {
      type: 'search',
      title: 'softude.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFWkATFc3rR7I4ZHzFMF_1SiBK7hT_5hzxGk-SaSeoCdyPixOwlq5JU_xLWygLRMl0x1HnrDDuCWps6Q6LXrQFj55Vgv59r4CZlg4RqUUP86cn-lHYxqz35CvpsaS_OaCOrIwVi4DHXnkJ29dr26_MuBi850HC0Sdpbxv9Wpf7gwbOkQZM1NR53',
      snippet: ''
    },
    {
      type: 'search',
      title: 'ironhack.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGfL3t17XP4FQ3liZ8EfdCPp4rCVUYSSKP_uP4ZSv3A59IMLERsLvzwzO18nNVzrhClqhydZrGf6KhJi8fftiT0_Zrx43ZKwE7iCVEJAhPuhiIe1CEKxxUFOHoBubf-V9ehelZ1_7v43JHx7o_yMSn1p-OfNUcCWIDc-Cv0vQrnkUC38lriljqM2RKii0T0SToJV2nflg==',
      snippet: ''
    },
    {
      type: 'search',
      title: 'artificialintelligence-news.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQG0OJ_JLdxiy7OFvkqnrSRNsqNC1XuYWIagZ8_ZKf90uLFHh8s7xGsCKqLL0y8peNYqIyFFbm2NIBPrIWppIsAFVtBj_qP9cGA6LyirW1RvMUkDGfYG5_9qfBx7ohRVsTIzNeWK91E=',
      snippet: ''
    },
    {
      type: 'search',
      title: 'crescendo.ai',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFEDpG0YUjb1wBdg_CQ6b8gRF25HqNt89-7QthYezHjKXo4xkDCCqak1j7JIoLQVp3uJIlroyykzeZrcaUAnQgonlU5d6ajN3_hloH10X-7aUza6mSBU0vl90B9jkZGP1p8GFttvomsFUutHFQRWtk3azE=',
      snippet: ''
    }
  ],
  thinkingSteps: undefined,
  outputImages: undefined,
  updatedChatHistory: undefined,
  usage: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: true
  - Has grounding sources: true
  - Grounding metadata keys: [
  'searchEntryPoint',
  'groundingChunks',
  'groundingSupports',
  'retrievalMetadata',
  'webSearchQueries'
]
  - Search queries: [
  'latest AI developments this week',
  'recent breakthroughs in artificial intelligence',
  'new AI models released this week'
]
  - Grounding chunks: 10
  - Grounding supports: 8
  - Grounding sources count: 10
  - First source: {
  type: 'search',
  title: 'openai.com',
  url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGRMmGvSxrtfgCCheLr2qJljQscJ9B1Pu4n25vRnCVZnJCVpD8aLN0nVsGDqbE6Gdo_jb--6_goCFmdDNOAay7olG1dFxNfmILGa222XMtgee8RbGay0JQFo0Q_-d-vlStp0PLTxAJawYfe11FD9g==',
  snippet: ''
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 4494ms
 âœ“ Compiled in 136ms (313 modules)
Debugger listening on ws://127.0.0.1:9229/e826f3a3-e0f4-4e29-96d8-664404f00c84
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 169053,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/7cf4e267-8cf7-4bb7-9427-9dbfe0524b64
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1360ms
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 â—‹ Compiling /api/wizard/execute ...
 âœ“ Compiled /api/wizard/execute in 715ms (590 modules)
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.7,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 267
[runAiStage] First 200 chars of filled prompt: Answer this question using current information from Google Search: what happened ysterday in austria


IMPORTANT: Use Google Search grounding to find real, current information. Provide actual search r
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 267,
  model: 'gemini-2.0-flash',
  temperature: 0.7,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'Answer this question using current information from Google Search: what happened ysterday in austria...',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 267
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.7
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
 â—‹ Compiling /api/documents/save ...
 âœ“ Compiled /api/documents/save in 835ms (724 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T10:12:45.585Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 1727ms
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 3,
  supportsCount: 3,
  searchQueries: 1,
  sourcesExtracted: 3
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 1030,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 3,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
 POST /api/wizard/execute 200 in 3779ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 263ms
 âœ“ Compiled /api/test-ai in 206ms (726 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  promptTemplate: 'What are the latest breakthrough developments in quantum computing from the past month? Provide 3 specific examples with sources and explain their significance.',
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  systemInstructions: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources with URLs and provide detailed explanations.',
  streamingSettings: { enabled: false }
}
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 160
[runAiStage] First 200 chars of filled prompt: What are the latest breakthrough developments in quantum computing from the past month? Provide 3 specific examples with sources and explain their significance.
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 160,
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'What are the latest breakthrough developments in quantum computing from the past month? Provide 3 sp...',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 160
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.2
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 0,
  supportsCount: 0,
  searchQueries: 3,
  sourcesExtracted: 0
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 4175,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 0,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
[TEST-AI] Result: {
  content: 'Here are three recent breakthrough developments in quantum computing:\n' +
    '\n' +
    "1.  **IBM's Path to Fault-Tolerant Quantum Computing:** IBM has unveiled its roadmap to building the world's first large-scale, fault-tolerant quantum computer, named IBM Quantum Starling, expected by 2029. This system will be housed in a new IBM Quantum Data Center in Poughkeepsie, New York, and is projected to perform 20,000 times more operations than current quantum computers. Key to this is the development of processors like IBM Quantum Loon (expected in 2025) and IBM Quantum Kookaburra (2026), which are designed to test and implement error correction and modularity. A large-scale, fault-tolerant quantum computer could revolutionize fields like drug development, materials discovery, and chemistry by enabling the execution of hundreds of millions to billions of operations. [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHUhMTUBBM5aC4qHosAj3PNYNVJFAPJvSwOK69c86kGTwtlyeW0WQQg\\_Ut0QY2ms74w8jpZ56\\_SKn0IPw1tD3BYlTg-3PfZCGz-NAhGHDMyPAQpGAo5fXqbAm5NMNmT\\_N5JTD5mk4aPzpSf61rXWo1Lt\\_471P8zX6bHoOMkV6W4eS8H6KSyZAfIKqdu6N8WH3TKtakut\\_ecLNx1BdgYzt\\_mhtro2mY1AEVOnWmQ2vTLFyOOE03gYWk3aH5zGkKwV57m60GdoLKdu34F6nScDTPyRrX4oZ4=](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHUhMTUBBM5aC4qHosAj3PNYNVJFAPJvSwOK69c86kGTwtlyeW0WQQg_Ut0QY2ms74w8jpZ56_SKn0IPw1tD3BYlTg-3PfZCGz-NAhGHDMyPAQpGAo5fXqbAm5NMNmT_N5JTD5mk4aPzpSf61rXWo1Lt_471P8zX6bHoOMkV6W4eS8H6KSyZAfIKqdu6N8WH3TKtakut_ecLNx1BdgYzt_mhtro2mY1AEVOnWmQ2vTLFyOOE03gYWk3aH5zGkKwV57m60GdoLKdu34F6nScDTPyRrX4oZ4=)\n" +
    `2.  **Nvidia's CUDA-Q for Hybrid Quantum-Classical Computing:** Nvidia CEO Jensen Huang announced that quantum computing is reaching an "inflection point" and introduced CUDA-Q, a platform designed to integrate quantum and classical computing systems. CUDA-Q is an open-source platform that allows hardware and software components to work together in quantum computing applications. Huang envisions a future where every supercomputer will have a quantum processing unit (QPU) connected to GPUs, enabling solutions to previously unsolvable problems. This development suggests a shift towards hybrid architectures to leverage the strengths of both quantum and classical computing. [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQE5587-jmKOpJ6xydnYJPHX2DR04iEyya6n7txaDiPvFZAPX0V\\_bJ1vS54aDPwauRQPzf9g8pDtfDBSIES3TmrdZV--T16EN8F5SndPRz8MdYy9zrVlrAJuHm3TrdFut2O7frOXmCFUzXfHY7E9vlGGCJOH8JbPbwUcmrDzGdMkqj7dQSjZcvdjFOl73-v5HXe3kbaddVTWUjyqdh3kVvHIZT5GgdYOL4faKNhdiQ==](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQE5587-jmKOpJ6xydnYJPHX2DR04iEyya6n7txaDiPvFZAPX0V_bJ1vS54aDPwauRQPzf9g8pDtfDBSIES3TmrdZV--T16EN8F5SndPRz8MdYy9zrVlrAJuHm3TrdFut2O7frOXmCFUzXfHY7E9vlGGCJOH8JbPbwUcmrDzGdMkqj7dQSjZcvdjFOl73-v5HXe3kbaddVTWUjyqdh3kVvHIZT5GgdYOL4faKNhdiQ==)\n` +
    "3.  **Microsoft's Topological Qubit and Majorana 1 Processor:** Microsoft is developing topological qubits and has created the Majorana 1 processor. This processor is built using a new material called a topoconductor and is designed to scale to a million qubits on a single chip. Topological qubits are expected to be more stable and less prone to errors than traditional qubits, addressing a significant challenge in quantum computing. Microsoft aims to build a fault-tolerant prototype based on topological qubits, potentially leading to more reliable and scalable quantum computers. [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQF6mT0M-51p\\_2OeBSujiY4STo6pl9\\_tAEY4AndeqKgCSPFq9x1vnRP4djdmYNrHNtRpJIeLAVXWCUylRnhr0swolziCGylIEP3EWGMnUe5oJMkBu\\_2QbpCdLaiIljL\\_AlzCeqZz2uncHpq3SO9xqJBtamUdXNeMBibKCLclHKGOkjLPtHIKtfir6lnSGCfUVg4Hdt6QADeuiT9N8CCZKtBOxrTbp5oxGoZ0GJDrlRoOAhJ3yxH47pUYxo5CFqcSeBbCfv2-Y0wHVBYtkmfBkcd0toWhZg==](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQF6mT0M-51p_2OeBSujiY4STo6pl9_tAEY4AndeqKgCSPFq9x1vnRP4djdmYNrHNtRpJIeLAVXWCUylRnhr0swolziCGylIEP3EWGMnUe5oJMkBu_2QbpCdLaiIljL_AlzCeqZz2uncHpq3SO9xqJBtamUdXNeMBibKCLclHKGOkjLPtHIKtfir6lnSGCfUVg4Hdt6QADeuiT9N8CCZKtBOxrTbp5oxGoZ0GJDrlRoOAhJ3yxH47pUYxo5CFqcSeBbCfv2-Y0wHVBYtkmfBkcd0toWhZg==)\n",
  groundingMetadata: {
    searchEntryPoint: {
      renderedContent: '<style>\n' +
        '.container {\n' +
        '  align-items: center;\n' +
        '  border-radius: 8px;\n' +
        '  display: flex;\n' +
        '  font-family: Google Sans, Roboto, sans-serif;\n' +
        '  font-size: 14px;\n' +
        '  line-height: 20px;\n' +
        '  padding: 8px 12px;\n' +
        '}\n' +
        '.chip {\n' +
        '  display: inline-block;\n' +
        '  border: solid 1px;\n' +
        '  border-radius: 16px;\n' +
        '  min-width: 14px;\n' +
        '  padding: 5px 16px;\n' +
        '  text-align: center;\n' +
        '  user-select: none;\n' +
        '  margin: 0 8px;\n' +
        '  -webkit-tap-highlight-color: transparent;\n' +
        '}\n' +
        '.carousel {\n' +
        '  overflow: auto;\n' +
        '  scrollbar-width: none;\n' +
        '  white-space: nowrap;\n' +
        '  margin-right: -12px;\n' +
        '}\n' +
        '.headline {\n' +
        '  display: flex;\n' +
        '  margin-right: 4px;\n' +
        '}\n' +
        '.gradient-container {\n' +
        '  position: relative;\n' +
        '}\n' +
        '.gradient {\n' +
        '  position: absolute;\n' +
        '  transform: translate(3px, -9px);\n' +
        '  height: 36px;\n' +
        '  width: 9px;\n' +
        '}\n' +
        '@media (prefers-color-scheme: light) {\n' +
        '  .container {\n' +
        '    background-color: #fafafa;\n' +
        '    box-shadow: 0 0 0 1px #0000000f;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #1f1f1f;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #ffffff;\n' +
        '    border-color: #d2d2d2;\n' +
        '    color: #5e5e5e;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #d8d8d8;\n' +
        '    border-color: #b6b6b6;\n' +
        '  }\n' +
        '  .logo-dark {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #fafafa 15%, #fafafa00 100%);\n' +
        '  }\n' +
        '}\n' +
        '@media (prefers-color-scheme: dark) {\n' +
        '  .container {\n' +
        '    background-color: #1f1f1f;\n' +
        '    box-shadow: 0 0 0 1px #ffffff26;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #fff;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #2c2c2c;\n' +
        '    border-color: #3c4043;\n' +
        '    color: #fff;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #464849;\n' +
        '    border-color: #53575b;\n' +
        '  }\n' +
        '  .logo-light {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #1f1f1f 15%, #1f1f1f00 100%);\n' +
        '  }\n' +
        '}\n' +
        '</style>\n' +
        '<div class="container">\n' +
        '  <div class="headline">\n' +
        '    <svg class="logo-light" width="18" height="18" viewBox="9 9 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M42.8622 27.0064C42.8622 25.7839 42.7525 24.6084 42.5487 23.4799H26.3109V30.1568H35.5897C35.1821 32.3041 33.9596 34.1222 32.1258 35.3448V39.6864H37.7213C40.9814 36.677 42.8622 32.2571 42.8622 27.0064V27.0064Z" fill="#4285F4"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 43.8555C30.9659 43.8555 34.8687 42.3195 37.7213 39.6863L32.1258 35.3447C30.5898 36.3792 28.6306 37.0061 26.3109 37.0061C21.8282 37.0061 18.0195 33.9811 16.6559 29.906H10.9194V34.3573C13.7563 39.9841 19.5712 43.8555 26.3109 43.8555V43.8555Z" fill="#34A853"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M16.6559 29.8904C16.3111 28.8559 16.1074 27.7588 16.1074 26.6146C16.1074 25.4704 16.3111 24.3733 16.6559 23.3388V18.8875H10.9194C9.74388 21.2072 9.06992 23.8247 9.06992 26.6146C9.06992 29.4045 9.74388 32.022 10.9194 34.3417L15.3864 30.8621L16.6559 29.8904V29.8904Z" fill="#FBBC05"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 16.2386C28.85 16.2386 31.107 17.1164 32.9095 18.8091L37.8466 13.8719C34.853 11.082 30.9659 9.3736 26.3109 9.3736C19.5712 9.3736 13.7563 13.245 10.9194 18.8875L16.6559 23.3388C18.0195 19.2636 21.8282 16.2386 26.3109 16.2386V16.2386Z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <svg class="logo-dark" width="18" height="18" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <circle cx="24" cy="23" fill="#FFF" r="22"/>\n' +
        '      <path d="M33.76 34.26c2.75-2.56 4.49-6.37 4.49-11.26 0-.89-.08-1.84-.29-3H24.01v5.99h8.03c-.4 2.02-1.5 3.56-3.07 4.56v.75l3.91 2.97h.88z" fill="#4285F4"/>\n' +
        '      <path d="M15.58 25.77A8.845 8.845 0 0 0 24 31.86c1.92 0 3.62-.46 4.97-1.31l4.79 3.71C31.14 36.7 27.65 38 24 38c-5.93 0-11.01-3.4-13.45-8.36l.17-1.01 4.06-2.85h.8z" fill="#34A853"/>\n' +
        '      <path d="M15.59 20.21a8.864 8.864 0 0 0 0 5.58l-5.03 3.86c-.98-2-1.53-4.25-1.53-6.64 0-2.39.55-4.64 1.53-6.64l1-.22 3.81 2.98.22 1.08z" fill="#FBBC05"/>\n' +
        '      <path d="M24 14.14c2.11 0 4.02.75 5.52 1.98l4.36-4.36C31.22 9.43 27.81 8 24 8c-5.93 0-11.01 3.4-13.45 8.36l5.03 3.85A8.86 8.86 0 0 1 24 14.14z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <div class="gradient-container"><div class="gradient"></div></div>\n' +
        '  </div>\n' +
        '  <div class="carousel">\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQG3_vW_UEX71ko74OKRh6Pe0BmJiblymfpm0blNAEINpuFkSnWwkMLKim905z0zLCwN332LRYerfAbLhBbRUXAzlbVInyQv8AGsbLKBzRK8C3k6ZgGHdGruuQcuO9O8K5uCYmN0RWLitZCq7sC1xuh8Qcn9g3K7YSXalcxF84UWGBeKCAjJwZgErwfX6PqSU9DleZMxVnNljjdEGH0gJAr7_BfLFNWjlyQMLt-6wwdZ9jNLF5pTmg==">recent advancements in quantum computing June 2025</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGTcHy9msQayEFzA2uX2y_eoRj8erykZnO9n5TDa_rA5qorwW6OOaweG9bablxPLjjCLh6uWKcn9kom0F583IjEm6ZsHEUu8yxiKDddGM582adVkWezKdWeKK4vx-QNvOjGLz0qHd04NzBowrjmlsX3Vo70R8mDG9NnpubJwXnyWIxPATycnLmeD_0shFPL5ausocZqks8jD5mXXVsha3sL0-wz8lg26ivV4-ZQLqjHjqCB4Lo=">latest quantum computing breakthroughs last month</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQH0ucsbOd5F-dFYpl08A9mhZecXZ2WHTB4JHRf-mTpXl4ja4v880fdHtwL3r_5k18hmGdNpIeYbcRzoYWQDrxyxsiojcARzRWz_pLfyqbSgPcAAGPoUH-B8wEydyllknbiUWQWqvWHhzWy471pUQyd0K1HE1n5GyK-G8FHV0YsA8zNaKJ61VTOJKIIEoV1Me2izlg7Cmdm4lCDhdC3JbJyfpZx_">quantum computing news June 2025</a>\n' +
        '  </div>\n' +
        '</div>\n'
    },
    retrievalMetadata: {},
    webSearchQueries: [
      'latest quantum computing breakthroughs last month',
      'recent advancements in quantum computing June 2025',
      'quantum computing news June 2025'
    ]
  },
  groundingSources: [],
  thinkingSteps: undefined,
  outputImages: undefined,
  updatedChatHistory: undefined,
  usage: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: true
  - Has grounding sources: false
  - Grounding metadata keys: [ 'searchEntryPoint', 'retrievalMetadata', 'webSearchQueries' ]
  - Search queries: [
  'latest quantum computing breakthroughs last month',
  'recent advancements in quantum computing June 2025',
  'quantum computing news June 2025'
]
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 9735ms
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.7,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 267
[runAiStage] First 200 chars of filled prompt: Answer this question using current information from Google Search: what happened ysterday in austria


IMPORTANT: Use Google Search grounding to find real, current information. Provide actual search r
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 267,
  model: 'gemini-2.0-flash',
  temperature: 0.7,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'Answer this question using current information from Google Search: what happened ysterday in austria...',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 267
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.7
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T10:13:24.048Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 621ms
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 3,
  supportsCount: 9,
  searchQueries: 1,
  sourcesExtracted: 3
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 1238,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 3,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
 POST /api/wizard/execute 200 in 3076ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 298ms
 âœ“ Compiled in 220ms (449 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  promptTemplate: 'What are the latest developments in AI reasoning models this week? Provide 3 specific examples with sources.',
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  systemInstructions: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources with URLs.',
  streamingSettings: { enabled: false }
}
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 108
[runAiStage] First 200 chars of filled prompt: What are the latest developments in AI reasoning models this week? Provide 3 specific examples with sources.
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 108,
  model: 'gemini-2.0-flash',
  temperature: 0.2,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'What are the latest developments in AI reasoning models this week? Provide 3 specific examples with ...',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 108
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.2
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 0,
  supportsCount: 0,
  searchQueries: 3,
  sourcesExtracted: 0
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 4714,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 0,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
[TEST-AI] Result: {
  content: 'Here are three specific examples of the latest developments in AI reasoning models this week:\n' +
    '\n' +
    `1.  **Mistral AI's Magistral:** On June 10, 2025, Mistral AI launched Magistral, its first reasoning model, excelling in domain-specific, transparent, and multilingual reasoning. It comes in two versions: Magistral Small (a 24B parameter open-source version) and Magistral Medium (a more powerful, enterprise version). Magistral Medium scored 73.6% on AIME2024 and 90% with majority voting @64, while Magistral Small scored 70.7% and 83.3%, respectively. Magistral is designed to "think things through" like humans, bringing expertise across professional domains with transparent reasoning. It is suited for various enterprise use cases, from structured calculations and programmatic logic to decision trees and rule-based systems. [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGzsTb2mw2DkigeOJGOr2PibkJm3OgYBfmOnA0n1-_z2eZJlhFPzBfxj7qF8iX83eGG8XeMX_4H5li-jH62CZDB-LR6g5AsJJ8fBvx9HCU-sVmOFD-C0RbJcBi_](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGzsTb2mw2DkigeOJGOr2PibkJm3OgYBfmOnA0n1-_z2eZJlhFPzBfxj7qF8iX83eGG8XeMX_4H5li-jH62CZDB-LR6g5AsJJ8fBvx9HCU-sVmOFD-C0RbJcBi_) and [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGFpzv5P23cqtaNdvdXxYia39D6PK76kt8Zngzj-vp7Pc04PNPmSduUj0buMF6WUGPK2V-kMvE3T1C5VQA3F_0vHzIVbk37QGuge_lQQzzlfJG0sFF9_UnB49Z4WAn9EnWE8nFvK5vS10pQRS6Sttz7SsPlZC1TN1_cSosvXrSzjLSgJDv_m-c6ntFtUZk8yPWY](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGFpzv5P23cqtaNdvdXxYia39D6PK76kt8Zngzj-vp7Pc04PNPmSduUj0buMF6WUGPK2V-kMvE3T1C5VQA3F_0vHzIVbk37QGuge_lQQzzlfJG0sFF9_UnB49Z4WAn9EnWE8nFvK5vS10pQRS6Sttz7SsPlZC1TN1_cSosvXrSzjLSgJDv_m-c6ntFtUZk8yPWY)\n` +
    `2.  **Apple's Research on Limitations of Reasoning Models:** A recent paper from Apple researchers indicates that AI reasoning models may not be "thinking" as well as previously thought. These models, including OpenAI's o1 and o3, DeepSeek R1, Claude 3.7 Sonnet Thinking, and Google Gemini Flash Thinking, can collapse when faced with increasingly complex problems. While they outperform standard LLMs on medium-difficulty puzzles, they perform worse on simple puzzles and give up prematurely on hard puzzles. The researchers suggest that these models may only provide "The Illusion of Thinking." [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHpXitwZ5PrDkzQNnF-L46vppiqOXKBNc6UZLIuWLMiPyzhzZxa4UAO1WnE1G4pKbD0Ejxft3zxNNbFOg8RBb9mXpnZQl5A4YUkaFOFKaqieHgMuX8Ua63SMOHqC2uis7JyJNsfYmtKjjBxjENMAhGjmbKnbGxQsEAJSEaYBuxLFR095gl_LewLV9Odi1c3LSI=](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHpXitwZ5PrDkzQNnF-L46vppiqOXKBNc6UZLIuWLMiPyzhzZxa4UAO1WnE1G4pKbD0Ejxft3zxNNbFOg8RBb9mXpnZQl5A4YUkaFOFKaqieHgMuX8Ua63SMOHqC2uis7JyJNsfYmtKjjBxjENMAhGjmbKnbGxQsEAJSEaYBuxLFR095gl_LewLV9Odi1c3LSI=) and [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGsyhy2_FWvC-c7oEU4HOsBiszZvNnSU8ZtFo4utlwm99UINM2TIq2vIxde069mUxrJKaaUEdWvi3sjqEm1hsWRqMvP0uHfv-0YL4-Ogn0j4FQhsPNwL2LRZJoctpkZagS3J_c4d5v42n4XXV7jQHtK2XlIZNouofLygxmJA41VWX9EqD0jXS4F9BpNuMG-kYktV8PwD2GdVVzdMV5vCCsyZ2PIbwaGWl3izYDLj-ydr1ZcFHmYkmA5F0KcqXT8fUg3HVCU7GoZugpdn4ylogHyXrrbI-6A-KU7o1_cFkMLYuazW90=](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGsyhy2_FWvC-c7oEU4HOsBiszZvNnSU8ZtFo4utlwm99UINM2TIq2vIxde069mUxrJKaaUEdWvi3sjqEm1hsWRqMvP0uHfv-0YL4-Ogn0j4FQhsPNwL2LRZJoctpkZagS3J_c4d5v42n4XXV7jQHtK2XlIZNouofLygxmJA41VWX9EqD0jXS4F9BpNuMG-kYktV8PwD2GdVVzdMV5vCCsyZ2PIbwaGWl3izYDLj-ydr1ZcFHmYkmA5F0KcqXT8fUg3HVCU7GoZugpdn4ylogHyXrrbI-6A-KU7o1_cFkMLYuazW90=)\n` +
    '3.  **Developments in Healthcare AI Reasoning Models:** Generative AI (GenAI) reasoning models are enabling healthcare professionals to work more efficiently. Recent models provide transparency into their decision-making processes and can power advanced AI agents using healthcare-specific models like Google AIM, Med-PaLM 2, or Med-R1. This auditability is crucial in healthcare, where understanding why a recommendation was made is often as important as the recommendation itself. [https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEamJdR-zza8q-016W3VFEoGltqTG7--3-v0DQa2YkyyVWUdjQPzf1Uhb13-F98yClhWPXqEaMXY-x5xdU9BdPEy1z-UvYgR8Keo2gkHhjg3Ymn9z2-6hk0dQtnQop4E7VNRGjghswtwbbAq5bGufPQN4ODLf1x47eABeBRUW7dBfPlEm1CNNWMahU6ndjdDlqxZlVdezpDAZebN36_UTQTNdXKYm6V8dWo](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEamJdR-zza8q-016W3VFEoGltqTG7--3-v0DQa2YkyyVWUdjQPzf1Uhb13-F98yClhWPXqEaMXY-x5xdU9BdPEy1z-UvYgR8Keo2gkHhjg3Ymn9z2-6hk0dQtnQop4E7VNRGjghswtwbbAq5bGufPQN4ODLf1x47eABeBRUW7dBfPlEm1CNNWMahU6ndjdDlqxZlVdezpDAZebN36_UTQTNdXKYm6V8dWo)\n',
  groundingMetadata: {
    searchEntryPoint: {
      renderedContent: '<style>\n' +
        '.container {\n' +
        '  align-items: center;\n' +
        '  border-radius: 8px;\n' +
        '  display: flex;\n' +
        '  font-family: Google Sans, Roboto, sans-serif;\n' +
        '  font-size: 14px;\n' +
        '  line-height: 20px;\n' +
        '  padding: 8px 12px;\n' +
        '}\n' +
        '.chip {\n' +
        '  display: inline-block;\n' +
        '  border: solid 1px;\n' +
        '  border-radius: 16px;\n' +
        '  min-width: 14px;\n' +
        '  padding: 5px 16px;\n' +
        '  text-align: center;\n' +
        '  user-select: none;\n' +
        '  margin: 0 8px;\n' +
        '  -webkit-tap-highlight-color: transparent;\n' +
        '}\n' +
        '.carousel {\n' +
        '  overflow: auto;\n' +
        '  scrollbar-width: none;\n' +
        '  white-space: nowrap;\n' +
        '  margin-right: -12px;\n' +
        '}\n' +
        '.headline {\n' +
        '  display: flex;\n' +
        '  margin-right: 4px;\n' +
        '}\n' +
        '.gradient-container {\n' +
        '  position: relative;\n' +
        '}\n' +
        '.gradient {\n' +
        '  position: absolute;\n' +
        '  transform: translate(3px, -9px);\n' +
        '  height: 36px;\n' +
        '  width: 9px;\n' +
        '}\n' +
        '@media (prefers-color-scheme: light) {\n' +
        '  .container {\n' +
        '    background-color: #fafafa;\n' +
        '    box-shadow: 0 0 0 1px #0000000f;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #1f1f1f;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #ffffff;\n' +
        '    border-color: #d2d2d2;\n' +
        '    color: #5e5e5e;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #d8d8d8;\n' +
        '    border-color: #b6b6b6;\n' +
        '  }\n' +
        '  .logo-dark {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #fafafa 15%, #fafafa00 100%);\n' +
        '  }\n' +
        '}\n' +
        '@media (prefers-color-scheme: dark) {\n' +
        '  .container {\n' +
        '    background-color: #1f1f1f;\n' +
        '    box-shadow: 0 0 0 1px #ffffff26;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #fff;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #2c2c2c;\n' +
        '    border-color: #3c4043;\n' +
        '    color: #fff;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #464849;\n' +
        '    border-color: #53575b;\n' +
        '  }\n' +
        '  .logo-light {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #1f1f1f 15%, #1f1f1f00 100%);\n' +
        '  }\n' +
        '}\n' +
        '</style>\n' +
        '<div class="container">\n' +
        '  <div class="headline">\n' +
        '    <svg class="logo-light" width="18" height="18" viewBox="9 9 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M42.8622 27.0064C42.8622 25.7839 42.7525 24.6084 42.5487 23.4799H26.3109V30.1568H35.5897C35.1821 32.3041 33.9596 34.1222 32.1258 35.3448V39.6864H37.7213C40.9814 36.677 42.8622 32.2571 42.8622 27.0064V27.0064Z" fill="#4285F4"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 43.8555C30.9659 43.8555 34.8687 42.3195 37.7213 39.6863L32.1258 35.3447C30.5898 36.3792 28.6306 37.0061 26.3109 37.0061C21.8282 37.0061 18.0195 33.9811 16.6559 29.906H10.9194V34.3573C13.7563 39.9841 19.5712 43.8555 26.3109 43.8555V43.8555Z" fill="#34A853"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M16.6559 29.8904C16.3111 28.8559 16.1074 27.7588 16.1074 26.6146C16.1074 25.4704 16.3111 24.3733 16.6559 23.3388V18.8875H10.9194C9.74388 21.2072 9.06992 23.8247 9.06992 26.6146C9.06992 29.4045 9.74388 32.022 10.9194 34.3417L15.3864 30.8621L16.6559 29.8904V29.8904Z" fill="#FBBC05"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 16.2386C28.85 16.2386 31.107 17.1164 32.9095 18.8091L37.8466 13.8719C34.853 11.082 30.9659 9.3736 26.3109 9.3736C19.5712 9.3736 13.7563 13.245 10.9194 18.8875L16.6559 23.3388C18.0195 19.2636 21.8282 16.2386 26.3109 16.2386V16.2386Z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <svg class="logo-dark" width="18" height="18" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <circle cx="24" cy="23" fill="#FFF" r="22"/>\n' +
        '      <path d="M33.76 34.26c2.75-2.56 4.49-6.37 4.49-11.26 0-.89-.08-1.84-.29-3H24.01v5.99h8.03c-.4 2.02-1.5 3.56-3.07 4.56v.75l3.91 2.97h.88z" fill="#4285F4"/>\n' +
        '      <path d="M15.58 25.77A8.845 8.845 0 0 0 24 31.86c1.92 0 3.62-.46 4.97-1.31l4.79 3.71C31.14 36.7 27.65 38 24 38c-5.93 0-11.01-3.4-13.45-8.36l.17-1.01 4.06-2.85h.8z" fill="#34A853"/>\n' +
        '      <path d="M15.59 20.21a8.864 8.864 0 0 0 0 5.58l-5.03 3.86c-.98-2-1.53-4.25-1.53-6.64 0-2.39.55-4.64 1.53-6.64l1-.22 3.81 2.98.22 1.08z" fill="#FBBC05"/>\n' +
        '      <path d="M24 14.14c2.11 0 4.02.75 5.52 1.98l4.36-4.36C31.22 9.43 27.81 8 24 8c-5.93 0-11.01 3.4-13.45 8.36l5.03 3.85A8.86 8.86 0 0 1 24 14.14z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <div class="gradient-container"><div class="gradient"></div></div>\n' +
        '  </div>\n' +
        '  <div class="carousel">\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQFS15tQnRL_H0DqfyW4UP7V6RzNuJrIe0x4RI33gjNbZx9RyiTkI6ykdgF1w1MAhUynEp1utMyTLdc6AkeyciwVV6BXVb6ns1OBeNZRybjpEu8aM-7JpdUnpR3gOsGxuYNt092pExp2RCovboKT3v81rKu6NTP8cY5hVyconiPzo-CiZ5jh2aTWYpdXJzhEA_tv-qBZYigOAfc19fv4qfnXyla9IyMQkA==">AI reasoning models advancements 2025</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGEKhfraEm6xDn9ql3PIVnEBeD0K4_yABRalBy7LTlpDiHhSVSJHx6C8nck89Ps1EnVKbz5xR4ZVX1jI5MQehkUsCZmadBVwA9CkSza0nWqdqq7duTA05mscl-X_YQ0VisOLnIaXvaZW6K7AiBEyGCDRVUQfRsFABo_qco8hG-ewBcBUpmtUvU_lhgOSjqHeu02iH7tyB4guUv8vci9VIq9S_bmh7U2TCcbebO4IvyF3KvRgQ==">latest developments AI reasoning models this week</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHMfsQ99Kx-LVueFNhh6wK4nQ9AHshflH0T-PCVs5zuR53GuN_4ozt8S9bUzKdel4qAXg9DP37_HNZoyYIYvo5fBb4mFxzmXAkjOdBAX229D_rmw2_vjyl3B7NVXkQcWDZG2yKTzc7BrLp5EG_gykXhyTGHmF-lrzF-Mg14PPHIAYINFLMaE90IsyaVy4j3RDmzcnXVljC-jmZFlZn5Ca0VsIae">new AI reasoning models June 2025</a>\n' +
        '  </div>\n' +
        '</div>\n'
    },
    retrievalMetadata: {},
    webSearchQueries: [
      'latest developments AI reasoning models this week',
      'AI reasoning models advancements 2025',
      'new AI reasoning models June 2025'
    ]
  },
  groundingSources: [],
  thinkingSteps: undefined,
  outputImages: undefined,
  updatedChatHistory: undefined,
  usage: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: true
  - Has grounding sources: false
  - Grounding metadata keys: [ 'searchEntryPoint', 'retrievalMetadata', 'webSearchQueries' ]
  - Search queries: [
  'latest developments AI reasoning models this week',
  'AI reasoning models advancements 2025',
  'new AI reasoning models June 2025'
]
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 11545ms
Debugger listening on ws://127.0.0.1:9229/b4840af1-6ef6-4da4-9590-ae711dd4cd2c
For help, see: https://nodejs.org/en/docs/inspector
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STOPPED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "durationMilliseconds": 166558,
    "turboFlag": false,
    "pagesDir": false,
    "appDir": true,
    "isRspack": false
  }
}
[?25h
Debugger listening on ws://127.0.0.1:9230/79557a17-d829-4324-9b8c-0bab4c703295
For help, see: https://nodejs.org/en/docs/inspector
   the --inspect option was detected, the Next.js router server should be inspected at 9230.
   â–² Next.js 15.3.3
   - Local:        http://localhost:9002
   - Network:      http://192.168.1.200:9002
   - Environments: .env.local, .env

 âœ“ Starting...
[telemetry] {
  "eventName": "NEXT_CLI_SESSION_STARTED",
  "payload": {
    "nextVersion": "15.3.3",
    "nodeVersion": "v22.16.0",
    "cliCommand": "dev",
    "isSrcDir": true,
    "hasNowJson": false,
    "isCustomServer": false,
    "hasNextConfig": true,
    "buildTarget": "default",
    "hasWebpackConfig": false,
    "hasBabelConfig": false,
    "imageEnabled": true,
    "imageFutureEnabled": true,
    "basePathEnabled": false,
    "i18nEnabled": false,
    "locales": null,
    "localeDomainsCount": null,
    "localeDetectionEnabled": null,
    "imageDomainsCount": 0,
    "imageRemotePatternsCount": 1,
    "imageLocalPatternsCount": null,
    "imageSizes": "16,32,48,64,96,128,256,384",
    "imageQualities": null,
    "imageLoader": "default",
    "imageFormats": "image/webp",
    "nextConfigOutput": null,
    "trailingSlashEnabled": false,
    "reactStrictMode": false,
    "webpackVersion": 5,
    "turboFlag": false,
    "isRspack": false,
    "appDir": true,
    "pagesDir": false,
    "staticStaleTime": 300,
    "dynamicStaleTime": 0,
    "reactCompiler": false,
    "reactCompilerCompilationMode": null,
    "reactCompilerPanicThreshold": null
  }
}
[telemetry] {
  "eventName": "NEXT_BUILD_FEATURE_USAGE",
  "payload": {
    "featureName": "turbopackPersistentCaching",
    "invocationCount": 0
  }
}
 âœ“ Ready in 1494ms
Watchpack Error (initial scan): Error: ENOTDIR: not a directory, scandir '/usr/local/bin/node'
 â—‹ Compiling /api/test-ai ...
 âœ“ Compiled /api/test-ai in 507ms (590 modules)
[TEST-AI] Starting POST test...
[TEST-AI] Request body: {
  promptTemplate: 'What are the most significant developments in quantum computing from this past week? Provide 3 specific examples with sources and explain their impact.',
  model: 'gemini-2.0-flash',
  temperature: 0.1,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  systemInstructions: 'You are an AI assistant that provides up-to-date information using Google Search. Always cite your sources with URLs and provide detailed explanations.',
  streamingSettings: { enabled: false }
}
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.1,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 151
[runAiStage] First 200 chars of filled prompt: What are the most significant developments in quantum computing from this past week? Provide 3 specific examples with sources and explain their impact.
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 151,
  model: 'gemini-2.0-flash',
  temperature: 0.1,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'What are the most significant developments in quantum computing from this past week? Provide 3 speci...',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 151
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.1
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 2,
  supportsCount: 6,
  searchQueries: 3,
  sourcesExtracted: 2
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 2213,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 2,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
[TEST-AI] Result: {
  content: 'Here are three significant developments in quantum computing from the past week:\n' +
    '\n' +
    `1.  **IBM's Quantum Starling System:** IBM has announced plans for its "Quantum Starling" system, which is expected to perform up to 20,000 times more operations than current quantum computers. This system aims to tackle complex quantum states beyond current capabilities and is expected to execute 100 million quantum operations using 200 logical qubits, paving the way for the "IBM Quantum Blue Jay" system capable of one billion quantum operations. This development has boosted IBM's stock and is seen as a positive indicator for the quantum computing industry. \\[[2](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHDiBAKgmaQ19T-CFbAHfnFzj4BEAIslWCXffuwnDY6YVHKOZRniXU0AkZEOWeIHepzJOp3rMRo3U3AhC38sv5XOxr3NmTRKmMWL4Wvteo9FN8Wtrfxdc3rQpheMD5l8jPKKX2skir-VQ-qeXtIJNhpB6UAoSWrWWVpAVXtXzUWzEVFT4lCAXAzzlFikH5DS9h8AqWH0BfROMbHnlQMKLA/)\\]\n` +
    '2.  **Oxford University Achieves Lowest Error Rate for Quantum Logic Operation:** Physicists at the University of Oxford have set a new global benchmark for the accuracy of controlling a single quantum bit, achieving an error rate of just 0.000015%, or one error in 6.7 million operations. This breakthrough is significant because reducing error rates is crucial for building reliable and fault-tolerant quantum computers. \\[[1](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHhwXesMa5hYHyOYcSpELYdXJZCVWVdNfAIWKTwOb2ja6MWJ7iQ9acJGBvLA1n49HB4VT7TloXxCquYIqt8e1DgI6szxuCC6yjbhKfzMvUTVFGBtlNLqXOC60J0S_piRXfS8ilmutN4tBoqLoz5Jm0C-jFLx2HesPLKSOor-_M/)\\]\n' +
    '3.  **Quantum-Enhanced Machine Learning with Photonic Quantum Circuits:** Researchers have demonstrated that even small-scale quantum computers can enhance machine learning performance using a novel photonic quantum circuit. This suggests that current quantum technology is not just experimental but can already be applied to improve machine learning. \\[[1](https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHhwXesMa5hYHyOYcSpELYdXJZCVWVdNfAIWKTwOb2ja6MWJ7iQ9acJGBvLA1n49HB4VT7TloXxCquYIqt8e1DgI6szxuCC6yjbhKfzMvUTVFGBtlNLqXOC60J0S_piRXfS8ilmutN4tBoqLoz5Jm0C-jFLx2HesPLKSOor-_M/)\\]\n',
  groundingMetadata: {
    searchEntryPoint: {
      renderedContent: '<style>\n' +
        '.container {\n' +
        '  align-items: center;\n' +
        '  border-radius: 8px;\n' +
        '  display: flex;\n' +
        '  font-family: Google Sans, Roboto, sans-serif;\n' +
        '  font-size: 14px;\n' +
        '  line-height: 20px;\n' +
        '  padding: 8px 12px;\n' +
        '}\n' +
        '.chip {\n' +
        '  display: inline-block;\n' +
        '  border: solid 1px;\n' +
        '  border-radius: 16px;\n' +
        '  min-width: 14px;\n' +
        '  padding: 5px 16px;\n' +
        '  text-align: center;\n' +
        '  user-select: none;\n' +
        '  margin: 0 8px;\n' +
        '  -webkit-tap-highlight-color: transparent;\n' +
        '}\n' +
        '.carousel {\n' +
        '  overflow: auto;\n' +
        '  scrollbar-width: none;\n' +
        '  white-space: nowrap;\n' +
        '  margin-right: -12px;\n' +
        '}\n' +
        '.headline {\n' +
        '  display: flex;\n' +
        '  margin-right: 4px;\n' +
        '}\n' +
        '.gradient-container {\n' +
        '  position: relative;\n' +
        '}\n' +
        '.gradient {\n' +
        '  position: absolute;\n' +
        '  transform: translate(3px, -9px);\n' +
        '  height: 36px;\n' +
        '  width: 9px;\n' +
        '}\n' +
        '@media (prefers-color-scheme: light) {\n' +
        '  .container {\n' +
        '    background-color: #fafafa;\n' +
        '    box-shadow: 0 0 0 1px #0000000f;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #1f1f1f;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #ffffff;\n' +
        '    border-color: #d2d2d2;\n' +
        '    color: #5e5e5e;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #f2f2f2;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #d8d8d8;\n' +
        '    border-color: #b6b6b6;\n' +
        '  }\n' +
        '  .logo-dark {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #fafafa 15%, #fafafa00 100%);\n' +
        '  }\n' +
        '}\n' +
        '@media (prefers-color-scheme: dark) {\n' +
        '  .container {\n' +
        '    background-color: #1f1f1f;\n' +
        '    box-shadow: 0 0 0 1px #ffffff26;\n' +
        '  }\n' +
        '  .headline-label {\n' +
        '    color: #fff;\n' +
        '  }\n' +
        '  .chip {\n' +
        '    background-color: #2c2c2c;\n' +
        '    border-color: #3c4043;\n' +
        '    color: #fff;\n' +
        '    text-decoration: none;\n' +
        '  }\n' +
        '  .chip:hover {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:focus {\n' +
        '    background-color: #353536;\n' +
        '  }\n' +
        '  .chip:active {\n' +
        '    background-color: #464849;\n' +
        '    border-color: #53575b;\n' +
        '  }\n' +
        '  .logo-light {\n' +
        '    display: none;\n' +
        '  }\n' +
        '  .gradient {\n' +
        '    background: linear-gradient(90deg, #1f1f1f 15%, #1f1f1f00 100%);\n' +
        '  }\n' +
        '}\n' +
        '</style>\n' +
        '<div class="container">\n' +
        '  <div class="headline">\n' +
        '    <svg class="logo-light" width="18" height="18" viewBox="9 9 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M42.8622 27.0064C42.8622 25.7839 42.7525 24.6084 42.5487 23.4799H26.3109V30.1568H35.5897C35.1821 32.3041 33.9596 34.1222 32.1258 35.3448V39.6864H37.7213C40.9814 36.677 42.8622 32.2571 42.8622 27.0064V27.0064Z" fill="#4285F4"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 43.8555C30.9659 43.8555 34.8687 42.3195 37.7213 39.6863L32.1258 35.3447C30.5898 36.3792 28.6306 37.0061 26.3109 37.0061C21.8282 37.0061 18.0195 33.9811 16.6559 29.906H10.9194V34.3573C13.7563 39.9841 19.5712 43.8555 26.3109 43.8555V43.8555Z" fill="#34A853"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M16.6559 29.8904C16.3111 28.8559 16.1074 27.7588 16.1074 26.6146C16.1074 25.4704 16.3111 24.3733 16.6559 23.3388V18.8875H10.9194C9.74388 21.2072 9.06992 23.8247 9.06992 26.6146C9.06992 29.4045 9.74388 32.022 10.9194 34.3417L15.3864 30.8621L16.6559 29.8904V29.8904Z" fill="#FBBC05"/>\n' +
        '      <path fill-rule="evenodd" clip-rule="evenodd" d="M26.3109 16.2386C28.85 16.2386 31.107 17.1164 32.9095 18.8091L37.8466 13.8719C34.853 11.082 30.9659 9.3736 26.3109 9.3736C19.5712 9.3736 13.7563 13.245 10.9194 18.8875L16.6559 23.3388C18.0195 19.2636 21.8282 16.2386 26.3109 16.2386V16.2386Z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <svg class="logo-dark" width="18" height="18" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">\n' +
        '      <circle cx="24" cy="23" fill="#FFF" r="22"/>\n' +
        '      <path d="M33.76 34.26c2.75-2.56 4.49-6.37 4.49-11.26 0-.89-.08-1.84-.29-3H24.01v5.99h8.03c-.4 2.02-1.5 3.56-3.07 4.56v.75l3.91 2.97h.88z" fill="#4285F4"/>\n' +
        '      <path d="M15.58 25.77A8.845 8.845 0 0 0 24 31.86c1.92 0 3.62-.46 4.97-1.31l4.79 3.71C31.14 36.7 27.65 38 24 38c-5.93 0-11.01-3.4-13.45-8.36l.17-1.01 4.06-2.85h.8z" fill="#34A853"/>\n' +
        '      <path d="M15.59 20.21a8.864 8.864 0 0 0 0 5.58l-5.03 3.86c-.98-2-1.53-4.25-1.53-6.64 0-2.39.55-4.64 1.53-6.64l1-.22 3.81 2.98.22 1.08z" fill="#FBBC05"/>\n' +
        '      <path d="M24 14.14c2.11 0 4.02.75 5.52 1.98l4.36-4.36C31.22 9.43 27.81 8 24 8c-5.93 0-11.01 3.4-13.45 8.36l5.03 3.85A8.86 8.86 0 0 1 24 14.14z" fill="#EA4335"/>\n' +
        '    </svg>\n' +
        '    <div class="gradient-container"><div class="gradient"></div></div>\n' +
        '  </div>\n' +
        '  <div class="carousel">\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQH-RRUB8iu1LrOxz-eBcvuheg5ZZyZFXqEq4C0EOI-bvHc_Q8ixVP-9f1khoog7Uz_36WIv2Yr_RsDHDIdU_OBXezoXuiA5ouyALtxOu5_29NvsyDGXH_VTfI2KB8vJ1o3mgE3gZrkqMCykeqycsrvZDG0JLGjx11YQOGXDn7cJJa0tt3E7yOrUKGdz1yMNgTFfGUX1tNwguyk1kI1Lv4M56FbYWGCftvys">recent quantum computing breakthroughs</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGYwnatGcxQW4L642W_x2rIMmebzrKAIJkPaP_vctpeIdYDniZO5SDhLmRBskaeobr7XuXCqmt63M7EY7aBOTVR9G9aCgT6Aev097V1GR011JmKCHxYDpVgUexa-7f57PlNZIwpjWFwrtFvPJ1DGMjEJcSABVF0fcs12TiDNjAxMMjeEhKmk0IheR42nw_pX1H3bSxmIMp_3B-ZWmSbD4Ch0x6q1bmvGRPm-UU=">quantum computing developments last week</a>\n' +
        '    <a class="chip" href="https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEjvPqbDAuJsOVOt5ozq8HasODiJ-z_uKwpDtvMOLpK7sNoyT8I9Dwlswmg4PJ5j-08h1ZNMdUVZ6A6vwJ4ECXcrtfDH_WYdgN94T3rHKp4n46mEiLQyQ7O4pcfJAEz2lVRNKZTKVOM-PFGF_NptM82RXu2U4ZMeO1HKcDOtHLdndf8EqkpVemYd96Gks6nLNtI3UM7ZpYtKYc=">quantum computing news</a>\n' +
        '  </div>\n' +
        '</div>\n'
    },
    groundingChunks: [ [Object], [Object] ],
    groundingSupports: [ [Object], [Object], [Object], [Object], [Object], [Object] ],
    retrievalMetadata: {},
    webSearchQueries: [
      'quantum computing developments last week',
      'recent quantum computing breakthroughs',
      'quantum computing news'
    ]
  },
  groundingSources: [
    {
      type: 'search',
      title: 'thestreet.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHDiBAKgmaQ19T-CFbAHfnFzj4BEAIslWCXffuwnDY6YVHKOZRniXU0AkZEOWeIHepzJOp3rMRo3U3AhC38sv5XOxr3NmTRKmMWL4Wvteo9FN8Wtrfxdc3rQpheMD5l8jPKKX2skir-VQ-qeXtIJNhpB6UAoSWrWWVpAVXtXzUWzEVFT4lCAXAzzlFikH5DS9h8AqWH0BfROMbHnlQMKLA=',
      snippet: ''
    },
    {
      type: 'search',
      title: 'sciencedaily.com',
      url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHhwXesMa5hYHyOYcSpELYdXJZCVWVdNfAIWKTwOb2ja6MWJ7iQ9acJGBvLA1n49HB4VT7TloXxCquYIqt8e1DgI6szxuCC6yjbhKfzMvUTVFGBtlNLqXOC60J0S_piRXfS8ilmutN4tBoqLoz5Jm0C-jFLx2HesPLKSOor-_M=',
      snippet: ''
    }
  ],
  thinkingSteps: undefined,
  outputImages: undefined,
  updatedChatHistory: undefined,
  usage: undefined
}
[TEST-AI] Enhanced Grounding Analysis:
  - Has grounding metadata: true
  - Has grounding sources: true
  - Grounding metadata keys: [
  'searchEntryPoint',
  'groundingChunks',
  'groundingSupports',
  'retrievalMetadata',
  'webSearchQueries'
]
  - Search queries: [
  'quantum computing developments last week',
  'recent quantum computing breakthroughs',
  'quantum computing news'
]
  - Grounding chunks: 2
  - Grounding supports: 6
  - Grounding sources count: 2
  - First source: {
  type: 'search',
  title: 'thestreet.com',
  url: 'https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHDiBAKgmaQ19T-CFbAHfnFzj4BEAIslWCXffuwnDY6YVHKOZRniXU0AkZEOWeIHepzJOp3rMRo3U3AhC38sv5XOxr3NmTRKmMWL4Wvteo9FN8Wtrfxdc3rQpheMD5l8jPKKX2skir-VQ-qeXtIJNhpB6UAoSWrWWVpAVXtXzUWzEVFT4lCAXAzzlFikH5DS9h8AqWH0BfROMbHnlQMKLA=',
  snippet: ''
}
[TEST-AI] Response keys: [
  'success',
  'content',
  'groundingMetadata',
  'groundingSources',
  'thinkingSteps',
  'error'
]
 POST /api/test-ai 200 in 6173ms
 âœ“ Compiled /api/wizard/execute in 237ms (590 modules)
[runAiStage] Starting with new SDK
[runAiStage] Starting with params: {
  hasPromptTemplate: true,
  model: 'gemini-2.0-flash',
  temperature: 0.7,
  stageOutputType: 'text',
  hasAiRedoNotes: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchEnabled: true,
  googleSearchThreshold: 0.3,
  streamingEnabled: undefined
}
[runAiStage] Filled prompt length: 267
[runAiStage] First 200 chars of filled prompt: Answer this question using current information from Google Search: what happened ysterday in austria


IMPORTANT: Use Google Search grounding to find real, current information. Provide actual search r
[runAiStage] Grounding enabled for AI processing
[runAiStage] About to call aiStageExecutionFlow with input: {
  promptLength: 267,
  model: 'gemini-2.0-flash',
  temperature: 0.7,
  hasSystemInstructions: true,
  hasChatHistory: false,
  hasThinkingSettings: false,
  hasToolNames: false,
  forceGoogleSearchGrounding: false,
  hasGroundingSettings: true,
  googleSearchEnabled: true
}
[AI Stage Flow Enhanced] Starting with input: {
  model: 'gemini-2.0-flash',
  hasTools: false,
  hasGrounding: true,
  forceGoogleSearchGrounding: false,
  hasThinking: undefined,
  isStreaming: undefined,
  promptTemplate: 'Answer this question using current information from Google Search: what happened ysterday in austria...',
  chatHistory: 'none',
  groundingSettings: { googleSearch: { enabled: true, dynamicThreshold: 0.3 } },
  googleSearchSettings: { enabled: true, dynamicThreshold: 0.3 }
}
ðŸš¨ðŸš¨ðŸš¨ === GOOGLE SEARCH GROUNDING DEBUG === ðŸš¨ðŸš¨ðŸš¨
ðŸ” forceGoogleSearchGrounding: false
ðŸ” groundingSettings?.googleSearch?.enabled: true
ðŸ” Full groundingSettings object: {
  "googleSearch": {
    "enabled": true,
    "dynamicThreshold": 0.3
  }
}
ðŸš¨ðŸš¨ðŸš¨ ================================== ðŸš¨ðŸš¨ðŸš¨
[AI Stage Flow Enhanced] Chat history built: {
  hasExistingHistory: false,
  currentPromptParts: 1,
  callHistoryLength: 1,
  promptTemplateLength: 267
}
ðŸš€ðŸš€ðŸš€ GOOGLE SEARCH GROUNDING REQUESTED! ðŸš€ðŸš€ðŸš€
ðŸ”§ Using Direct Gemini API with proper googleSearch tool...
ðŸŽ¯ [Direct Gemini API] Starting execution for Google Search grounding
ðŸ“ [Direct Gemini API] Using non-streaming mode
ðŸš€ [Direct Gemini] Starting generation with: {
  model: 'gemini-2.0-flash',
  hasPrompt: true,
  enableGoogleSearch: true,
  temperature: 0.7
}
âœ… [Direct Gemini] Adding Google Search grounding
ðŸŽ¯ [Direct Gemini] Dynamic retrieval threshold: 0.3
ðŸ“¤ [Direct Gemini] API Request: {
  model: 'gemini-2.0-flash',
  contentsCount: 2,
  configKeys: [ 'temperature', 'toolConfig', 'tools' ],
  toolsCount: 1,
  hasGoogleSearch: true
}
 âœ“ Compiled /api/documents/save in 462ms (724 modules)
[FIREBASE INIT] Configuration loaded: {
  projectId: 'franzai-writer',
  authDomain: 'franzai-writer.firebaseapp.com',
  useEmulator: 'false',
  isServer: true,
  timestamp: '2025-06-15T10:21:03.249Z'
}
[FIREBASE INIT] WARNING: Using PRODUCTION Firebase!
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
ðŸ“¥ [Direct Gemini] Raw response keys: [ 'candidates', 'modelVersion', 'usageMetadata' ]
âœ… [Direct Gemini] Found grounding metadata!
ðŸ“Š [Direct Gemini] Grounding stats: {
  chunksCount: 2,
  supportsCount: 3,
  searchQueries: 1,
  sourcesExtracted: 2
}
âœ… [Direct Gemini] Generation completed successfully
âœ… [Direct Gemini API] Generation completed successfully
[runAiStage] AI execution completed. Result keys: [ 'content', 'thinkingSteps', 'groundingMetadata', 'groundingSources' ]
[runAiStage] AI execution result: {
  hasContent: true,
  contentType: 'string',
  contentLength: 624,
  hasGroundingMetadata: true,
  hasGroundingSources: true,
  groundingSourcesCount: 2,
  hasThinkingSteps: false,
  thinkingStepsCount: 0,
  hasUpdatedChatHistory: false,
  chatHistoryLength: 0,
  hasUsage: false
}
 POST /api/wizard/execute 200 in 2716ms
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 1187ms
[DocumentPersistence] STEP 1: Starting document save operation {
  documentId: 'BHAtTG1NpuXc1Q6PDDep',
  title: 'test',
  workflowId: 'gemini-tools-test',
  stageStatesKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  stageStatesCount: 14,
  hasUserId: true,
  isNewDocument: false
}
[DocumentPersistence] STEP 2: Validation passed
[DocumentPersistence] STEP 3: Determined user ID {
  originalUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  effectiveUserId: 'n3eRvofEdpVAMI6Bez2FAPL4MF53',
  wasGenerated: false
}
[DocumentPersistence] STEP 4: Cleaning stage states for Firestore
[DocumentPersistence] STEP 5: Stage states cleaned {
  originalKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  originalCount: 14,
  cleanedKeys: [
    'test-title',
    'grounding-google-search',
    'grounding-url-context',
    'thinking-mode-test',
    'function-calling-calculator',
    'function-calling-weather',
    'function-calling-unit-converter',
    'code-execution-python',
    'streaming-test',
    'chat-mode-test',
    'image-understanding-test',
    'document-understanding-test',
    'combined-features-test',
    'final-summary'
  ],
  cleanedCount: 14
}
[DocumentPersistence] STEP 6: Updating EXISTING document { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Getting document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document retrieved { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Updating document { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[FirestoreAdapter] Document updated { collection: 'documents', id: 'BHAtTG1NpuXc1Q6PDDep' }
[DocumentPersistence] Document updated successfully { documentId: 'BHAtTG1NpuXc1Q6PDDep' }
 POST /api/documents/save 200 in 261ms
 âœ“ Compiled in 235ms (447 modules)
 âœ“ Compiled in 20ms
